<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a>ascoltatori (v4.1.0)</a>
</h1>
<h4>The pub/sub library for node backed by Redis, MongoDB, AMQP (RabbitMQ), ZeroMQ, Kafka, MQTT (Mosquitto) or just plain node!</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori">module ascoltatori</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
            <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
            <span class="apidocSignatureSpan">(decorated)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
            <span class="apidocSignatureSpan">(ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
            <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter">
            function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.behaveLikeAnAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>behaveLikeAnAscoltatore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.build">
            function <span class="apidocSignatureSpan">ascoltatori.</span>build
            <span class="apidocSignatureSpan">(opts, done)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan"></span>ascoltatori</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>util</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPAscoltatore">module ascoltatori.AMQPAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.AMQPAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPAscoltatore.prototype">module ascoltatori.AMQPAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore">module ascoltatori.AMQPLibAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.AMQPLibAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore.prototype">module ascoltatori.AMQPLibAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AbstractAscoltatore">module ascoltatori.AbstractAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.AbstractAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
            <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AbstractAscoltatore.prototype">module ascoltatori.AbstractAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._pubTopic">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_pubTopic
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._raiseIfClosed">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_raiseIfClosed
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._recvTopic">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_recvTopic
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._setPublish">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_setPublish
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._subTopic">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_subTopic
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore">module ascoltatori.DecoratorAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.DecoratorAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
            <span class="apidocSignatureSpan">(decorated)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore.prototype">module ascoltatori.DecoratorAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.on">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>on
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.once">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>once
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.removeListener">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapCallback">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapCallback
            <span class="apidocSignatureSpan">(callback, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapPayload">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapPayload
            <span class="apidocSignatureSpan">(payload, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapTopic">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapTopic
            <span class="apidocSignatureSpan">(topic, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore">module ascoltatori.EventEmitter2Ascoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.EventEmitter2Ascoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore.prototype">module ascoltatori.EventEmitter2Ascoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore">module ascoltatori.FileSystemAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.FileSystemAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore.prototype">module ascoltatori.FileSystemAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.JSONAscoltatore">module ascoltatori.JSONAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore.JSONAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
            <span class="apidocSignatureSpan">(ascoltatore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.JSONAscoltatore.prototype">module ascoltatori.JSONAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapCallback">
            function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapCallback
            <span class="apidocSignatureSpan">(callback, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapPayload">
            function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapPayload
            <span class="apidocSignatureSpan">(payload, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.KafkaAscoltatore">module ascoltatori.KafkaAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.KafkaAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.KafkaAscoltatore.prototype">module ascoltatori.KafkaAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.addKafkaSubscriptions">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>addKafkaSubscriptions
            <span class="apidocSignatureSpan">(subscribe_topics, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.createTopics">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>createTopics
            <span class="apidocSignatureSpan">(topics, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.readZkTopics">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>readZkTopics
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicOffsetsAdded">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicOffsetsAdded
            <span class="apidocSignatureSpan">(client, topics, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicPartitionsExpanded">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicPartitionsExpanded
            <span class="apidocSignatureSpan">(client, topics, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MQTTAscoltatore">module ascoltatori.MQTTAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.MQTTAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MQTTAscoltatore.prototype">module ascoltatori.MQTTAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.reconnectTopics">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>reconnectTopics
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MongoAscoltatore">module ascoltatori.MongoAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.MongoAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MongoAscoltatore.prototype">module ascoltatori.MongoAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._checkCappedAndPoll">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_checkCappedAndPoll
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._disconnected">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_disconnected
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handle">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handle
            <span class="apidocSignatureSpan">(die, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handleCursorClosed">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handleCursorClosed
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._more">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_more
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._poll">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_poll
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.PrefixAscoltatore">module ascoltatori.PrefixAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.PrefixAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
            <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.PrefixAscoltatore.prototype">module ascoltatori.PrefixAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._localToParent">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_localToParent
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._parentToLocal">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_parentToLocal
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapCallback">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapCallback
            <span class="apidocSignatureSpan">(callback, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapTopic">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapTopic
            <span class="apidocSignatureSpan">(topic, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.RedisAscoltatore">module ascoltatori.RedisAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.RedisAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.RedisAscoltatore.prototype">module ascoltatori.RedisAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._containsWildcard">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_containsWildcard
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startPub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startPub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startSub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startSub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._updateReady">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_updateReady
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.SubsCounter">module ascoltatori.SubsCounter</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.SubsCounter">
            function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.SubsCounter.prototype">module ascoltatori.SubsCounter.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.add">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>add
            <span class="apidocSignatureSpan">(elem)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.clear">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>clear
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.forEach">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>forEach
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.include">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>include
            <span class="apidocSignatureSpan">(elem)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.keys">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>keys
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.remove">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>remove
            <span class="apidocSignatureSpan">(elem)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.TrieAscoltatore">module ascoltatori.TrieAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.TrieAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.TrieAscoltatore.prototype">module ascoltatori.TrieAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore">module ascoltatori.ZeromqAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.ZeromqAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore.prototype">module ascoltatori.ZeromqAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._connectSub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_connectSub
            <span class="apidocSignatureSpan">(port, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startControl">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startControl
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startPub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startPub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startSubs">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startSubs
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.connect">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>connect
            <span class="apidocSignatureSpan">(port, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.ascoltatori">module ascoltatori.ascoltatori</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.AMQPAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.AMQPLibAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPLibAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.AbstractAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AbstractAscoltatore
            <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.DecoratorAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>DecoratorAscoltatore
            <span class="apidocSignatureSpan">(decorated)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.EventEmitter2Ascoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>EventEmitter2Ascoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.FileSystemAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>FileSystemAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.JSONAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>JSONAscoltatore
            <span class="apidocSignatureSpan">(ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.KafkaAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>KafkaAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.MQTTAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MQTTAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.MongoAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MongoAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.PrefixAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>PrefixAscoltatore
            <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.RedisAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>RedisAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.SubsCounter">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>SubsCounter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.TrieAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>TrieAscoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.ZeromqAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>ZeromqAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.behaveLikeAnAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>behaveLikeAnAscoltatore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.build">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>build
            <span class="apidocSignatureSpan">(opts, done)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>util</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.util">module ascoltatori.util</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.alias">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>alias
            <span class="apidocSignatureSpan">(obj, from, to)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.aliasAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>aliasAscoltatore
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.buildIdentifier">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>buildIdentifier
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.defer">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>defer
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.wrap">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>wrap
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori" id="apidoc.module.ascoltatori">module ascoltatori</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore" id="apidoc.element.ascoltatori.AMQPAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '.',
    wildcardOne: '*',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require("amqp");
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore" id="apidoc.element.ascoltatori.AMQPLibAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPLibAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '.',
    wildcardOne: '*',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require("amqplib/callback_api");
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore" id="apidoc.element.ascoltatori.AbstractAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
        <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbstractAscoltatore(settings, nativeSettings) {
  EventEmitter.call(this);

  settings = settings || {};
  nativeSettings = nativeSettings || {};

  this._separator = settings.separator || '/',
  this._wildcardOne = settings.wildcardOne || '+',
  this._wildcardSome = settings.wildcardSome || '*';
  this._nativeSettings = nativeSettings;

  if (nativeSettings.separator &amp;&amp;
      (this._separator !== nativeSettings.separator)) {
    this._reInSeparator = new RegExp('\\' + this._separator, 'g');
    this._reOutSeparator = new RegExp('\\' + nativeSettings.separator, 'g');
  }
  if (nativeSettings.wildcardOne &amp;&amp;
      (this._wildcardOne !== nativeSettings.wildcardOne)) {
    this._reInWildcardOne = new RegExp('\\' + this._wildcardOne, 'g');
  }
  if (nativeSettings.wildcardSome &amp;&amp;
      (this._wildcardSome !== nativeSettings.wildcardSome)) {
    this._reInWildcardSome = new RegExp('\\' + this._wildcardSome, 'g');
  }

  this._setPublish();

  this._ready = false;
  this._closed = false;

  var that = this;

  this.on("ready", function() {
    that._ready = true;
  });

  this.on("closed", function() {
    that._closed = true;
  });

  this.on("newListener", function(event, listener) {
    if (event === "ready" &amp;&amp; that._ready) {
      listener();
    }
  });

  this.setMaxListeners(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore" id="apidoc.element.ascoltatori.DecoratorAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
        <span class="apidocSignatureSpan">(decorated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DecoratorAscoltatore(decorated) {
  this._ascoltatore = decorated;
  AbstractAscoltatore.prototype._setPublish.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter2Ascoltatore(settings) {
  AbstractAscoltatore.call(this, settings, {
    wildcardOne: '*',
    wildcardSome: '**'
  });

  this._event = new EventEmitter2({
    delimiter: this._separator,
    wildcard: true
  });

  this._event.setMaxListeners(0);

  this.emit("ready");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore" id="apidoc.element.ascoltatori.FileSystemAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FileSystemAscoltatore(opts)
{
  AbstractAscoltatore.call(this, opts, {
    separator: '.'
  });

  opts = opts || {};

  var QlobberFSQ = (opts.qlobber_fsq || require('qlobber-fsq')).QlobberFSQ;

  opts.separator = this._nativeSettings.separator;
  opts.wildcard_one = this._wildcardOne;
  opts.wildcard_some = this._wildcardSome;
  opts.dedup = false;

  this._dehnd = '__filesystem_ascoltatore' + crypto.randomBytes(16).toString('base64');
  this._fsq = new QlobberFSQ(opts);

  var ths = this;

  this._fsq.on('start', function () {
    ths.emit('ready');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore" id="apidoc.element.ascoltatori.JSONAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
        <span class="apidocSignatureSpan">(ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JSONAscoltatore(ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .once("error", done);
}

if (opts.json !== false) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">JSONAscoltatore</span>(result)
    .once("error", done);
}

if (done) {
  setImmediate(function() {
    result.once("ready", function() {
      result.removeListener("error", done);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore" id="apidoc.element.ascoltatori.KafkaAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function KafkaAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '_',
    wildcardOne: '*',
    wildcardSome: '#'
  });
  this._default_opts = {connectionString: "localhost:2181/", clientId: "kafka-node-client", groupId: "kafka-node-group"};
  this._opts = opts || this._default_opts;
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.kafka = this._opts.kafka || require("kafka-node");
  this._opts.encodings = this._opts.encodings || {};
  this._opts.defaultEncoding = this._opts.defaultEncoding || "utf8";
  this._opts.noAckBatchOptions = this._opts.noAckBatchOptions || { noAckBatchSize: null, noAckBatchAge: null };

  this._knowntopics = [];
  this._subs_counter = new SubsCounter();
  this._qlobber_opts = {separator: '_',  wildcard_one: '*', wildcard_some: '#'};
  this._subs_matcher = new Qlobber(this._qlobber_opts);

  this._ascoltatore = new TrieAscoltatore(opts);
  this._consumerStarting = false;
  var connectionString = this._opts.connectionString || this._default_opts.connectionString;
  var clientId = this._opts.clientId || this._default_opts.clientId;
  var zkOptions = this._opts.zkOptions || this._default_opts.zkOptions;
  var noAckBatchOptions = this._opts.noAckBatchOptions;
  var Client = this._opts.kafka.Client;
  this._producerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
  var HighLevelProducer = this._opts.kafka.HighLevelProducer;
  this._producer = new HighLevelProducer(this._producerClient);
  var that = this;
  this._producer.on('ready',function(){
     that.readZkTopics(function(err,topics){
        if(err){
           that.emit("error",err);
           return;
        }
       that._knowntopics = that._knowntopics.concat(topics);
       that.emit("ready");
      });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore" id="apidoc.element.ascoltatori.MQTTAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MQTTAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '/',
    wildcardOne: '+',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.mqtt = this._opts.mqtt || require("mqtt");

  this._subs_counter = new SubsCounter();

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore" id="apidoc.element.ascoltatori.MongoAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MongoAscoltatore = function (opts) {
  AbstractAscoltatore.call(this);

  if (typeof opts.db === 'string' || opts.uri) {
    // old options
    opts.uri = opts.uri || 'mongodb://127.0.0.1/';
    opts.db = opts.db || 'ascoltatori';
    opts.url = opts.uri + opts.db + '?auto_reconnect=true';
    delete opts.db;
  }

  this._opts = opts || {};
  this.url = this._opts.url || 'mongodb://127.0.0.1/ascoltatori?auto_reconnect=true';
  this._pubsubCollection = opts.pubsubCollection || 'pubsub';
  this._maxRetry = opts.maxRetry || 5;
  this.mongoOpts = this._opts.mongo || {};

  this._ascoltatore = new TrieAscoltatore(opts);

  this.channels = {};
  this._closed = false;

  this._handlingCursorFailure = false;
  this._lastSuccessfulHandling = new ObjectID();

  this.wait = this._opts.wait || 100;

  this.connectionParams = {
    capped: true,
    size: this._opts.size || 10 * 1024 * 1024, // 10 MB
    max: this._opts.max || 10000 // documents
  };

  var that = this;

  var setupDB = function(err, db) {
    if (err) {
      that.emit('error', err);
      return;
    }

    that.db = db;

    // creating the capped collection where we can exchange messages
    that.db.createCollection(that._pubsubCollection, that.connectionParams, function(err, collection) {
      if (err) {
        that.emit('error', err);
      } else&nbsp; {
        that.collection = collection;

        debug('ready');

        // create a new object id. We will get all the events from now on
        that._poll(new ObjectID());

        that.emit('ready');
      }
    });
  };

  if (opts.db) {
    setupDB(null, opts.db);
  } else {
    MongoClient.connect(this.url, this.mongoOpts, setupDB);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore" id="apidoc.element.ascoltatori.PrefixAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
        <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrefixAscoltatore(prefix, ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore || new TrieAscoltatore());

  this._prefix = prefix;
  this._separator = this._ascoltatore._separator;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Klass = (typeof opts.type === 'function') ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">PrefixAscoltatore</span>(opts.prefix, result)
    .once("error", done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once("error", done);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore" id="apidoc.element.ascoltatori.RedisAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '/',
    wildcardOne: '*',
    wildcardSome: '*'
  });

  this._ready_sub = false;
  this._ready_pub = false;
  this._opts = opts || {};

  this._ascoltatores = {};

  this._startSub();
  this._startPub();

  this._subs_counter = new SubsCounter();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter" id="apidoc.element.ascoltatori.SubsCounter">
        function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SubsCounter() {
  this.clear();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore" id="apidoc.element.ascoltatori.TrieAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TrieAscoltatore(settings) {
  AbstractAscoltatore.call(this, settings);

  settings = settings || {};

  this._matcher = new Qlobber({
    separator: settings.separator || '/',
    wildcard_one: settings.wildcardOne || '+',
    wildcard_some: settings.wildcardSome || '*'
  });

  this.emit("ready");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore" id="apidoc.element.ascoltatori.ZeromqAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ZeromqAscoltatore(opts) {
  AbstractAscoltatore.call(this);

  this._opts = opts || {};
  this._opts.delay = this._opts.delay || 5;
  this._opts.zmq = this._opts.zmq || require("zmq");

  this._connectedControls = [];

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startSubs();
  this._startPub();
  this._startControl();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.behaveLikeAnAscoltatore" id="apidoc.element.ascoltatori.behaveLikeAnAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>behaveLikeAnAscoltatore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">behaveLikeAnAscoltatore = function () {

  var expect;

  // you MUST depend on chai only if you plan to run
  // this test
  expect = require("chai").expect;

  it("should have a subscribe function", function() {
    var that = this;
    expect(that.instance).to.respondTo("subscribe");
  });

  it("should have an publish function", function() {
    var that = this;
    expect(that.instance).to.respondTo("publish");
  });

  it("should support a publish/subscribe pattern", function(done) {
    var that = this;
    that.instance.subscribe("hello", wrap(done), function() {
      that.instance.publish("hello");
    });
  });

  it("should support 'pub/sub' combination for pub/sub", function(done) {
    var that = this;
    that.instance.sub("hello", wrap(done), function() {
      that.instance.pub("hello");
    });
  });

  it("should not raise an exception if pub is called without a done callback", function(done) {
    this.instance.pub("hello");
    setTimeout(done, 50);
  });

  it("should not raise an exception if sub is called without a done callback", function(done) {
    var that = this;
    that.instance.sub("hello", function() {});
    setTimeout(function() {
      // still, some Ascoltatore are async
      // and we must give them some time
      done();
    }, 10);
  });

  it("should accept a done callback in pub", function(done) {
    this.instance.pub("hello", "world", done);
  });

  it("should support multi-level wildcard at end of topic", function(done) {
    var that = this;
    that.instance.sub("hello/*", wrap(done), function() {
      that.instance.pub("hello/there/42");
    });
  });

  it("should support multi-level wildcard at the end of a topic with no separator", function(done) {
    var that = this;
    that.instance.sub("hello/*", wrap(done), function() {
      that.instance.pub("hello");
    });
  });

  it("should support single-level wildcard at start of topic", function(done) {
    var that = this;
    that.instance.sub("+/hello", wrap(done), function() {
      that.instance.pub("42/hello");
    });
  });

  it("should support single-level wildcard in middle of topic", function(done) {
    var that = this;
    that.instance.sub("hello/+/end", wrap(done), function() {
      that.instance.pub("hello/42/end");
    });
  });

  it("should support single-level wildcard at end of topic", function(done) {
    var that = this;
    that.instance.sub("hello/+", wrap(done), function() {
      that.instance.pub("hello/42");
    });
  });

  it("should support both wildcards in topic", function(done) {
    var that = this;
    that.instance.sub("hello/+/there/*", wrap(done), function() {
      that.instance.pub("hello/foo/there/bar/42/end");
    });
  });

  it("should not match multiple levels with single wildcard", function(done) {
    var that = this,
        callback = null;

    callback = function(topic) {
      expect(topic).to.equal(["hello", "42", "there"].join(that.separator));
      done();
    };

    that.instance.sub("hello/+/there", callback, function () {
      that.instance.pub("hello/42/43/there");
      that.instance.pub("hello/42/there");
    });
  });

  it("should unsubscribe from wildcard topics independently", function(done) {
    var that = this,
        callback1 = null,
        callback2 = null;

    callback1 = function(topic) {
      expect(topic).to.equal(["hello", "42", "there"].join(that.separator));
      done();
    };

    callback2 = function () { };

    that.instance.sub("hello/*/there", callback2, function () {
      that.instance.sub("hello/+/there", callback1, function () {
        that.instance.unsub("hello/*/there", callback2, function () {
          that.instance.pub("hello/42/there");
        });
      });
    });
  });

  it("should call each matching callback", function(done) {
    var that = this,
        callback = null,
        count = 0;

    callback = function(topic) {
      expect(topic).to.equal(["hello", "42"].join(that.separator));
      count += 1;
      if (count === 2) {
        done();
      }
    };

    that.instance.sub("hello/42", callback, function () {
      that.i ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.build" id="apidoc.element.ascoltatori.build">
        function <span class="apidocSignatureSpan">ascoltatori.</span>build
        <span class="apidocSignatureSpan">(opts, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function build(opts, done) {
  opts = opts || {};

  if (typeof opts === "function") {
    done = opts;
    opts = {};
  }

  var Klass = null,
    result = null;

  Klass = (typeof opts.type === 'function') ? opts.type :
            (classes[opts.type] || module.exports.TrieAscoltatore);

  result = new Klass(opts, module.exports);

  if (opts.prefix) {
    result = new module.exports.PrefixAscoltatore(opts.prefix, result)
      .once("error", done);
  }

  if (opts.json !== false) {
    result = new module.exports.JSONAscoltatore(result)
      .once("error", done);
  }

  if (done) {
    setImmediate(function() {
      result.once("ready", function() {
        result.removeListener("error", done);
        done(null, result);
      });
    });
  }

  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Ascoltatori focuses on providing a simple and unique abstraction for all
supported brokers. Here is a simple example using Redis:

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.<span class="apidocCodeKeywordSpan">build</span>(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.subscribe('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});
...</pre></li>
    </ul>




































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPAscoltatore" id="apidoc.module.ascoltatori.AMQPAscoltatore">module ascoltatori.AMQPAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.AMQPAscoltatore" id="apidoc.element.ascoltatori.AMQPAscoltatore.AMQPAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '.',
    wildcardOne: '*',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require("amqp");
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPAscoltatore.prototype" id="apidoc.module.ascoltatori.AMQPAscoltatore.prototype">module ascoltatori.AMQPAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function () {
  var conn = null,
    that = this;

  if (this._client_conn === undefined) {

    conn = this._opts.amqp.createConnection(this._opts.client);
    this._client_conn = conn;

    conn.on("error", function(error) {
      if (typeof error === 'string') {
        error = (new Error(error));
      }

      that.emit("error", error);
    });

    debug("connecting to " + this._opts.client);

    steed.series([

      function(callback) {
        that._client_conn.once("ready", wrap(callback));
      },

      function(callback) {
        debug("connected");
        that._exchange = conn.exchange(that._opts.exchange, {
          type: "topic",
          confirm: true
        });
        that._exchange.once("open", wrap(callback));
      },

      function(callback) {
        debug("created exchange " + that._opts.exchange);
        that._queue = conn.queue(util.buildIdentifier(), wrap(callback));
        that._queue.setMaxListeners(0); // avoid problems with listeners
      },

      function(callback) {
        that._queue.subscribe({
          ack: true,
          prefetchCount: 42
        }, function(message, headers, deliveryInfo) {
          that._queue.shift();

          var topic = that._recvTopic(deliveryInfo.routingKey);

          debug("new message received from queue on topic " + topic);

          that._ascoltatore.publish(topic, message.data.toString());
        });
        that._queue.once("basicConsumeOk", function() {
          defer(callback);
        });
      },

      function(callback) {
        debug("subscribed to queue");
        that.emit("ready");
        callback();
      }
    ]);
  }
  return this._client_conn;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.close" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;

  if (this._closed) {
    wrap(done)();
    return;
  }

  if (this._closing) {
    this.on("closed", done);
    return;
  }

  this._closing = true;

  if (this._client_conn !== undefined) {
    var doClose = function () {
      if (that._closed) {
        debug("closing twice, one was an error");
        return;
      }

      debug("closed");
      defer(done);
      that.emit("closed");
    };

    this._client_conn.on("close", doClose);

    this._queue.destroy();
    this._client_conn.end();
    this._client_conn.removeAllListeners("error");
    this._client_conn.on("error", doClose);

    delete this._client_conn;
    delete this._exchange;
    delete this._queue;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug("new message published to " + topic);

  this._exchange.publish(this._pubTopic(topic), String(message));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug("new message published to " + topic);

  this._exchange.publish(this._pubTopic(topic), String(message));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {

    debug("binding queue to topic " + topic);

    this._queue.once("queueBindOk", function() {
      // trick against node-amqp not working
      // as advertised
      setTimeout(function() {
        debug("queue bound to topic " + topic);
        defer(done);
      }, 5);
    });

    this._queue.bind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug("registered new subscriber for topic " + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {

    debug("binding queue to topic " + topic);

    this._queue.once("queueBindOk", function() {
      // trick against node-amqp not working
      // as advertised
      setTimeout(function() {
        debug("queue bound to topic " + topic);
        defer(done);
      }, 5);
    });

    this._queue.bind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug("registered new subscriber for topic " + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug("deregistered subscriber for topic " + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._queue.once("queueUnbindOk", function() {
      debug("queue unbound to topic " + topic);
      defer(done);
    });

    this._queue.unbind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug("deregistered subscriber for topic " + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._queue.once("queueUnbindOk", function() {
      debug("queue unbound to topic " + topic);
      defer(done);
    });

    this._queue.unbind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore" id="apidoc.module.ascoltatori.AMQPLibAscoltatore">module ascoltatori.AMQPLibAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.AMQPLibAscoltatore" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.AMQPLibAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPLibAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '.',
    wildcardOne: '*',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require("amqplib/callback_api");
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore.prototype" id="apidoc.module.ascoltatori.AMQPLibAscoltatore.prototype">module ascoltatori.AMQPLibAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function () {
  var conn = null,
    channel = null,
    that = this;

  if (this._client_conn === undefined) {

    var url = this._opts.url || 'amqp://127.0.0.1:5672';

    var socketOptions = this._opts.socketOptions || {};

    debug("connecting to " + this._opts.url);

    steed.series([
      function (callback) {
        that._opts.amqp.connect(url, socketOptions, function (err, conn) {
          that._client_conn = conn;
          conn.on("error", function (error) {
            if (typeof error === 'string') {
              error = (new Error(error));
            }

            that.emit("error", error);
          });
          callback();
        });
      },

      function (callback) {
        debug('connected');
        that._client_conn.createChannel(function(err, channel){
          that._channel = channel;
          that._channel.prefetch(42); // magic number?
          callback();
        });
      },

      function(callback){
        debug('channel created');
        that._queue = util.buildIdentifier();
        that._channel.assertQueue(that._queue, {durable: false}, wrap(callback));
      },

      function (callback){
        debug('queue created');
        that._channel.assertExchange(that._opts.exchange, 'topic', {}, wrap(callback));
      },

      function (callback){
        debug('exchange existed');
        that._channel.consume(that._queue, function(msg){
          that._channel.ack(msg);
          var topic = that._recvTopic(msg.fields.routingKey);
          debug("new message received from queue on topic " + topic);
          that._ascoltatore.publish(topic, msg.content.toString());
        }, null, wrap(callback));
      },

      function (callback) {
        debug("subscribed to queue");
        that.emit("ready");
        callback();
      }
    ]);
  }
  return this._client_conn;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.close" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;

  if (this._closed) {
    wrap(done)();
    return;
  }

  if (this._closing) {
    this.on("closed", done);
    return;
  }

  this._closing = true;

  if (this._client_conn !== undefined) {
    var doClose = function () {
      if (that._closed) {
        debug("closing twice, one was an error");
        return;
      }

      debug("closed");
      defer(done);
      that.emit("closed");
    };

    this._client_conn.on("close", doClose);
    this._channel.deleteQueue(this._queue);
    this._channel.close();

    this._client_conn.close();
    this._client_conn.removeAllListeners("error");
    this._client_conn.on("error", doClose);

    delete this._client_conn;
    delete this._channel;
    delete this._queue;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug("new message published to " + topic);

  this._channel.publish(this._opts.exchange, this._pubTopic(topic), new Buffer(String(message)));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug("new message published to " + topic);

  this._channel.publish(this._opts.exchange, this._pubTopic(topic), new Buffer(String(message)));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    debug("binding queue to topic " + topic);

    this._channel.bindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok){
        debug("queue bound to topic " + topic);
        defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug("registered new subscriber for topic " + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    debug("binding queue to topic " + topic);

    this._channel.bindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok){
        debug("queue bound to topic " + topic);
        defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug("registered new subscriber for topic " + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug("deregistered subscriber for topic " + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._channel.unbindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok) {
      debug("queue unbound to topic " + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug("deregistered subscriber for topic " + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._channel.unbindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok) {
      debug("queue unbound to topic " + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AbstractAscoltatore" id="apidoc.module.ascoltatori.AbstractAscoltatore">module ascoltatori.AbstractAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.AbstractAscoltatore" id="apidoc.element.ascoltatori.AbstractAscoltatore.AbstractAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
        <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbstractAscoltatore(settings, nativeSettings) {
  EventEmitter.call(this);

  settings = settings || {};
  nativeSettings = nativeSettings || {};

  this._separator = settings.separator || '/',
  this._wildcardOne = settings.wildcardOne || '+',
  this._wildcardSome = settings.wildcardSome || '*';
  this._nativeSettings = nativeSettings;

  if (nativeSettings.separator &amp;&amp;
      (this._separator !== nativeSettings.separator)) {
    this._reInSeparator = new RegExp('\\' + this._separator, 'g');
    this._reOutSeparator = new RegExp('\\' + nativeSettings.separator, 'g');
  }
  if (nativeSettings.wildcardOne &amp;&amp;
      (this._wildcardOne !== nativeSettings.wildcardOne)) {
    this._reInWildcardOne = new RegExp('\\' + this._wildcardOne, 'g');
  }
  if (nativeSettings.wildcardSome &amp;&amp;
      (this._wildcardSome !== nativeSettings.wildcardSome)) {
    this._reInWildcardSome = new RegExp('\\' + this._wildcardSome, 'g');
  }

  this._setPublish();

  this._ready = false;
  this._closed = false;

  var that = this;

  this.on("ready", function() {
    that._ready = true;
  });

  this.on("closed", function() {
    that._closed = true;
  });

  this.on("newListener", function(event, listener) {
    if (event === "ready" &amp;&amp; that._ready) {
      listener();
    }
  });

  this.setMaxListeners(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AbstractAscoltatore.prototype" id="apidoc.module.ascoltatori.AbstractAscoltatore.prototype">module ascoltatori.AbstractAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._pubTopic" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._pubTopic">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_pubTopic
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_pubTopic = function (topic) {
  if (this._reInSeparator) {
    topic = topic.replace(this._reInSeparator,
                          this._nativeSettings.separator);
  }
  return topic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._raiseIfClosed" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._raiseIfClosed">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_raiseIfClosed
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function raiseIfClosed() {
  if (this._closed) {
    throw new Error("This ascoltatore is closed");
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._recvTopic" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._recvTopic">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_recvTopic
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_recvTopic = function (topic) {
  if (this._reOutSeparator) {
    topic = topic.replace(this._reOutSeparator, this._separator);
  }
  return topic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._setPublish" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._setPublish">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_setPublish
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setPublish = function () {
  var proto = Object.getPrototypeOf(this),
      f = proto.publish,
      publish,
      newPublish;

  if (!f) { return; }

  if (f.length === 4) {
    publish = this.publish;
  } else {
    publish = function (topic, payload, options, done) {
      return f.call(this, topic, payload, done);
    };
  }

  newPublish = function (topic, payload, options, done) {
    if ((typeof options === 'function') ||
        (done &amp;&amp; (typeof done !== 'function'))) {
      done = options;
      options = {};
    } else if ((options === undefined) || (options === null)) {
      options = {};
    }

    return publish.call(this, topic, payload, options, done);
  };

  this.publish = newPublish;

  if (proto.pub === proto.publish) {
    this.pub = newPublish;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._subTopic" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._subTopic">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_subTopic
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_subTopic = function (topic) {
  if (this._reInSeparator) {
    topic = topic.replace(this._reInSeparator,
                          this._nativeSettings.separator);
  }
  if (this._reInWildcardSome) {
    topic = topic.replace(this._reInWildcardSome,
                          this._nativeSettings.wildcardSome);
  }
  if (this._reInWildcardOne) {
    topic = topic.replace(this._reInWildcardOne,
                          this._nativeSettings.wildcardOne);
  }
  return topic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.close" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (done) {
  throw new Error("Subclass to implement");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, payload, options, done) {
  throw new Error("Subclass to implement");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done) {
  throw new Error("Subclass to implement");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function (topic, callback, done) {
  throw new Error("Subclass to implement");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore" id="apidoc.module.ascoltatori.DecoratorAscoltatore">module ascoltatori.DecoratorAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.DecoratorAscoltatore" id="apidoc.element.ascoltatori.DecoratorAscoltatore.DecoratorAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
        <span class="apidocSignatureSpan">(decorated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DecoratorAscoltatore(decorated) {
  this._ascoltatore = decorated;
  AbstractAscoltatore.prototype._setPublish.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore.prototype" id="apidoc.module.ascoltatori.DecoratorAscoltatore.prototype">module ascoltatori.DecoratorAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.close" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (done) {
  this._ascoltatore.close(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.on" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.on">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>on
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (event, callback) {
  this._ascoltatore.on(event, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    a.push(subscribe);
  }

  steed.parallel(a, instance.publish.bind(instance, "hello", null));
});

it("should emit the ready event", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">on</span>("ready", done);
});

it("should support at least 12 listeners as an EventEmitter", function(done) {
  var counter = 11,
    i = null,
    callback, a = [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.once" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.once">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>once
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">once = function (event, callback) {
  this._ascoltatore.once(event, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Klass = (typeof opts.type === 'function') ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .<span class="apidocCodeKeywordSpan">once</span>("error", done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once("error", done);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, payload, options, done) {
  this.publish(topic, payload, options, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, payload, options, done) {
  var that = this;
  steed.waterfall([

    function(cb) {
      that.wrapTopic(topic, cb);
    },

    function(newTopic, cb) {
      that.wrapPayload(payload, function(err, newPayload) {
        cb(err, newTopic, newPayload);
      });
    },

    function(newTopic, newPayload, cb) {
      that._ascoltatore.publish(newTopic, newPayload, options, cb);
    }
  ], done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.removeListener" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.removeListener">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeListener = function (event, callback) {
  this._ascoltatore.removeListener(event, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    result = new module.exports.JSONAscoltatore(result)
      .once("error", done);
  }

  if (done) {
    setImmediate(function() {
      result.once("ready", function() {
        result.<span class="apidocCodeKeywordSpan">removeListener</span>("error", done);
        done(null, result);
      });
    });
  }

  return result;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sub = function (topic, callback, done) {
  this.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done) {
  var that = this;
  steed.waterfall([

    function(cb) {
      that.wrapTopic(topic, cb);
    },

    function(newTopic, cb) {
      that.wrapCallback(callback, function(err, newCallback) {
        cb(err, newTopic, newCallback);
      });
    },

    function(newTopic, newCallback, cb) {
      that._ascoltatore.subscribe(newTopic, newCallback, cb);
    }
  ], done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function (topic, callback, done) {
  this.unsubscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function (topic, callback, done) {
  var that = this;
  steed.waterfall([

    function(cb) {
      that.wrapTopic(topic, cb);
    },

    function(newTopic, cb) {
      that.wrapCallback(callback, function(err, newCallback) {
        cb(err, newTopic, newCallback);
      });
    },

    function(newTopic, newCallback, cb) {
      that._ascoltatore.unsubscribe(newTopic, newCallback, cb);
    }
  ], done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapCallback" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapCallback">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapCallback
        <span class="apidocSignatureSpan">(callback, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapCallback = function (callback, next) {
  next(null, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapPayload" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapPayload">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapPayload
        <span class="apidocSignatureSpan">(payload, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapPayload = function (payload, next) {
  next(null, payload);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapTopic" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapTopic">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapTopic
        <span class="apidocSignatureSpan">(topic, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapTopic = function (topic, next) {
  next(null, topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore" id="apidoc.module.ascoltatori.EventEmitter2Ascoltatore">module ascoltatori.EventEmitter2Ascoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.EventEmitter2Ascoltatore" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.EventEmitter2Ascoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter2Ascoltatore(settings) {
  AbstractAscoltatore.call(this, settings, {
    wildcardOne: '*',
    wildcardSome: '**'
  });

  this._event = new EventEmitter2({
    delimiter: this._separator,
    wildcard: true
  });

  this._event.setMaxListeners(0);

  this.emit("ready");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore.prototype" id="apidoc.module.ascoltatori.EventEmitter2Ascoltatore.prototype">module ascoltatori.EventEmitter2Ascoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.close" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  this._event.removeAllListeners();
  this.emit("closed");

  debug("closed");

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.pub" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug("new message published to " + topic);

  this._event.emit(this._pubTopic(topic).replace(/^\//g, ''), topic, message, options);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.publish" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug("new message published to " + topic);

  this._event.emit(this._pubTopic(topic).replace(/^\//g, ''), topic, message, options);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.sub" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("registered new subscriber for topic " + topic);

  this._event.on(this._subTopic(topic).replace(/^\//g, ''), callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("registered new subscriber for topic " + topic);

  this._event.on(this._subTopic(topic).replace(/^\//g, ''), callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsub" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug("deregistered subscriber for topic " + topic);

  this._event.off(this._subTopic(topic).replace(/^\//g, ''), callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug("deregistered subscriber for topic " + topic);

  this._event.off(this._subTopic(topic).replace(/^\//g, ''), callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore" id="apidoc.module.ascoltatori.FileSystemAscoltatore">module ascoltatori.FileSystemAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.FileSystemAscoltatore" id="apidoc.element.ascoltatori.FileSystemAscoltatore.FileSystemAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FileSystemAscoltatore(opts)
{
  AbstractAscoltatore.call(this, opts, {
    separator: '.'
  });

  opts = opts || {};

  var QlobberFSQ = (opts.qlobber_fsq || require('qlobber-fsq')).QlobberFSQ;

  opts.separator = this._nativeSettings.separator;
  opts.wildcard_one = this._wildcardOne;
  opts.wildcard_some = this._wildcardSome;
  opts.dedup = false;

  this._dehnd = '__filesystem_ascoltatore' + crypto.randomBytes(16).toString('base64');
  this._fsq = new QlobberFSQ(opts);

  var ths = this;

  this._fsq.on('start', function () {
    ths.emit('ready');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore.prototype" id="apidoc.module.ascoltatori.FileSystemAscoltatore.prototype">module ascoltatori.FileSystemAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.close" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (done)
{
  this._fsq.stop_watching(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done)
{
  this._fsq.publish(this._pubTopic(topic), JSON.stringify({
    message: message,
    options: options
  }), done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done)
{
  this._fsq.publish(this._pubTopic(topic), JSON.stringify({
    message: message,
    options: options
  }), done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sub = function (topic, callback, done)
{
  var ths = this;

  function cb(data, info, cb2)
  {
    data = JSON.parse(data);
    callback(ths._recvTopic(info.topic), data.message, data.options);
    cb2();
  }

  var f = cb;

  callback[this._dehnd] = callback[this._dehnd] || f;

  this._fsq.subscribe(this._subTopic(topic),
                      callback[this._dehnd],
                      done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done)
{
  var ths = this;

  function cb(data, info, cb2)
  {
    data = JSON.parse(data);
    callback(ths._recvTopic(info.topic), data.message, data.options);
    cb2();
  }

  var f = cb;

  callback[this._dehnd] = callback[this._dehnd] || f;

  this._fsq.subscribe(this._subTopic(topic),
                      callback[this._dehnd],
                      done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function (topic, callback, done)
{
  this._fsq.unsubscribe(this._subTopic(topic),
                        callback[this._dehnd] || callback,
                        done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function (topic, callback, done)
{
  this._fsq.unsubscribe(this._subTopic(topic),
                        callback[this._dehnd] || callback,
                        done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.JSONAscoltatore" id="apidoc.module.ascoltatori.JSONAscoltatore">module ascoltatori.JSONAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore.JSONAscoltatore" id="apidoc.element.ascoltatori.JSONAscoltatore.JSONAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
        <span class="apidocSignatureSpan">(ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JSONAscoltatore(ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .once("error", done);
}

if (opts.json !== false) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">JSONAscoltatore</span>(result)
    .once("error", done);
}

if (done) {
  setImmediate(function() {
    result.once("ready", function() {
      result.removeListener("error", done);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.JSONAscoltatore.prototype" id="apidoc.module.ascoltatori.JSONAscoltatore.prototype">module ascoltatori.JSONAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapCallback" id="apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapCallback">
        function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapCallback
        <span class="apidocSignatureSpan">(callback, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapCallback = function (callback, next) {
  var that = this;
  if (!callback._json_ascoltatore_wrapper) {
    callback._json_ascoltatore_wrapper = function(t, payload, options) {
      debug("converting from JSON");
      var errored = false;

      try {
        payload = JSON.parse(payload);
      } catch (e) {
        errored = true;
        debug("The payload is not a valid JSON", e);
      }

      if (!errored) {
        callback(t, payload, options);
      }
    };
  }
  next(null, callback._json_ascoltatore_wrapper);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapPayload" id="apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapPayload">
        function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapPayload
        <span class="apidocSignatureSpan">(payload, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapPayload = function (payload, next) {

  if (payload === undefined || payload === null) {
    payload = false; // so we can convert it to JSON
  }

  debug("converting to JSON");
  next(null, JSON.stringify(payload));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.KafkaAscoltatore" id="apidoc.module.ascoltatori.KafkaAscoltatore">module ascoltatori.KafkaAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.KafkaAscoltatore" id="apidoc.element.ascoltatori.KafkaAscoltatore.KafkaAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function KafkaAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '_',
    wildcardOne: '*',
    wildcardSome: '#'
  });
  this._default_opts = {connectionString: "localhost:2181/", clientId: "kafka-node-client", groupId: "kafka-node-group"};
  this._opts = opts || this._default_opts;
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.kafka = this._opts.kafka || require("kafka-node");
  this._opts.encodings = this._opts.encodings || {};
  this._opts.defaultEncoding = this._opts.defaultEncoding || "utf8";
  this._opts.noAckBatchOptions = this._opts.noAckBatchOptions || { noAckBatchSize: null, noAckBatchAge: null };

  this._knowntopics = [];
  this._subs_counter = new SubsCounter();
  this._qlobber_opts = {separator: '_',  wildcard_one: '*', wildcard_some: '#'};
  this._subs_matcher = new Qlobber(this._qlobber_opts);

  this._ascoltatore = new TrieAscoltatore(opts);
  this._consumerStarting = false;
  var connectionString = this._opts.connectionString || this._default_opts.connectionString;
  var clientId = this._opts.clientId || this._default_opts.clientId;
  var zkOptions = this._opts.zkOptions || this._default_opts.zkOptions;
  var noAckBatchOptions = this._opts.noAckBatchOptions;
  var Client = this._opts.kafka.Client;
  this._producerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
  var HighLevelProducer = this._opts.kafka.HighLevelProducer;
  this._producer = new HighLevelProducer(this._producerClient);
  var that = this;
  this._producer.on('ready',function(){
     that.readZkTopics(function(err,topics){
        if(err){
           that.emit("error",err);
           return;
        }
       that._knowntopics = that._knowntopics.concat(topics);
       that.emit("ready");
      });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.KafkaAscoltatore.prototype" id="apidoc.module.ascoltatori.KafkaAscoltatore.prototype">module ascoltatori.KafkaAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function (cb) {
  var that = this;
  if (this._consumer !== undefined) {
      return;
  }
   this._consumerStarting = true;
   var newcb = function(){
          that._consumerStarting = false;
          util.wrap(cb)();
          that.emit("consumer_connected");
   };
   var connectionString = that._opts.connectionString || that._default_opts.connectionString;
   var clientId = that._opts.clientId || that._default_opts.clientId;
   var zkOptions = that._opts.zkOptions || that._default_opts.zkOptions;
   var noAckBatchOptions = that._opts.noAckBatchOptions;
   var groupId = that._opts.groupId || that._default_opts.groupId;
   var Client = this._opts.kafka.Client;
   var useHighLevelConsumer = that._opts.useHighLevelConsumer || false;
   var HighLevelConsumer = this._opts.kafka.HighLevelConsumer;
   var Consumer = this._opts.kafka.Consumer;
   var subscribedTopics = that._subs_counter.keys();
   var subscriptions = [];
   subscribedTopics.forEach(function(topic){
        subscriptions.push({topic: topic, offset: -1});
   });
   debug("consumer connecting with connectionString=["+connectionString+"], clientId=["+clientId+"], groupId=["+groupId+"] and initial
 subscriptions",subscriptions);
   this._consumerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
   var initConsumer = function(err,subscriptions){
        if(err){
          debug("problem with initConsumer",err);
          that.emit("error", err);
          return false;
        }
        debug("initial subscriptions expanded to ",subscriptions);
        if (useHighLevelConsumer) {
           debug("Using high level consumer ");
           that._consumer = new HighLevelConsumer(that._consumerClient, subscriptions, {
               groupId: groupId,fromOffset: true, autoCommit: false, encoding: "buffer"
           });
        } else {
           debug("Using simple consumer ");
           that._consumer = new Consumer(that._consumerClient, subscriptions, {
               groupId: groupId,fromOffset: true, autoCommit: false, encoding: "buffer"});
        }
        that._consumer.on("message", function(message) {
            debug("received new message on topic ", message.topic);
            var value = message.value;
            var encoding = that._opts.encodings[message.topic] || that._opts.defaultEncoding;
            if(message.value &amp;&amp; encoding !== "buffer"){
              value = message.value.toString(encoding);
              debug("message is", value);
            }
            if(that._ascoltatore._closed !== true){
              debug("publishing to _ascolatore ", message.topic);
              that._ascoltatore.publish(that._recvTopic(message.topic), value);
            }
        });
        that._consumer.on('error', function(e) {
          debug("error in client",e);
          that.emit("error", e);
        });
        defer(newcb);
    };
    that._consumerClient.on('ready',function() {
        that.withTopicOffsetsAdded(that._consumerClient,subscriptions,initConsumer);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.addKafkaSubscriptions" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.addKafkaSubscriptions">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>addKafkaSubscriptions
        <span class="apidocSignatureSpan">(subscribe_topics, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addKafkaSubscriptions(subscribe_topics, done) {
  var that = this;
  debug("registering new subscriber for topics ", subscribe_topics);
  this.withTopicOffsetsAdded(this._consumerClient,subscribe_topics,function(err,subscriptions){
          if(err){
            debug("problem adding kafka subscriptions with topic offsets added",err);
            that.emit("error",err);
            return;
          }
          that._consumer.addTopics(subscriptions,function(err,added) {
                if(err){
                  debug("problem with consumer.addTopics",err);
                  that.emit("error",err);
                  return;
                }
                debug("registered new kafka subscriptions", subscribe_topics);
                defer(done);
              },true);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.close" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;
  debug("closing");
  if (!this._closed) {
    this._subs_counter.clear();
    if(this._producer){
      this._producer.close(function(){
        that._producerClient.close(function() {
          debug("closed producer");
          delete that._producerClient;
          delete that._producer;
        });
      });
    }
    if(this._consumer){
       that._consumer.close(function(){
        debug("closed consumer");
        that._consumerClient.close(function() {
          debug("closed");
          that._ascoltatore.close();
          delete that._consumerClient;
          delete that._consumer;
          that.emit("closed");
          defer(done);
        });
     });
    }else{
      this.emit("closed");
      util.wrap(done)();
    }
  } else {
    util.wrap(done)();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.createTopics" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.createTopics">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>createTopics
        <span class="apidocSignatureSpan">(topics, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createTopics(topics, callback){
  var that = this;
  if(typeof topics === 'string'){
     topics = [topics];
  }
  debug("creating topics ",topics);
  this._producer.createTopics(topics, false, function (err, data) {
         if(err){
            debug("problem creating topics",err);
            defer(function(){callback(err);});
            return;
         }
         that._knowntopics = that._knowntopics.concat(topics);
         defer(callback);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();
  var that = this;
  // kafka cannot send a null message. Why are messages missing in the tests...
  if(message === undefined || message === null){
    message = '';
  }
  var pubtopic = this._pubTopic(topic);
  var doPublish = function(){
    var payload = {
      messages: message,
      topic: pubtopic
    };
    debug("about to publish new message to ",pubtopic);
    that._producer.send([payload], function(err,data) {
      if(err){
        debug("something went wrong publishing to "+pubtopic,err);
        that.emit("error",err);
      }else{
        debug("new message published to " + pubtopic);
      }
      util.wrap(done)();
    });
  };

  if(this._knowntopics.indexOf(pubtopic) &gt;= 0){
     //we already know about this topic, so publish to it and we're done.
     doPublish();
     return;
  }

  // it's a new topic for kafka
  var createTopicCallback = function(err){
         if(err){
            debug("problem creating topic",err);
            that.emit("error",err);
            return;
         }
         //do subscribers await this new topic?
         var wanted = that._subs_matcher.match(pubtopic);
         if(wanted.length === 0){
             // nobody subscribed at our end, so just publish to kafka
             doPublish();
             return;
         }
         // somebody wants messages published to the new topic
         for(var i=0;i&lt;wanted.length;i++){
            that._subs_counter.add(pubtopic);
         }
         if(that._consumer === undefined){
            // start the kafka consumer before publishing
            // starting the consumer will add the subscription
            that._startConn(doPublish);
            return;
         }
         // the kafka consumer is already running
         // just add the new subscriptions before publishing
         that.addKafkaSubscriptions([{topic: pubtopic}], function(){
             debug("publish route 4");
             doPublish();
         });
     };
  this.createTopics(pubtopic, createTopicCallback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();
  var that = this;
  // kafka cannot send a null message. Why are messages missing in the tests...
  if(message === undefined || message === null){
    message = '';
  }
  var pubtopic = this._pubTopic(topic);
  var doPublish = function(){
    var payload = {
      messages: message,
      topic: pubtopic
    };
    debug("about to publish new message to ",pubtopic);
    that._producer.send([payload], function(err,data) {
      if(err){
        debug("something went wrong publishing to "+pubtopic,err);
        that.emit("error",err);
      }else{
        debug("new message published to " + pubtopic);
      }
      util.wrap(done)();
    });
  };

  if(this._knowntopics.indexOf(pubtopic) &gt;= 0){
     //we already know about this topic, so publish to it and we're done.
     doPublish();
     return;
  }

  // it's a new topic for kafka
  var createTopicCallback = function(err){
         if(err){
            debug("problem creating topic",err);
            that.emit("error",err);
            return;
         }
         //do subscribers await this new topic?
         var wanted = that._subs_matcher.match(pubtopic);
         if(wanted.length === 0){
             // nobody subscribed at our end, so just publish to kafka
             doPublish();
             return;
         }
         // somebody wants messages published to the new topic
         for(var i=0;i&lt;wanted.length;i++){
            that._subs_counter.add(pubtopic);
         }
         if(that._consumer === undefined){
            // start the kafka consumer before publishing
            // starting the consumer will add the subscription
            that._startConn(doPublish);
            return;
         }
         // the kafka consumer is already running
         // just add the new subscriptions before publishing
         that.addKafkaSubscriptions([{topic: pubtopic}], function(){
             debug("publish route 4");
             doPublish();
         });
     };
  this.createTopics(pubtopic, createTopicCallback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.readZkTopics" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.readZkTopics">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>readZkTopics
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readZkTopics(callback){
  var that = this;
  this._raiseIfClosed();
   this._producerClient.zk.client.getChildren("/config/topics", function (error, children, stats) {
     if (error) {
         callback(error,null);
         return;
     }
     callback(null,children);
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, onMessageReceived, done) {
  this._raiseIfClosed();
  var that = this;
  if(this._consumerStarting){
     debug("waiting for consumer_connected before subscribing");
     this.on("consumer_connected",function(){ that.subscribe(topic,onMessageReceived,done); });
     return;
  }

  debug("subscribe called for ",topic);
  var subtopic = this._subTopic(topic);
  this._subs_matcher.add(subtopic,'x');
  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,'wanted');
  var subscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&lt;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &gt; 0){
      if(!(that._subs_counter.include(top))){
        subscribe_topics.push({topic: top});
      }
      that._subs_counter.add(top);
    }
  }

  this._ascoltatore.subscribe(topic, onMessageReceived);
  if(subscribe_topics.length === 0){
     defer(done);
     return;
  }

  if(this._consumer === undefined){
    this._startConn(done);
    return;
  }

  this.addKafkaSubscriptions(subscribe_topics, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, onMessageReceived, done) {
  this._raiseIfClosed();
  var that = this;
  if(this._consumerStarting){
     debug("waiting for consumer_connected before subscribing");
     this.on("consumer_connected",function(){ that.subscribe(topic,onMessageReceived,done); });
     return;
  }

  debug("subscribe called for ",topic);
  var subtopic = this._subTopic(topic);
  this._subs_matcher.add(subtopic,'x');
  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,'wanted');
  var subscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&lt;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &gt; 0){
      if(!(that._subs_counter.include(top))){
        subscribe_topics.push({topic: top});
      }
      that._subs_counter.add(top);
    }
  }

  this._ascoltatore.subscribe(topic, onMessageReceived);
  if(subscribe_topics.length === 0){
     defer(done);
     return;
  }

  if(this._consumer === undefined){
    this._startConn(done);
    return;
  }

  this.addKafkaSubscriptions(subscribe_topics, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  var that = this;

  var subtopic = this._subTopic(topic);

  var newDone = function() {
    debug("deregistered subscriber for topic " + subtopic);
    defer(done);
  };

  this._subs_matcher.remove(subtopic);
  this._ascoltatore.unsubscribe(topic, callback);
  if(this._consumerClient === undefined){
    newDone();
    return;
  }

  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,'unwanted');
  var unsubscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&lt;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &gt; 0){
      that._subs_counter.remove(top);
      if(!(that._subs_counter.include(top))){
        unsubscribe_topics.push({topic: top});
      }
    }
  }

  if(unsubscribe_topics.length === 0 ) {
    newDone();
    return;
  }

  debug("deregistering subscriber for topic " + unsubscribe_topics);
  this.withTopicPartitionsExpanded(this._consumerClient,unsubscribe_topics,function(err,partitions){
      if(err){
        debug("problem expanding topics before unsubscribe",err);
        that.emit("error",err);
        return;
      }
      that._consumer.removeTopics(partitions,function(err,removed){
          if(err){
            debug("problem removing topics",err);
            that.emit("error",err);
            return;
          }
          newDone();
       });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  var that = this;

  var subtopic = this._subTopic(topic);

  var newDone = function() {
    debug("deregistered subscriber for topic " + subtopic);
    defer(done);
  };

  this._subs_matcher.remove(subtopic);
  this._ascoltatore.unsubscribe(topic, callback);
  if(this._consumerClient === undefined){
    newDone();
    return;
  }

  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,'unwanted');
  var unsubscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&lt;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &gt; 0){
      that._subs_counter.remove(top);
      if(!(that._subs_counter.include(top))){
        unsubscribe_topics.push({topic: top});
      }
    }
  }

  if(unsubscribe_topics.length === 0 ) {
    newDone();
    return;
  }

  debug("deregistering subscriber for topic " + unsubscribe_topics);
  this.withTopicPartitionsExpanded(this._consumerClient,unsubscribe_topics,function(err,partitions){
      if(err){
        debug("problem expanding topics before unsubscribe",err);
        that.emit("error",err);
        return;
      }
      that._consumer.removeTopics(partitions,function(err,removed){
          if(err){
            debug("problem removing topics",err);
            that.emit("error",err);
            return;
          }
          newDone();
       });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicOffsetsAdded" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicOffsetsAdded">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicOffsetsAdded
        <span class="apidocSignatureSpan">(client, topics, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function withTopicOffsetsAdded(client, topics, callback){
     var that = this;
     this.withTopicPartitionsExpanded(client, topics, function(err, partitions){
       if(err){
           callback(err,null);
           return;
       }
       for(var i=0;i&lt;partitions.length;i++){
          partitions[i].time = -1;
          partitions[i].maxNum = 1;
       }
       var kafka = that._opts.kafka;
       var offset = new kafka.Offset(client);
       offset.fetch(partitions, function (err, data) {
           if(err){
             callback(err,null);
             return;
           }
           var offsets = [];
           for (var topic in data) {
             if (data.hasOwnProperty(topic)) {
                for(var partition in data[topic]){
                   if(data[topic].hasOwnProperty(partition)){
                      offsets.push({topic: topic, partition: parseInt(partition), offset: data[topic][partition][0]});
                   }
                }
             }
           }
           callback(null,offsets);
       });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicPartitionsExpanded" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicPartitionsExpanded">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicPartitionsExpanded
        <span class="apidocSignatureSpan">(client, topics, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function withTopicPartitionsExpanded(client, topics, callback){
  var that = this;
  var wanted = [];
  topics.forEach(function(t){
     wanted.push(t.topic);
  });
  client.loadMetadataForTopics(wanted, function(err, results) {
       if(err){
          callback(err,null);
          return;
       }
       var metadata = results[1].metadata;
       var partitions = [];
       for(var i=0;i&lt;topics.length;i++){
           var topic = topics[i].topic;
           if (topic in metadata){
             var dictionary = metadata[topic];
             for (var key in dictionary) {
               if (dictionary.hasOwnProperty(key)) {
                  partitions.push({topic: topic, partition: dictionary[key].partition, time: -1, maxNum: 1});
               }
             }
           }
       }
       callback(null,partitions);
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MQTTAscoltatore" id="apidoc.module.ascoltatori.MQTTAscoltatore">module ascoltatori.MQTTAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.MQTTAscoltatore" id="apidoc.element.ascoltatori.MQTTAscoltatore.MQTTAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MQTTAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '/',
    wildcardOne: '+',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.mqtt = this._opts.mqtt || require("mqtt");

  this._subs_counter = new SubsCounter();

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MQTTAscoltatore.prototype" id="apidoc.module.ascoltatori.MQTTAscoltatore.prototype">module ascoltatori.MQTTAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function () {
  var that = this;
  var url = that._opts.url;
  var settings = null;

  if (this._client === undefined) {
    debug("connecting..");
    if (url) {
      this._client = this._opts.mqtt.connect(url, that._opts);
    } else {
      this._client = this._opts.mqtt.connect(that._opts);
    }

    this._client.setMaxListeners(0);
    this._client.on("connect", function() {
      debug("connected");
      that.reconnectTopics(function(){
        that.emit("ready");
      });
    });
    this._client.on("message", function(topic, payload, packet) {
      debug("received new packet on topic " + topic);
      // we need to skip out this callback, so we do not
      // break the client when an exception occurs
      defer(function() {
        that._ascoltatore.publish(that._recvTopic(topic), payload, packet);
      });
    });
    this._client.on('error', function(e) {
      debug("error in the client");

      delete that._client;
      that.emit("error", e);
    });
  }
  return this._client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.close" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;
  debug("closing");
  if (!this._closed) {
    this._subs_counter.clear();
    this._client.once("close", function() {
      debug("closed");
      that._ascoltatore.close();
      delete that._client;
      that.emit("closed");
      defer(done);
    });
    this._client.end();
  } else {
    wrap(done)();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  this._client.publish(this._pubTopic(topic), message, {
    qos: (options &amp;&amp; (options.qos !== undefined)) ? options.qos : 1,
    retain: (options &amp;&amp; (options.retain !== undefined)) ? options.retain : false
  }, function() {
    debug("new message published to " + topic);
    wrap(done)();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  this._client.publish(this._pubTopic(topic), message, {
    qos: (options &amp;&amp; (options.qos !== undefined)) ? options.qos : 1,
    retain: (options &amp;&amp; (options.retain !== undefined)) ? options.retain : false
  }, function() {
    debug("new message published to " + topic);
    wrap(done)();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.reconnectTopics" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.reconnectTopics">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>reconnectTopics
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reconnectTopics(cb) {
  var that = this;

  var subscribedTopics = that._subs_counter.keys();

  var opts = {
    qos: 1
  };

  steed.each(subscribedTopics, function(topic, callback) {
    that._client.subscribe(that._subTopic(topic), opts, function() {
      debug("re-registered subscriber for topic " + topic);
      callback();
    });
  }, function(){
    cb();
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  if (!this._subs_counter.include(topic)) {
    debug("registering new subscriber for topic " + topic);

    var opts = {
      qos: 1
    };
    this._client.subscribe(this._subTopic(topic), opts, function() {
      debug("registered new subscriber for topic " + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);
  this._ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  if (!this._subs_counter.include(topic)) {
    debug("registering new subscriber for topic " + topic);

    var opts = {
      qos: 1
    };
    this._client.subscribe(this._subTopic(topic), opts, function() {
      debug("registered new subscriber for topic " + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);
  this._ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = null;

  newDone = function() {
    debug("deregistered subscriber for topic " + topic);
    defer(done);
  };

  this._ascoltatore.unsubscribe(topic, callback);
  this._subs_counter.remove(topic);

  if (this._subs_counter.include(topic)) {
    newDone();
    return;
  }

  debug("deregistering subscriber for topic " + topic);
  this._client.unsubscribe(this._subTopic(topic), newDone);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = null;

  newDone = function() {
    debug("deregistered subscriber for topic " + topic);
    defer(done);
  };

  this._ascoltatore.unsubscribe(topic, callback);
  this._subs_counter.remove(topic);

  if (this._subs_counter.include(topic)) {
    newDone();
    return;
  }

  debug("deregistering subscriber for topic " + topic);
  this._client.unsubscribe(this._subTopic(topic), newDone);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MongoAscoltatore" id="apidoc.module.ascoltatori.MongoAscoltatore">module ascoltatori.MongoAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.MongoAscoltatore" id="apidoc.element.ascoltatori.MongoAscoltatore.MongoAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MongoAscoltatore = function (opts) {
  AbstractAscoltatore.call(this);

  if (typeof opts.db === 'string' || opts.uri) {
    // old options
    opts.uri = opts.uri || 'mongodb://127.0.0.1/';
    opts.db = opts.db || 'ascoltatori';
    opts.url = opts.uri + opts.db + '?auto_reconnect=true';
    delete opts.db;
  }

  this._opts = opts || {};
  this.url = this._opts.url || 'mongodb://127.0.0.1/ascoltatori?auto_reconnect=true';
  this._pubsubCollection = opts.pubsubCollection || 'pubsub';
  this._maxRetry = opts.maxRetry || 5;
  this.mongoOpts = this._opts.mongo || {};

  this._ascoltatore = new TrieAscoltatore(opts);

  this.channels = {};
  this._closed = false;

  this._handlingCursorFailure = false;
  this._lastSuccessfulHandling = new ObjectID();

  this.wait = this._opts.wait || 100;

  this.connectionParams = {
    capped: true,
    size: this._opts.size || 10 * 1024 * 1024, // 10 MB
    max: this._opts.max || 10000 // documents
  };

  var that = this;

  var setupDB = function(err, db) {
    if (err) {
      that.emit('error', err);
      return;
    }

    that.db = db;

    // creating the capped collection where we can exchange messages
    that.db.createCollection(that._pubsubCollection, that.connectionParams, function(err, collection) {
      if (err) {
        that.emit('error', err);
      } else&nbsp; {
        that.collection = collection;

        debug('ready');

        // create a new object id. We will get all the events from now on
        that._poll(new ObjectID());

        that.emit('ready');
      }
    });
  };

  if (opts.db) {
    setupDB(null, opts.db);
  } else {
    MongoClient.connect(this.url, this.mongoOpts, setupDB);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MongoAscoltatore.prototype" id="apidoc.module.ascoltatori.MongoAscoltatore.prototype">module ascoltatori.MongoAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._checkCappedAndPoll" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._checkCappedAndPoll">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_checkCappedAndPoll
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_checkCappedAndPoll = function (latest) {
  debug('checkCappedAndPoll');
  var that = this;
  this.collection.isCapped(function(err, isCapped) {
    if (err) {
      debug('checkCappedAndPoll -&gt; Cannot stat isCapped. Give up');
      that.emit('error', new Error('Cannot stat if collection is capped or not'));
      that._handlingCursorFailure = false;
      return;
    }
    if (!isCapped) {
      debug('checkCappedAndPoll -&gt; Collection is not capped. Give up');
      that.emit('error', new Error('Cannot recover. Collection is not capped.'));
      that._handlingCursorFailure = false;
    } else {
      debug('checkCappedAndPoll -&gt; Capped Ok. Poll.');
      that._poll(latest);
      that._handlingCursorFailure = false;
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._disconnected" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._disconnected">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_disconnected
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_disconnected = function () {
  return this.db.db.state === 'disconnected';
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handle" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._handle">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handle
        <span class="apidocSignatureSpan">(die, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_handle = function (die, callback) {

  debug('handle');

  var that = this;

  return function() {
    if (that._disconnected()) {
      debug('disconnected');
      return;
    }

    var args = [].slice.call(arguments),
      err = args.shift();

    if (err &amp;&amp; !that._closed) {
      that._handleCursorClosed(that._lastSuccessfulHandling);
      return;
    }

    if (err &amp;&amp; die) {
      debug('ERROR: ' + err);
      return;
    }

    debug('handle -&gt; calling the callback');
    callback.apply(that, args);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handleCursorClosed" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._handleCursorClosed">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handleCursorClosed
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_handleCursorClosed = function (latest) {
  debug('handleCursorClosed');
  if (this._closed !== false) {
    // Handle cursor closed. But we're closed actually. Do nothing
    return;
  }
  if (this._handlingCursorFailure !== false) {
    // Already handling this failure
    return;
  }
  var that = this;

  this._handlingCursorFailure = true;

  // Kind of hacky solution, I would prefer catch some mongo events
  // but unfortunately...
  var retry = 0;
  var reconnect = function () {
    debug('handleCursorClosed -&gt; Wait for the database to be connected...');
    that.db.db(that.db.databaseName).stats({}, function (err, stats) {
      var success = true;
      if (err) {
        debug('handleCursorClosed -&gt; Stats failed: ' + err);
        success = false;
      } else if (!stats.ok) {
        debug('handleCursorClosed -&gt; Stats says that DB is not ok : ' + stats);
        success = false;
      }
      if (success === false) {
        retry++;
        debug('handleCursorClosed -&gt; Handle cursor failed: retry #' + retry);
        if (retry &lt; that._maxRetry) {
          setTimeout(reconnect, 5000);
        } else {
          that.emit('error', new Error('Mongo is out of order'));
          that._handlingCursorFailure = false;
        }
      } else {
        debug("handleCursorClosed -&gt;  We're now ready. Poll.");
        that._checkCappedAndPoll(latest);
      }
    });
  };

  reconnect();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._more" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._more">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_more
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_more = function (latest) {
  var that = this;

  debug('more');

  that._cursor.each(that._handle(true, function(doc) {

    var value;

    if (!doc) {
      debug('setting the subscriber polling');
      that._pollTimeout = setTimeout(function() {
        that._poll(latest);
      }, that.wait);
      return;
    }

    debug('calling the subscriber callback');

    latest = latest &gt; doc._id ? latest: doc._id;
    that._lastSuccessfulHandling = latest;

    if (!that._closed) {
      if (doc.value &amp;&amp; doc.value.buffer) {
        value = doc.value.buffer;
      } else {
        value = doc.value;
      }

      that._ascoltatore.publish(doc.topic, value, doc.options);
    }
  }));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._poll" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._poll">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_poll
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_poll = function (latest) {
  debug('poll');

  var options = {
    tailable: true,
    awaitdata: true,
    numberOfRetries: -1
  };

  this._cursor = this.collection.find({ _id: { $gt: latest } }, options);

  // we have created only the cursor, now take a look at the messages arrived until now
  this._more(latest);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.close" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;
  var closeEmbedded = function() {
    that._ascoltatore.close(function() {
      that.emit("closed");
      if (done) {
        done();
      }
    });
  };

  if (this._pollTimeout) {
    clearTimeout(this._pollTimeout);
  }

  that._closed = true;

  steed.series([
    function(cb) {
      if (that._cursor) {
        that._cursor.close(cb);
        delete that._cursor;
      } else {
        cb();
      }
    },
    function(cb) {
      that.db.close(cb);
    }
  ], closeEmbedded);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done) {
  this._raiseIfClosed();
  message = message || "";
  done = done || function() {};

  var messageObj = {
    value: message,
    topic: topic,
    options: options
  };

  debug('publishing message', messageObj);

  this.collection.insert(messageObj, { w: 1 }, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done) {
  this._raiseIfClosed();
  message = message || "";
  done = done || function() {};

  var messageObj = {
    value: message,
    topic: topic,
    options: options
  };

  debug('publishing message', messageObj);

  this.collection.insert(messageObj, { w: 1 }, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sub = function (topic, callback, done) {
  this._raiseIfClosed();

  debug('subscribe');
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done) {
  this._raiseIfClosed();

  debug('subscribe');
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function () {
  this._raiseIfClosed();
  this._ascoltatore.unsubscribe.apply(this._ascoltatore, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function () {
  this._raiseIfClosed();
  this._ascoltatore.unsubscribe.apply(this._ascoltatore, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.PrefixAscoltatore" id="apidoc.module.ascoltatori.PrefixAscoltatore">module ascoltatori.PrefixAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.PrefixAscoltatore" id="apidoc.element.ascoltatori.PrefixAscoltatore.PrefixAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
        <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrefixAscoltatore(prefix, ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore || new TrieAscoltatore());

  this._prefix = prefix;
  this._separator = this._ascoltatore._separator;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Klass = (typeof opts.type === 'function') ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">PrefixAscoltatore</span>(opts.prefix, result)
    .once("error", done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once("error", done);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.PrefixAscoltatore.prototype" id="apidoc.module.ascoltatori.PrefixAscoltatore.prototype">module ascoltatori.PrefixAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._localToParent" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype._localToParent">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_localToParent
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_localToParent = function (topic) {
  var newTopic = this._prefix;
  newTopic += (topic.indexOf(this._separator) !== 0) ? this._separator : '';
  newTopic += topic;
  debug("rewriting local topic " + topic + " into " + newTopic);
  return newTopic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._parentToLocal" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype._parentToLocal">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_parentToLocal
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_parentToLocal = function (topic) {
  var newTopic;
  if (topic.lastIndexOf(this._prefix + this._separator, 0) === 0) {
    newTopic = topic.substr(this._prefix.length + 1);
  } else {
    newTopic = topic;
  }
  debug("rewriting remote topic " + topic + " into " + newTopic);
  return newTopic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapCallback" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapCallback">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapCallback
        <span class="apidocSignatureSpan">(callback, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapCallback = function (callback, next) {
  var that = this;
  if (!callback._prefix_ascoltatore_wrapper) {
    callback._prefix_ascoltatore_wrapper = function(t, payload, options) {
      callback(that._parentToLocal(t), payload, options);
    };
  }
  next(null, callback._prefix_ascoltatore_wrapper);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapTopic" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapTopic">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapTopic
        <span class="apidocSignatureSpan">(topic, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapTopic = function (topic, next) {
  next(null, this._localToParent(topic));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.RedisAscoltatore" id="apidoc.module.ascoltatori.RedisAscoltatore">module ascoltatori.RedisAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.RedisAscoltatore" id="apidoc.element.ascoltatori.RedisAscoltatore.RedisAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '/',
    wildcardOne: '*',
    wildcardSome: '*'
  });

  this._ready_sub = false;
  this._ready_pub = false;
  this._opts = opts || {};

  this._ascoltatores = {};

  this._startSub();
  this._startPub();

  this._subs_counter = new SubsCounter();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.RedisAscoltatore.prototype" id="apidoc.module.ascoltatori.RedisAscoltatore.prototype">module ascoltatori.RedisAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._containsWildcard" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._containsWildcard">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_containsWildcard
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_containsWildcard = function (topic) {
  return (topic.indexOf(this._wildcardOne) &gt;= 0) ||
         (topic.indexOf(this._wildcardSome) &gt;= 0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startPub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._startPub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startPub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startPub = function () {
  var that = this;
  if (this._client === undefined) {
    this._client = createConn(this._opts, 'client_conn');
    this._client.on("ready", function() {
      debug("created pub connection");
      that._updateReady("_ready_pub");
    });
  }
  return this._client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startSub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._startSub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startSub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startSub = function () {
  var that = this,
    handler = null;

  if (this._sub === undefined) {
    this._sub = createConn(this._opts, 'sub_conn');
    this._sub.on("ready", function() {
      debug("created sub connection");
      that._updateReady("_ready_sub");
    });

    handler = function(sub, topic, payload) {
      topic = topic.toString(); // cast to string in case of Buffer instance (nodejs-redis &gt;=2.0)
      debug("new message received for topic " + topic);
      defer(function() {
        // we need to skip out this callback, so we do not
        // break the client when an exception occurs
        var ascoltatore = that._ascoltatores[sub];
        topic = topic.replace(new RegExp('/$'), '');
        topic = that._recvTopic(topic);

        payload = msgpack.decode(payload);

        if (ascoltatore) {
          ascoltatore.publish(topic, payload.message, payload.options);
        } else {
          debug("no ascoltatore for subscription: " + sub);
        }
      });
    };

    this._sub.on("messageBuffer", function (topic, message) {
      handler(topic, topic, message);
    });
    this._sub.on("pmessageBuffer", function(sub, topic, message) {
      handler(sub, topic, message);
    });
  }

  return this._sub;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._updateReady" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._updateReady">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_updateReady
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateReady(key) {
  this[key] = true;
  if (this._ready_pub &amp;&amp; this._ready_sub) {
    this.emit("ready");
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.close" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this,
    newDone = null,
    closes = 2;

  newDone = function() {
    debug("closed");
    defer(done);
  };

  if (this._closed) {
    newDone();
    return;
  }

  this._subs_counter.clear();
  ["_sub", "_client"].forEach(function(c) {
    if (that[c] !== undefined) {
      that[c].on("end", function() {
        closes = closes - 1;
        if (closes === 0) {
          newDone();
        }
      });
      that[c].quit();
      delete that[c];
    } else {
      closes = closes - 1;
    }
  });

  for (var subTopic in this._ascoltatores) {
    this._ascoltatores[subTopic].close();
  }
  this._ascoltatores = {};

  this.emit("closed");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  if (message === undefined || message === null) {
    message = false; // so we can convert it to JSON
  }

  var payload = {
    message: message,
    options: options
  };

  topic = this._pubTopic(topic);

  if (!topic.match(new RegExp('/$'))) {
    topic += '/';
  }

  this._client.publish(topic, msgpack.encode(payload), function() {
    debug("new message published to " + topic);
    defer(done);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  if (message === undefined || message === null) {
    message = false; // so we can convert it to JSON
  }

  var payload = {
    message: message,
    options: options
  };

  topic = this._pubTopic(topic);

  if (!topic.match(new RegExp('/$'))) {
    topic += '/';
  }

  this._client.publish(topic, msgpack.encode(payload), function() {
    debug("new message published to " + topic);
    defer(done);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = function() {
    debug("registered new subscriber for topic " + topic);
    defer(done);
  };

  var subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp('[/*]$'))) {
    subTopic += '/';
  }

  if (this._containsWildcard(topic)) {
    this._sub.psubscribe(subTopic, newDone);
  } else {
    this._sub.subscribe(subTopic, newDone);
  }

  debug("redis subscription topic is " + subTopic);
  this._subs_counter.add(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (!ascoltatore) {
    ascoltatore = this._ascoltatores[subTopic] = new TrieAscoltatore(this._opts);
  }

  ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = function() {
    debug("registered new subscriber for topic " + topic);
    defer(done);
  };

  var subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp('[/*]$'))) {
    subTopic += '/';
  }

  if (this._containsWildcard(topic)) {
    this._sub.psubscribe(subTopic, newDone);
  } else {
    this._sub.subscribe(subTopic, newDone);
  }

  debug("redis subscription topic is " + subTopic);
  this._subs_counter.add(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (!ascoltatore) {
    ascoltatore = this._ascoltatores[subTopic] = new TrieAscoltatore(this._opts);
  }

  ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var isWildcard = this._containsWildcard(topic),
      subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp('[/*]$'))) {
    subTopic += '/';
  }

  this._subs_counter.remove(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (ascoltatore) {
    ascoltatore.unsubscribe(topic, callback);
  }

  var newDone = function() {
    debug("deregistered subscriber for topic " + topic);
    defer(done);
  };

  if (this._subs_counter.include(subTopic)) {
    newDone();
    return this;
  }

  if (ascoltatore) {
    ascoltatore.close();
    delete this._ascoltatores[subTopic];
  }

  if (isWildcard) {
    this._sub.punsubscribe(subTopic, newDone);
  } else {
    this._sub.unsubscribe(subTopic, newDone);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var isWildcard = this._containsWildcard(topic),
      subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp('[/*]$'))) {
    subTopic += '/';
  }

  this._subs_counter.remove(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (ascoltatore) {
    ascoltatore.unsubscribe(topic, callback);
  }

  var newDone = function() {
    debug("deregistered subscriber for topic " + topic);
    defer(done);
  };

  if (this._subs_counter.include(subTopic)) {
    newDone();
    return this;
  }

  if (ascoltatore) {
    ascoltatore.close();
    delete this._ascoltatores[subTopic];
  }

  if (isWildcard) {
    this._sub.punsubscribe(subTopic, newDone);
  } else {
    this._sub.unsubscribe(subTopic, newDone);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.SubsCounter" id="apidoc.module.ascoltatori.SubsCounter">module ascoltatori.SubsCounter</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.SubsCounter" id="apidoc.element.ascoltatori.SubsCounter.SubsCounter">
        function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SubsCounter() {
  this.clear();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.SubsCounter.prototype" id="apidoc.module.ascoltatori.SubsCounter.prototype">module ascoltatori.SubsCounter.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.add" id="apidoc.element.ascoltatori.SubsCounter.prototype.add">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>add
        <span class="apidocSignatureSpan">(elem)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (elem) {
  if (!this.include(elem)) {
    this._length += 1;
    this._obj[elem] = 1;
  } else {
    this._obj[elem] = this._obj[elem] + 1;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.clear" id="apidoc.element.ascoltatori.SubsCounter.prototype.clear">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>clear
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clear = function () {
  this._length = 0;
  this._obj = {};
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.forEach" id="apidoc.element.ascoltatori.SubsCounter.prototype.forEach">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>forEach
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forEach = function (callback) {
  var key = null;
  for (key in this._obj) {
    if (this._obj.hasOwnProperty(key)) {
      callback(key);
    }
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.include" id="apidoc.element.ascoltatori.SubsCounter.prototype.include">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>include
        <span class="apidocSignatureSpan">(elem)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">include = function (elem) {
  return this._obj[elem] !== undefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.keys" id="apidoc.element.ascoltatori.SubsCounter.prototype.keys">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>keys
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">keys = function () {
  var array = [];
  this.forEach(function(e) {
    array.push(e);
  });
  return array;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.remove" id="apidoc.element.ascoltatori.SubsCounter.prototype.remove">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>remove
        <span class="apidocSignatureSpan">(elem)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">remove = function (elem) {
  if (!this.include(elem)) {
    return this;
  }

  if (this._obj[elem] === 1) {
    this._length -= 1;
    delete this._obj[elem];
  } else {
    this._obj[elem] = this._obj[elem] - 1;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.TrieAscoltatore" id="apidoc.module.ascoltatori.TrieAscoltatore">module ascoltatori.TrieAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.TrieAscoltatore" id="apidoc.element.ascoltatori.TrieAscoltatore.TrieAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TrieAscoltatore(settings) {
  AbstractAscoltatore.call(this, settings);

  settings = settings || {};

  this._matcher = new Qlobber({
    separator: settings.separator || '/',
    wildcard_one: settings.wildcardOne || '+',
    wildcard_some: settings.wildcardSome || '*'
  });

  this.emit("ready");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.TrieAscoltatore.prototype" id="apidoc.module.ascoltatori.TrieAscoltatore.prototype">module ascoltatori.TrieAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.close" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  this._matcher.clear();
  this.emit("closed");

  debug("closed");

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug("new message published to " + topic);

  var cbs = this._matcher.match(topic);

  for (var i = 0; i &lt; cbs.length; i++) {
    cbs[i](topic, message, options);
  }

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug("new message published to " + topic);

  var cbs = this._matcher.match(topic);

  for (var i = 0; i &lt; cbs.length; i++) {
    cbs[i](topic, message, options);
  }

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("registered new subscriber for topic " + topic);

  this._matcher.add(topic, callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("registered new subscriber for topic " + topic);

  this._matcher.add(topic, callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug("deregistered subscriber for topic " + topic);

  this._matcher.remove(topic, callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug("deregistered subscriber for topic " + topic);

  this._matcher.remove(topic, callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore" id="apidoc.module.ascoltatori.ZeromqAscoltatore">module ascoltatori.ZeromqAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.ZeromqAscoltatore" id="apidoc.element.ascoltatori.ZeromqAscoltatore.ZeromqAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ZeromqAscoltatore(opts) {
  AbstractAscoltatore.call(this);

  this._opts = opts || {};
  this._opts.delay = this._opts.delay || 5;
  this._opts.zmq = this._opts.zmq || require("zmq");

  this._connectedControls = [];

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startSubs();
  this._startPub();
  this._startControl();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore.prototype" id="apidoc.module.ascoltatori.ZeromqAscoltatore.prototype">module ascoltatori.ZeromqAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._connectSub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._connectSub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_connectSub
        <span class="apidocSignatureSpan">(port, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_connectSub = function (port, callback) {
  var that = this,
    conn = createConn(that._opts, "sub");

  port = String(port);

  debug("connecting to port " + port);
  conn.port = port;
  conn.connect(port);
  conn.subscribe("");
  that._sub_conns.push(conn);

  conn.on("message", function(data) {
    data = data.toString();
    var topic = null,
      message = null;

    topic = data.substr(0, data.indexOf(" "));
    message = data.substr(data.indexOf(" ") + 1);

    that._ascoltatore.publish(topic, message);

    debug("new message received for topic " + topic);
  });

  setTimeout(function() {
    debug("connected and subscribed to " + port);
    defer(callback);
  }, this._opts.delay);

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startControl" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startControl">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startControl
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startControl = function () {
  var that = this;
  if (that._control_conn === undefined) {
    that._control_conn = createConn(that._opts, "req");
    debug("opening control port " + that._opts.controlPort);
    that._control_conn.bind(that._opts.controlPort, function(err) {
      if (err) {
        throw err;
      }

      debug("bound the control connection to port " + that._opts.controlPort);

      that._control_conn_interval = setInterval(function() {
        var packet = that._sub_conns.map(function(c) {
          return c.port;
        }).join(",");
        debug("sending control packet " + packet);
        that._control_conn.send(packet);
      }, 250);

      that._control_conn.on("message", function(data) {
        var dest = String(data);
        debug("received connect response from " + dest);
        if (that._sub_conns.findIndex(function (conn) {
          return conn.port === dest;
        }) === -1) {
          that._connectSub(dest);
        }
      });
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startPub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startPub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startPub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startPub = function () {
  var that = this;
  if (that._pub_conn === undefined) {
    that._pub_conn = createConn(that._opts, "pub");
    debug("opening pub port " + that._opts.port);
    that._pub_conn.bind(that._opts.port, function(err) {
      if (err) {
        throw err;
      }

      debug("bound the publish connection to port " + that._opts.port);

      setTimeout(function() {
        that._connectSub(that._opts.port, function() {
          that.emit("ready");
        });
      }, that._opts.delay);
    });
  }
  return that._pub_conn;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startSubs" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startSubs">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startSubs
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startSubs = function () {
  var that = this;
  if (this._sub_conns === undefined) {
    that._sub_conns = [];
    that._opts.remotePorts = that._opts.remotePorts || [];
    that._opts.remotePorts.forEach(function(port) {
      that.connect(port);
    });
  }
  return this._sub_conns;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.close" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;

  if (this._closed) {
    defer(done);
    return;
  }

  if (that._sub_conns !== undefined) {
    that._sub_conns.forEach(function(s) {
      s.close();
    });
    delete that._sub_conns;
  }

  that._connectedControls.forEach(function(s) {
    s.close();
  });

  if (that._pub_conn !== undefined) {
    that._pub_conn.close();
    delete that._pub_conn;
  }

  if (that._control_conn !== undefined &amp;&amp; that._control_conn._zmq.state === 0) {
    that._control_conn.close();
    clearInterval(that._control_conn_interval);
    delete that._control_conn_interval;
  }

  setTimeout(function() {
    debug("closed");
    that._ascoltatore.close();
    that.emit("closed");
    defer(done);
  }, this._opts.delay);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it("should have a close function", function() {
  var that = this;
  expect(that.instance).to.respondTo("close");
});

it("should throw an error if publishing when the ascoltatore has been closed", function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish("hello", "world");
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.connect" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.connect">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>connect
        <span class="apidocSignatureSpan">(port, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function connect(port, callback) {
  var that = this,
    conn = null;

  conn = createConn(that._opts, "rep");

  conn.connect(port);

  that._connectedControls.push(conn);

  conn.on("message", function(data) {
    debug("received connect request from " + data);
    conn.send(that._opts.port);

    var dests = String(data).split(",").filter(function(dest) {
      var found = true;
      that._sub_conns.forEach(function(conn) {
        if (conn.port === dest) {
          found = false;
        }
      });
      return found;
    }).map(function(dest) {
      return function(cb) {
        that._connectSub(dest, cb);
      };
    });

    steed.parallel(dests, function() {
      setTimeout(function() {
        wrap(callback)();
      }, that._opts.delay);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

It is also possible to reuse an existing mongodb connection:

```javascript
var ascoltatori = require('ascoltatori');
var MongoClient = require('mongodb').MongoClient;

MongoClient.<span class="apidocCodeKeywordSpan">connect</span>('mongodb://127.0.0.1/ascoltatori', {}, function (err, db
) {
var settings = {
  type: 'mongo',
  db: db,
  pubsubCollection: 'ascoltatori'
};
ascoltatori.build(settings, function (err, ascoltatore) {
  // ...
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  var toSend = topic + " " + message;

  this._pub_conn.send(toSend);
  debug("new message published to " + topic);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.sub("hello", wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  var toSend = topic + " " + message;

  this._pub_conn.send(toSend);
  debug("new message published to " + topic);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe('hello', function() {
    console.log(arguments);
    // { '0': 'hello', '1': 'a message' }
  });

  // publishes a message to the topic 'hello'
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>('hello', 'a message', function() {
    console.log('message published');
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("registered new subscriber for topic " + topic);
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe("hello", wrap(done), function() {
    that.instance.publish("hello");
  });
});

it("should support 'pub/sub' combination for pub/sub", function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>("hello", wrap(done), function() {
    that.instance.pub("hello");
  });
});

it("should not raise an exception if pub is called without a done callback", function(done) {
  this.instance.pub("hello");
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("registered new subscriber for topic " + topic);
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});

// publishes a message to the topic 'hello'
ascoltatore.publish('hello', 'a message', function() {
  console.log('message published');
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("deregistered subscriber for topic " + topic);
  this._ascoltatore.unsubscribe(topic, callback);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub("hello/*/there", callback2, function () {
    that.instance.sub("hello/+/there", callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>("hello/*/there", callback2, function () {
        that.instance.pub("hello/42/there");
      });
    });
  });
});

it("should call each matching callback", function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug("deregistered subscriber for topic " + topic);
  this._ascoltatore.unsubscribe(topic, callback);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.ascoltatori" id="apidoc.module.ascoltatori.ascoltatori">module ascoltatori.ascoltatori</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.AMQPAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.AMQPAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '.',
    wildcardOne: '*',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require("amqp");
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.AMQPLibAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.AMQPLibAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPLibAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPLibAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '.',
    wildcardOne: '*',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require("amqplib/callback_api");
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.AbstractAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.AbstractAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AbstractAscoltatore
        <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbstractAscoltatore(settings, nativeSettings) {
  EventEmitter.call(this);

  settings = settings || {};
  nativeSettings = nativeSettings || {};

  this._separator = settings.separator || '/',
  this._wildcardOne = settings.wildcardOne || '+',
  this._wildcardSome = settings.wildcardSome || '*';
  this._nativeSettings = nativeSettings;

  if (nativeSettings.separator &amp;&amp;
      (this._separator !== nativeSettings.separator)) {
    this._reInSeparator = new RegExp('\\' + this._separator, 'g');
    this._reOutSeparator = new RegExp('\\' + nativeSettings.separator, 'g');
  }
  if (nativeSettings.wildcardOne &amp;&amp;
      (this._wildcardOne !== nativeSettings.wildcardOne)) {
    this._reInWildcardOne = new RegExp('\\' + this._wildcardOne, 'g');
  }
  if (nativeSettings.wildcardSome &amp;&amp;
      (this._wildcardSome !== nativeSettings.wildcardSome)) {
    this._reInWildcardSome = new RegExp('\\' + this._wildcardSome, 'g');
  }

  this._setPublish();

  this._ready = false;
  this._closed = false;

  var that = this;

  this.on("ready", function() {
    that._ready = true;
  });

  this.on("closed", function() {
    that._closed = true;
  });

  this.on("newListener", function(event, listener) {
    if (event === "ready" &amp;&amp; that._ready) {
      listener();
    }
  });

  this.setMaxListeners(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.DecoratorAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.DecoratorAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>DecoratorAscoltatore
        <span class="apidocSignatureSpan">(decorated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DecoratorAscoltatore(decorated) {
  this._ascoltatore = decorated;
  AbstractAscoltatore.prototype._setPublish.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.EventEmitter2Ascoltatore" id="apidoc.element.ascoltatori.ascoltatori.EventEmitter2Ascoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>EventEmitter2Ascoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter2Ascoltatore(settings) {
  AbstractAscoltatore.call(this, settings, {
    wildcardOne: '*',
    wildcardSome: '**'
  });

  this._event = new EventEmitter2({
    delimiter: this._separator,
    wildcard: true
  });

  this._event.setMaxListeners(0);

  this.emit("ready");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.FileSystemAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.FileSystemAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>FileSystemAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FileSystemAscoltatore(opts)
{
  AbstractAscoltatore.call(this, opts, {
    separator: '.'
  });

  opts = opts || {};

  var QlobberFSQ = (opts.qlobber_fsq || require('qlobber-fsq')).QlobberFSQ;

  opts.separator = this._nativeSettings.separator;
  opts.wildcard_one = this._wildcardOne;
  opts.wildcard_some = this._wildcardSome;
  opts.dedup = false;

  this._dehnd = '__filesystem_ascoltatore' + crypto.randomBytes(16).toString('base64');
  this._fsq = new QlobberFSQ(opts);

  var ths = this;

  this._fsq.on('start', function () {
    ths.emit('ready');
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.JSONAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.JSONAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>JSONAscoltatore
        <span class="apidocSignatureSpan">(ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JSONAscoltatore(ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .once("error", done);
}

if (opts.json !== false) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">JSONAscoltatore</span>(result)
    .once("error", done);
}

if (done) {
  setImmediate(function() {
    result.once("ready", function() {
      result.removeListener("error", done);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.KafkaAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.KafkaAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>KafkaAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function KafkaAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '_',
    wildcardOne: '*',
    wildcardSome: '#'
  });
  this._default_opts = {connectionString: "localhost:2181/", clientId: "kafka-node-client", groupId: "kafka-node-group"};
  this._opts = opts || this._default_opts;
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.kafka = this._opts.kafka || require("kafka-node");
  this._opts.encodings = this._opts.encodings || {};
  this._opts.defaultEncoding = this._opts.defaultEncoding || "utf8";
  this._opts.noAckBatchOptions = this._opts.noAckBatchOptions || { noAckBatchSize: null, noAckBatchAge: null };

  this._knowntopics = [];
  this._subs_counter = new SubsCounter();
  this._qlobber_opts = {separator: '_',  wildcard_one: '*', wildcard_some: '#'};
  this._subs_matcher = new Qlobber(this._qlobber_opts);

  this._ascoltatore = new TrieAscoltatore(opts);
  this._consumerStarting = false;
  var connectionString = this._opts.connectionString || this._default_opts.connectionString;
  var clientId = this._opts.clientId || this._default_opts.clientId;
  var zkOptions = this._opts.zkOptions || this._default_opts.zkOptions;
  var noAckBatchOptions = this._opts.noAckBatchOptions;
  var Client = this._opts.kafka.Client;
  this._producerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
  var HighLevelProducer = this._opts.kafka.HighLevelProducer;
  this._producer = new HighLevelProducer(this._producerClient);
  var that = this;
  this._producer.on('ready',function(){
     that.readZkTopics(function(err,topics){
        if(err){
           that.emit("error",err);
           return;
        }
       that._knowntopics = that._knowntopics.concat(topics);
       that.emit("ready");
      });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.MQTTAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.MQTTAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MQTTAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MQTTAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '/',
    wildcardOne: '+',
    wildcardSome: '#'
  });

  this._opts = opts || {};
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.mqtt = this._opts.mqtt || require("mqtt");

  this._subs_counter = new SubsCounter();

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.MongoAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.MongoAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MongoAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MongoAscoltatore = function (opts) {
  AbstractAscoltatore.call(this);

  if (typeof opts.db === 'string' || opts.uri) {
    // old options
    opts.uri = opts.uri || 'mongodb://127.0.0.1/';
    opts.db = opts.db || 'ascoltatori';
    opts.url = opts.uri + opts.db + '?auto_reconnect=true';
    delete opts.db;
  }

  this._opts = opts || {};
  this.url = this._opts.url || 'mongodb://127.0.0.1/ascoltatori?auto_reconnect=true';
  this._pubsubCollection = opts.pubsubCollection || 'pubsub';
  this._maxRetry = opts.maxRetry || 5;
  this.mongoOpts = this._opts.mongo || {};

  this._ascoltatore = new TrieAscoltatore(opts);

  this.channels = {};
  this._closed = false;

  this._handlingCursorFailure = false;
  this._lastSuccessfulHandling = new ObjectID();

  this.wait = this._opts.wait || 100;

  this.connectionParams = {
    capped: true,
    size: this._opts.size || 10 * 1024 * 1024, // 10 MB
    max: this._opts.max || 10000 // documents
  };

  var that = this;

  var setupDB = function(err, db) {
    if (err) {
      that.emit('error', err);
      return;
    }

    that.db = db;

    // creating the capped collection where we can exchange messages
    that.db.createCollection(that._pubsubCollection, that.connectionParams, function(err, collection) {
      if (err) {
        that.emit('error', err);
      } else&nbsp; {
        that.collection = collection;

        debug('ready');

        // create a new object id. We will get all the events from now on
        that._poll(new ObjectID());

        that.emit('ready');
      }
    });
  };

  if (opts.db) {
    setupDB(null, opts.db);
  } else {
    MongoClient.connect(this.url, this.mongoOpts, setupDB);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.PrefixAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.PrefixAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>PrefixAscoltatore
        <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrefixAscoltatore(prefix, ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore || new TrieAscoltatore());

  this._prefix = prefix;
  this._separator = this._ascoltatore._separator;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Klass = (typeof opts.type === 'function') ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">PrefixAscoltatore</span>(opts.prefix, result)
    .once("error", done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once("error", done);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.RedisAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.RedisAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>RedisAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: '/',
    wildcardOne: '*',
    wildcardSome: '*'
  });

  this._ready_sub = false;
  this._ready_pub = false;
  this._opts = opts || {};

  this._ascoltatores = {};

  this._startSub();
  this._startPub();

  this._subs_counter = new SubsCounter();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.SubsCounter" id="apidoc.element.ascoltatori.ascoltatori.SubsCounter">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>SubsCounter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SubsCounter() {
  this.clear();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.TrieAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.TrieAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>TrieAscoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TrieAscoltatore(settings) {
  AbstractAscoltatore.call(this, settings);

  settings = settings || {};

  this._matcher = new Qlobber({
    separator: settings.separator || '/',
    wildcard_one: settings.wildcardOne || '+',
    wildcard_some: settings.wildcardSome || '*'
  });

  this.emit("ready");
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.ZeromqAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.ZeromqAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>ZeromqAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ZeromqAscoltatore(opts) {
  AbstractAscoltatore.call(this);

  this._opts = opts || {};
  this._opts.delay = this._opts.delay || 5;
  this._opts.zmq = this._opts.zmq || require("zmq");

  this._connectedControls = [];

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startSubs();
  this._startPub();
  this._startControl();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.behaveLikeAnAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.behaveLikeAnAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>behaveLikeAnAscoltatore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">behaveLikeAnAscoltatore = function () {

  var expect;

  // you MUST depend on chai only if you plan to run
  // this test
  expect = require("chai").expect;

  it("should have a subscribe function", function() {
    var that = this;
    expect(that.instance).to.respondTo("subscribe");
  });

  it("should have an publish function", function() {
    var that = this;
    expect(that.instance).to.respondTo("publish");
  });

  it("should support a publish/subscribe pattern", function(done) {
    var that = this;
    that.instance.subscribe("hello", wrap(done), function() {
      that.instance.publish("hello");
    });
  });

  it("should support 'pub/sub' combination for pub/sub", function(done) {
    var that = this;
    that.instance.sub("hello", wrap(done), function() {
      that.instance.pub("hello");
    });
  });

  it("should not raise an exception if pub is called without a done callback", function(done) {
    this.instance.pub("hello");
    setTimeout(done, 50);
  });

  it("should not raise an exception if sub is called without a done callback", function(done) {
    var that = this;
    that.instance.sub("hello", function() {});
    setTimeout(function() {
      // still, some Ascoltatore are async
      // and we must give them some time
      done();
    }, 10);
  });

  it("should accept a done callback in pub", function(done) {
    this.instance.pub("hello", "world", done);
  });

  it("should support multi-level wildcard at end of topic", function(done) {
    var that = this;
    that.instance.sub("hello/*", wrap(done), function() {
      that.instance.pub("hello/there/42");
    });
  });

  it("should support multi-level wildcard at the end of a topic with no separator", function(done) {
    var that = this;
    that.instance.sub("hello/*", wrap(done), function() {
      that.instance.pub("hello");
    });
  });

  it("should support single-level wildcard at start of topic", function(done) {
    var that = this;
    that.instance.sub("+/hello", wrap(done), function() {
      that.instance.pub("42/hello");
    });
  });

  it("should support single-level wildcard in middle of topic", function(done) {
    var that = this;
    that.instance.sub("hello/+/end", wrap(done), function() {
      that.instance.pub("hello/42/end");
    });
  });

  it("should support single-level wildcard at end of topic", function(done) {
    var that = this;
    that.instance.sub("hello/+", wrap(done), function() {
      that.instance.pub("hello/42");
    });
  });

  it("should support both wildcards in topic", function(done) {
    var that = this;
    that.instance.sub("hello/+/there/*", wrap(done), function() {
      that.instance.pub("hello/foo/there/bar/42/end");
    });
  });

  it("should not match multiple levels with single wildcard", function(done) {
    var that = this,
        callback = null;

    callback = function(topic) {
      expect(topic).to.equal(["hello", "42", "there"].join(that.separator));
      done();
    };

    that.instance.sub("hello/+/there", callback, function () {
      that.instance.pub("hello/42/43/there");
      that.instance.pub("hello/42/there");
    });
  });

  it("should unsubscribe from wildcard topics independently", function(done) {
    var that = this,
        callback1 = null,
        callback2 = null;

    callback1 = function(topic) {
      expect(topic).to.equal(["hello", "42", "there"].join(that.separator));
      done();
    };

    callback2 = function () { };

    that.instance.sub("hello/*/there", callback2, function () {
      that.instance.sub("hello/+/there", callback1, function () {
        that.instance.unsub("hello/*/there", callback2, function () {
          that.instance.pub("hello/42/there");
        });
      });
    });
  });

  it("should call each matching callback", function(done) {
    var that = this,
        callback = null,
        count = 0;

    callback = function(topic) {
      expect(topic).to.equal(["hello", "42"].join(that.separator));
      count += 1;
      if (count === 2) {
        done();
      }
    };

    that.instance.sub("hello/42", callback, function () {
      that.i ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.build" id="apidoc.element.ascoltatori.ascoltatori.build">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>build
        <span class="apidocSignatureSpan">(opts, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function build(opts, done) {
  opts = opts || {};

  if (typeof opts === "function") {
    done = opts;
    opts = {};
  }

  var Klass = null,
    result = null;

  Klass = (typeof opts.type === 'function') ? opts.type :
            (classes[opts.type] || module.exports.TrieAscoltatore);

  result = new Klass(opts, module.exports);

  if (opts.prefix) {
    result = new module.exports.PrefixAscoltatore(opts.prefix, result)
      .once("error", done);
  }

  if (opts.json !== false) {
    result = new module.exports.JSONAscoltatore(result)
      .once("error", done);
  }

  if (done) {
    setImmediate(function() {
      result.once("ready", function() {
        result.removeListener("error", done);
        done(null, result);
      });
    });
  }

  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Ascoltatori focuses on providing a simple and unique abstraction for all
supported brokers. Here is a simple example using Redis:

```javascript
var ascoltatori = require('ascoltatori');

ascoltatori.<span class="apidocCodeKeywordSpan">build</span>(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.subscribe('hello', function() {
  console.log(arguments);
  // { '0': 'hello', '1': 'a message' }
});
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.util" id="apidoc.module.ascoltatori.util">module ascoltatori.util</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.util.alias" id="apidoc.element.ascoltatori.util.alias">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>alias
        <span class="apidocSignatureSpan">(obj, from, to)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function alias(obj, from, to) {
  if (typeof obj[from] !== 'function') {
    throw util.format("'%s' is not a function", from);
  }
  obj[to] = obj[from];
  return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.aliasAscoltatore" id="apidoc.element.ascoltatori.util.aliasAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>aliasAscoltatore
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function aliasAscoltatore(obj) {
  var key = null;
  Object.keys(aliases).forEach(function(key) {
    if (aliases.hasOwnProperty(key)) {
      aliases[key].forEach(function(a) {
        module.exports.alias(obj, key, a);
      });
    }
  });
  return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.buildIdentifier" id="apidoc.element.ascoltatori.util.buildIdentifier">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>buildIdentifier
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function buildIdentifier() {
  var result = util.format('asc_%s', uuid.v1());
  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.defer" id="apidoc.element.ascoltatori.util.defer">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>defer
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function defer(done) {
  if (typeof done === "function") {
    setImmediate(done);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.wrap" id="apidoc.element.ascoltatori.util.wrap">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>wrap
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function wrap(done) {
  return function() {
    if (typeof done === 'function') {
      done();
    }
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>