<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

    >ascoltatori (v4.1.0)</a>
</h1>
<h4>The pub/sub library for node backed by Redis, MongoDB, AMQP (RabbitMQ), ZeroMQ, Kafka, MQTT (Mosquitto) or just plain node!</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori">module ascoltatori</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
            <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
            <span class="apidocSignatureSpan">(decorated)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
            <span class="apidocSignatureSpan">(ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
            <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter">
            function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.behaveLikeAnAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>behaveLikeAnAscoltatore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.build">
            function <span class="apidocSignatureSpan">ascoltatori.</span>build
            <span class="apidocSignatureSpan">(opts, done)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan"></span>ascoltatori</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore.prototype</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.</span>util</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPAscoltatore">module ascoltatori.AMQPAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.AMQPAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPAscoltatore.prototype">module ascoltatori.AMQPAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore">module ascoltatori.AMQPLibAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.AMQPLibAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore.prototype">module ascoltatori.AMQPLibAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AbstractAscoltatore">module ascoltatori.AbstractAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.AbstractAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
            <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.AbstractAscoltatore.prototype">module ascoltatori.AbstractAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._pubTopic">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_pubTopic
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._raiseIfClosed">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_raiseIfClosed
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._recvTopic">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_recvTopic
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._setPublish">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_setPublish
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._subTopic">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_subTopic
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore">module ascoltatori.DecoratorAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.DecoratorAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
            <span class="apidocSignatureSpan">(decorated)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore.prototype">module ascoltatori.DecoratorAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.on">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>on
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.once">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>once
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.removeListener">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>removeListener
            <span class="apidocSignatureSpan">(event, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapCallback">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapCallback
            <span class="apidocSignatureSpan">(callback, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapPayload">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapPayload
            <span class="apidocSignatureSpan">(payload, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapTopic">
            function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapTopic
            <span class="apidocSignatureSpan">(topic, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore">module ascoltatori.EventEmitter2Ascoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.EventEmitter2Ascoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore.prototype">module ascoltatori.EventEmitter2Ascoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore">module ascoltatori.FileSystemAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.FileSystemAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore.prototype">module ascoltatori.FileSystemAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.JSONAscoltatore">module ascoltatori.JSONAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore.JSONAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
            <span class="apidocSignatureSpan">(ascoltatore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.JSONAscoltatore.prototype">module ascoltatori.JSONAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapCallback">
            function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapCallback
            <span class="apidocSignatureSpan">(callback, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapPayload">
            function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapPayload
            <span class="apidocSignatureSpan">(payload, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.KafkaAscoltatore">module ascoltatori.KafkaAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.KafkaAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.KafkaAscoltatore.prototype">module ascoltatori.KafkaAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.addKafkaSubscriptions">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>addKafkaSubscriptions
            <span class="apidocSignatureSpan">(subscribe_topics, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.createTopics">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>createTopics
            <span class="apidocSignatureSpan">(topics, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.readZkTopics">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>readZkTopics
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicOffsetsAdded">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicOffsetsAdded
            <span class="apidocSignatureSpan">(client, topics, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicPartitionsExpanded">
            function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicPartitionsExpanded
            <span class="apidocSignatureSpan">(client, topics, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MQTTAscoltatore">module ascoltatori.MQTTAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.MQTTAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MQTTAscoltatore.prototype">module ascoltatori.MQTTAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype._startConn">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>_startConn
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.reconnectTopics">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>reconnectTopics
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MongoAscoltatore">module ascoltatori.MongoAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.MongoAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.MongoAscoltatore.prototype">module ascoltatori.MongoAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._checkCappedAndPoll">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_checkCappedAndPoll
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._disconnected">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_disconnected
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handle">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handle
            <span class="apidocSignatureSpan">(die, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handleCursorClosed">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handleCursorClosed
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._more">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_more
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._poll">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_poll
            <span class="apidocSignatureSpan">(latest)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.PrefixAscoltatore">module ascoltatori.PrefixAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.PrefixAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
            <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.PrefixAscoltatore.prototype">module ascoltatori.PrefixAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._localToParent">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_localToParent
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._parentToLocal">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_parentToLocal
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapCallback">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapCallback
            <span class="apidocSignatureSpan">(callback, next)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapTopic">
            function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapTopic
            <span class="apidocSignatureSpan">(topic, next)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.RedisAscoltatore">module ascoltatori.RedisAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.RedisAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.RedisAscoltatore.prototype">module ascoltatori.RedisAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._containsWildcard">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_containsWildcard
            <span class="apidocSignatureSpan">(topic)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startPub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startPub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startSub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startSub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._updateReady">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_updateReady
            <span class="apidocSignatureSpan">(key)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.SubsCounter">module ascoltatori.SubsCounter</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.SubsCounter">
            function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.SubsCounter.prototype">module ascoltatori.SubsCounter.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.add">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>add
            <span class="apidocSignatureSpan">(elem)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.clear">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>clear
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.forEach">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>forEach
            <span class="apidocSignatureSpan">(callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.include">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>include
            <span class="apidocSignatureSpan">(elem)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.keys">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>keys
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.SubsCounter.prototype.remove">
            function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>remove
            <span class="apidocSignatureSpan">(elem)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.TrieAscoltatore">module ascoltatori.TrieAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.TrieAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.TrieAscoltatore.prototype">module ascoltatori.TrieAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, options, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore">module ascoltatori.ZeromqAscoltatore</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.ZeromqAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore.prototype">module ascoltatori.ZeromqAscoltatore.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._connectSub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_connectSub
            <span class="apidocSignatureSpan">(port, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startControl">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startControl
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startPub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startPub
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startSubs">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startSubs
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.close">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>close
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.connect">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>connect
            <span class="apidocSignatureSpan">(port, callback)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.pub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>pub
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.publish">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>publish
            <span class="apidocSignatureSpan">(topic, message, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.sub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>sub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.subscribe">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>subscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsub">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsub
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsubscribe">
            function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsubscribe
            <span class="apidocSignatureSpan">(topic, callback, done)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.ascoltatori">module ascoltatori.ascoltatori</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.AMQPAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.AMQPLibAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPLibAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.AbstractAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AbstractAscoltatore
            <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.DecoratorAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>DecoratorAscoltatore
            <span class="apidocSignatureSpan">(decorated)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.EventEmitter2Ascoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>EventEmitter2Ascoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.FileSystemAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>FileSystemAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.JSONAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>JSONAscoltatore
            <span class="apidocSignatureSpan">(ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.KafkaAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>KafkaAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.MQTTAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MQTTAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.MongoAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MongoAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.PrefixAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>PrefixAscoltatore
            <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.RedisAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>RedisAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.SubsCounter">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>SubsCounter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.TrieAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>TrieAscoltatore
            <span class="apidocSignatureSpan">(settings)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.ZeromqAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>ZeromqAscoltatore
            <span class="apidocSignatureSpan">(opts)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.behaveLikeAnAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>behaveLikeAnAscoltatore
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.ascoltatori.build">
            function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>build
            <span class="apidocSignatureSpan">(opts, done)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>util</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.ascoltatori.util">module ascoltatori.util</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.alias">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>alias
            <span class="apidocSignatureSpan">(obj, from, to)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.aliasAscoltatore">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>aliasAscoltatore
            <span class="apidocSignatureSpan">(obj)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.buildIdentifier">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>buildIdentifier
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.defer">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>defer
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.ascoltatori.util.wrap">
            function <span class="apidocSignatureSpan">ascoltatori.util.</span>wrap
            <span class="apidocSignatureSpan">(done)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori" id="apidoc.module.ascoltatori">module ascoltatori</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore" id="apidoc.element.ascoltatori.AMQPAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require(&#x22;amqp&#x22;);
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore" id="apidoc.element.ascoltatori.AMQPLibAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPLibAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require(&#x22;amqplib/callback_api&#x22;);
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore" id="apidoc.element.ascoltatori.AbstractAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
        <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbstractAscoltatore(settings, nativeSettings) {
  EventEmitter.call(this);

  settings = settings || {};
  nativeSettings = nativeSettings || {};

  this._separator = settings.separator || &#x27;/&#x27;,
  this._wildcardOne = settings.wildcardOne || &#x27;+&#x27;,
  this._wildcardSome = settings.wildcardSome || &#x27;*&#x27;;
  this._nativeSettings = nativeSettings;

  if (nativeSettings.separator &#x26;&#x26;
      (this._separator !== nativeSettings.separator)) {
    this._reInSeparator = new RegExp(&#x27;\\&#x27; + this._separator, &#x27;g&#x27;);
    this._reOutSeparator = new RegExp(&#x27;\\&#x27; + nativeSettings.separator, &#x27;g&#x27;);
  }
  if (nativeSettings.wildcardOne &#x26;&#x26;
      (this._wildcardOne !== nativeSettings.wildcardOne)) {
    this._reInWildcardOne = new RegExp(&#x27;\\&#x27; + this._wildcardOne, &#x27;g&#x27;);
  }
  if (nativeSettings.wildcardSome &#x26;&#x26;
      (this._wildcardSome !== nativeSettings.wildcardSome)) {
    this._reInWildcardSome = new RegExp(&#x27;\\&#x27; + this._wildcardSome, &#x27;g&#x27;);
  }

  this._setPublish();

  this._ready = false;
  this._closed = false;

  var that = this;

  this.on(&#x22;ready&#x22;, function() {
    that._ready = true;
  });

  this.on(&#x22;closed&#x22;, function() {
    that._closed = true;
  });

  this.on(&#x22;newListener&#x22;, function(event, listener) {
    if (event === &#x22;ready&#x22; &#x26;&#x26; that._ready) {
      listener();
    }
  });

  this.setMaxListeners(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore" id="apidoc.element.ascoltatori.DecoratorAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
        <span class="apidocSignatureSpan">(decorated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DecoratorAscoltatore(decorated) {
  this._ascoltatore = decorated;
  AbstractAscoltatore.prototype._setPublish.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter2Ascoltatore(settings) {
  AbstractAscoltatore.call(this, settings, {
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;**&#x27;
  });

  this._event = new EventEmitter2({
    delimiter: this._separator,
    wildcard: true
  });

  this._event.setMaxListeners(0);

  this.emit(&#x22;ready&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore" id="apidoc.element.ascoltatori.FileSystemAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FileSystemAscoltatore(opts)
{
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;
  });

  opts = opts || {};

  var QlobberFSQ = (opts.qlobber_fsq || require(&#x27;qlobber-fsq&#x27;)).QlobberFSQ;

  opts.separator = this._nativeSettings.separator;
  opts.wildcard_one = this._wildcardOne;
  opts.wildcard_some = this._wildcardSome;
  opts.dedup = false;

  this._dehnd = &#x27;__filesystem_ascoltatore&#x27; + crypto.randomBytes(16).toString(&#x27;base64&#x27;);
  this._fsq = new QlobberFSQ(opts);

  var ths = this;

  this._fsq.on(&#x27;start&#x27;, function () {
    ths.emit(&#x27;ready&#x27;);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore" id="apidoc.element.ascoltatori.JSONAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
        <span class="apidocSignatureSpan">(ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JSONAscoltatore(ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .once(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">JSONAscoltatore</span>(result)
    .once(&#x22;error&#x22;, done);
}

if (done) {
  setImmediate(function() {
    result.once(&#x22;ready&#x22;, function() {
      result.removeListener(&#x22;error&#x22;, done);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore" id="apidoc.element.ascoltatori.KafkaAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function KafkaAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;_&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });
  this._default_opts = {connectionString: &#x22;localhost:2181/&#x22;, clientId: &#x22;kafka-node-client&#x22;, groupId: &#x22;kafka-node-group&#x22;};
  this._opts = opts || this._default_opts;
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.kafka = this._opts.kafka || require(&#x22;kafka-node&#x22;);
  this._opts.encodings = this._opts.encodings || {};
  this._opts.defaultEncoding = this._opts.defaultEncoding || &#x22;utf8&#x22;;
  this._opts.noAckBatchOptions = this._opts.noAckBatchOptions || { noAckBatchSize: null, noAckBatchAge: null };

  this._knowntopics = [];
  this._subs_counter = new SubsCounter();
  this._qlobber_opts = {separator: &#x27;_&#x27;,  wildcard_one: &#x27;*&#x27;, wildcard_some: &#x27;#&#x27;};
  this._subs_matcher = new Qlobber(this._qlobber_opts);

  this._ascoltatore = new TrieAscoltatore(opts);
  this._consumerStarting = false;
  var connectionString = this._opts.connectionString || this._default_opts.connectionString;
  var clientId = this._opts.clientId || this._default_opts.clientId;
  var zkOptions = this._opts.zkOptions || this._default_opts.zkOptions;
  var noAckBatchOptions = this._opts.noAckBatchOptions;
  var Client = this._opts.kafka.Client;
  this._producerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
  var HighLevelProducer = this._opts.kafka.HighLevelProducer;
  this._producer = new HighLevelProducer(this._producerClient);
  var that = this;
  this._producer.on(&#x27;ready&#x27;,function(){
     that.readZkTopics(function(err,topics){
        if(err){
           that.emit(&#x22;error&#x22;,err);
           return;
        }
       that._knowntopics = that._knowntopics.concat(topics);
       that.emit(&#x22;ready&#x22;);
      });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore" id="apidoc.element.ascoltatori.MQTTAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MQTTAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;/&#x27;,
    wildcardOne: &#x27;+&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.mqtt = this._opts.mqtt || require(&#x22;mqtt&#x22;);

  this._subs_counter = new SubsCounter();

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore" id="apidoc.element.ascoltatori.MongoAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MongoAscoltatore = function (opts) {
  AbstractAscoltatore.call(this);

  if (typeof opts.db === &#x27;string&#x27; || opts.uri) {
    // old options
    opts.uri = opts.uri || &#x27;mongodb://127.0.0.1/&#x27;;
    opts.db = opts.db || &#x27;ascoltatori&#x27;;
    opts.url = opts.uri + opts.db + &#x27;?auto_reconnect=true&#x27;;
    delete opts.db;
  }

  this._opts = opts || {};
  this.url = this._opts.url || &#x27;mongodb://127.0.0.1/ascoltatori?auto_reconnect=true&#x27;;
  this._pubsubCollection = opts.pubsubCollection || &#x27;pubsub&#x27;;
  this._maxRetry = opts.maxRetry || 5;
  this.mongoOpts = this._opts.mongo || {};

  this._ascoltatore = new TrieAscoltatore(opts);

  this.channels = {};
  this._closed = false;

  this._handlingCursorFailure = false;
  this._lastSuccessfulHandling = new ObjectID();

  this.wait = this._opts.wait || 100;

  this.connectionParams = {
    capped: true,
    size: this._opts.size || 10 * 1024 * 1024, // 10 MB
    max: this._opts.max || 10000 // documents
  };

  var that = this;

  var setupDB = function(err, db) {
    if (err) {
      that.emit(&#x27;error&#x27;, err);
      return;
    }

    that.db = db;

    // creating the capped collection where we can exchange messages
    that.db.createCollection(that._pubsubCollection, that.connectionParams, function(err, collection) {
      if (err) {
        that.emit(&#x27;error&#x27;, err);
      } else {
        that.collection = collection;

        debug(&#x27;ready&#x27;);

        // create a new object id. We will get all the events from now on
        that._poll(new ObjectID());

        that.emit(&#x27;ready&#x27;);
      }
    });
  };

  if (opts.db) {
    setupDB(null, opts.db);
  } else {
    MongoClient.connect(this.url, this.mongoOpts, setupDB);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore" id="apidoc.element.ascoltatori.PrefixAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
        <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrefixAscoltatore(prefix, ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore || new TrieAscoltatore());

  this._prefix = prefix;
  this._separator = this._ascoltatore._separator;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Klass = (typeof opts.type === &#x27;function&#x27;) ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">PrefixAscoltatore</span>(opts.prefix, result)
    .once(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once(&#x22;error&#x22;, done);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore" id="apidoc.element.ascoltatori.RedisAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;/&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;*&#x27;
  });

  this._ready_sub = false;
  this._ready_pub = false;
  this._opts = opts || {};

  this._ascoltatores = {};

  this._startSub();
  this._startPub();

  this._subs_counter = new SubsCounter();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter" id="apidoc.element.ascoltatori.SubsCounter">
        function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SubsCounter() {
  this.clear();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore" id="apidoc.element.ascoltatori.TrieAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TrieAscoltatore(settings) {
  AbstractAscoltatore.call(this, settings);

  settings = settings || {};

  this._matcher = new Qlobber({
    separator: settings.separator || &#x27;/&#x27;,
    wildcard_one: settings.wildcardOne || &#x27;+&#x27;,
    wildcard_some: settings.wildcardSome || &#x27;*&#x27;
  });

  this.emit(&#x22;ready&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore" id="apidoc.element.ascoltatori.ZeromqAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ZeromqAscoltatore(opts) {
  AbstractAscoltatore.call(this);

  this._opts = opts || {};
  this._opts.delay = this._opts.delay || 5;
  this._opts.zmq = this._opts.zmq || require(&#x22;zmq&#x22;);

  this._connectedControls = [];

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startSubs();
  this._startPub();
  this._startControl();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.behaveLikeAnAscoltatore" id="apidoc.element.ascoltatori.behaveLikeAnAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>behaveLikeAnAscoltatore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">behaveLikeAnAscoltatore = function () {

  var expect;

  // you MUST depend on chai only if you plan to run
  // this test
  expect = require(&#x22;chai&#x22;).expect;

  it(&#x22;should have a subscribe function&#x22;, function() {
    var that = this;
    expect(that.instance).to.respondTo(&#x22;subscribe&#x22;);
  });

  it(&#x22;should have an publish function&#x22;, function() {
    var that = this;
    expect(that.instance).to.respondTo(&#x22;publish&#x22;);
  });

  it(&#x22;should support a publish/subscribe pattern&#x22;, function(done) {
    var that = this;
    that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
      that.instance.publish(&#x22;hello&#x22;);
    });
  });

  it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello&#x22;);
    });
  });

  it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
    this.instance.pub(&#x22;hello&#x22;);
    setTimeout(done, 50);
  });

  it(&#x22;should not raise an exception if sub is called without a done callback&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello&#x22;, function() {});
    setTimeout(function() {
      // still, some Ascoltatore are async
      // and we must give them some time
      done();
    }, 10);
  });

  it(&#x22;should accept a done callback in pub&#x22;, function(done) {
    this.instance.pub(&#x22;hello&#x22;, &#x22;world&#x22;, done);
  });

  it(&#x22;should support multi-level wildcard at end of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/*&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/there/42&#x22;);
    });
  });

  it(&#x22;should support multi-level wildcard at the end of a topic with no separator&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/*&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello&#x22;);
    });
  });

  it(&#x22;should support single-level wildcard at start of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;+/hello&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;42/hello&#x22;);
    });
  });

  it(&#x22;should support single-level wildcard in middle of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/+/end&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/42/end&#x22;);
    });
  });

  it(&#x22;should support single-level wildcard at end of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/+&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/42&#x22;);
    });
  });

  it(&#x22;should support both wildcards in topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/+/there/*&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/foo/there/bar/42/end&#x22;);
    });
  });

  it(&#x22;should not match multiple levels with single wildcard&#x22;, function(done) {
    var that = this,
        callback = null;

    callback = function(topic) {
      expect(topic).to.equal([&#x22;hello&#x22;, &#x22;42&#x22;, &#x22;there&#x22;].join(that.separator));
      done();
    };

    that.instance.sub(&#x22;hello/+/there&#x22;, callback, function () {
      that.instance.pub(&#x22;hello/42/43/there&#x22;);
      that.instance.pub(&#x22;hello/42/there&#x22;);
    });
  });

  it(&#x22;should unsubscribe from wildcard topics independently&#x22;, function(done) {
    var that = this,
        callback1 = null,
        callback2 = null;

    callback1 = function(topic) {
      expect(topic).to.equal([&#x22;hello&#x22;, &#x22;42&#x22;, &#x22;there&#x22;].join(that.separator));
      done();
    };

    callback2 = function () { };

    that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
      that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
        that.instance.unsub(&#x22;hello/*/there&#x22;, callback2, function () {
          that.instance.pub(&#x22;hello/42/there&#x22;);
        });
      });
    });
  });

  it(&#x22;should call each matching callback&#x22;, function(done) {
    var that = this,
        callback = null,
        count = 0;

    callback = function(topic) {
      expect(topic).to.equal([&#x22;hello&#x22;, &#x22;42&#x22;].join(that.separator));
      count += 1;
      if (count === 2) {
        done();
      }
    };

    that.instance.sub(&#x22;hello/42&#x22;, callback, function () {
      that.i ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.build" id="apidoc.element.ascoltatori.build">
        function <span class="apidocSignatureSpan">ascoltatori.</span>build
        <span class="apidocSignatureSpan">(opts, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function build(opts, done) {
  opts = opts || {};

  if (typeof opts === &#x22;function&#x22;) {
    done = opts;
    opts = {};
  }

  var Klass = null,
    result = null;

  Klass = (typeof opts.type === &#x27;function&#x27;) ? opts.type :
            (classes[opts.type] || module.exports.TrieAscoltatore);

  result = new Klass(opts, module.exports);

  if (opts.prefix) {
    result = new module.exports.PrefixAscoltatore(opts.prefix, result)
      .once(&#x22;error&#x22;, done);
  }

  if (opts.json !== false) {
    result = new module.exports.JSONAscoltatore(result)
      .once(&#x22;error&#x22;, done);
  }

  if (done) {
    setImmediate(function() {
      result.once(&#x22;ready&#x22;, function() {
        result.removeListener(&#x22;error&#x22;, done);
        done(null, result);
      });
    });
  }

  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Ascoltatori focuses on providing a simple and unique abstraction for all
supported brokers. Here is a simple example using Redis:

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.<span class="apidocCodeKeywordSpan">build</span>(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.subscribe(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});
...</pre></li>
    </ul>




































</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPAscoltatore" id="apidoc.module.ascoltatori.AMQPAscoltatore">module ascoltatori.AMQPAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.AMQPAscoltatore" id="apidoc.element.ascoltatori.AMQPAscoltatore.AMQPAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require(&#x22;amqp&#x22;);
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPAscoltatore.prototype" id="apidoc.module.ascoltatori.AMQPAscoltatore.prototype">module ascoltatori.AMQPAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function () {
  var conn = null,
    that = this;

  if (this._client_conn === undefined) {

    conn = this._opts.amqp.createConnection(this._opts.client);
    this._client_conn = conn;

    conn.on(&#x22;error&#x22;, function(error) {
      if (typeof error === &#x27;string&#x27;) {
        error = (new Error(error));
      }

      that.emit(&#x22;error&#x22;, error);
    });

    debug(&#x22;connecting to &#x22; + this._opts.client);

    steed.series([

      function(callback) {
        that._client_conn.once(&#x22;ready&#x22;, wrap(callback));
      },

      function(callback) {
        debug(&#x22;connected&#x22;);
        that._exchange = conn.exchange(that._opts.exchange, {
          type: &#x22;topic&#x22;,
          confirm: true
        });
        that._exchange.once(&#x22;open&#x22;, wrap(callback));
      },

      function(callback) {
        debug(&#x22;created exchange &#x22; + that._opts.exchange);
        that._queue = conn.queue(util.buildIdentifier(), wrap(callback));
        that._queue.setMaxListeners(0); // avoid problems with listeners
      },

      function(callback) {
        that._queue.subscribe({
          ack: true,
          prefetchCount: 42
        }, function(message, headers, deliveryInfo) {
          that._queue.shift();

          var topic = that._recvTopic(deliveryInfo.routingKey);

          debug(&#x22;new message received from queue on topic &#x22; + topic);

          that._ascoltatore.publish(topic, message.data.toString());
        });
        that._queue.once(&#x22;basicConsumeOk&#x22;, function() {
          defer(callback);
        });
      },

      function(callback) {
        debug(&#x22;subscribed to queue&#x22;);
        that.emit(&#x22;ready&#x22;);
        callback();
      }
    ]);
  }
  return this._client_conn;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.close" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;

  if (this._closed) {
    wrap(done)();
    return;
  }

  if (this._closing) {
    this.on(&#x22;closed&#x22;, done);
    return;
  }

  this._closing = true;

  if (this._client_conn !== undefined) {
    var doClose = function () {
      if (that._closed) {
        debug(&#x22;closing twice, one was an error&#x22;);
        return;
      }

      debug(&#x22;closed&#x22;);
      defer(done);
      that.emit(&#x22;closed&#x22;);
    };

    this._client_conn.on(&#x22;close&#x22;, doClose);

    this._queue.destroy();
    this._client_conn.end();
    this._client_conn.removeAllListeners(&#x22;error&#x22;);
    this._client_conn.on(&#x22;error&#x22;, doClose);

    delete this._client_conn;
    delete this._exchange;
    delete this._queue;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug(&#x22;new message published to &#x22; + topic);

  this._exchange.publish(this._pubTopic(topic), String(message));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug(&#x22;new message published to &#x22; + topic);

  this._exchange.publish(this._pubTopic(topic), String(message));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {

    debug(&#x22;binding queue to topic &#x22; + topic);

    this._queue.once(&#x22;queueBindOk&#x22;, function() {
      // trick against node-amqp not working
      // as advertised
      setTimeout(function() {
        debug(&#x22;queue bound to topic &#x22; + topic);
        defer(done);
      }, 5);
    });

    this._queue.bind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug(&#x22;registered new subscriber for topic &#x22; + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {

    debug(&#x22;binding queue to topic &#x22; + topic);

    this._queue.once(&#x22;queueBindOk&#x22;, function() {
      // trick against node-amqp not working
      // as advertised
      setTimeout(function() {
        debug(&#x22;queue bound to topic &#x22; + topic);
        defer(done);
      }, 5);
    });

    this._queue.bind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug(&#x22;registered new subscriber for topic &#x22; + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._queue.once(&#x22;queueUnbindOk&#x22;, function() {
      debug(&#x22;queue unbound to topic &#x22; + topic);
      defer(done);
    });

    this._queue.unbind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.AMQPAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._queue.once(&#x22;queueUnbindOk&#x22;, function() {
      debug(&#x22;queue unbound to topic &#x22; + topic);
      defer(done);
    });

    this._queue.unbind(this._exchange, this._subTopic(topic));
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore" id="apidoc.module.ascoltatori.AMQPLibAscoltatore">module ascoltatori.AMQPLibAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.AMQPLibAscoltatore" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.AMQPLibAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AMQPLibAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPLibAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require(&#x22;amqplib/callback_api&#x22;);
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AMQPLibAscoltatore.prototype" id="apidoc.module.ascoltatori.AMQPLibAscoltatore.prototype">module ascoltatori.AMQPLibAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function () {
  var conn = null,
    channel = null,
    that = this;

  if (this._client_conn === undefined) {

    var url = this._opts.url || &#x27;amqp://127.0.0.1:5672&#x27;;

    var socketOptions = this._opts.socketOptions || {};

    debug(&#x22;connecting to &#x22; + this._opts.url);

    steed.series([
      function (callback) {
        that._opts.amqp.connect(url, socketOptions, function (err, conn) {
          that._client_conn = conn;
          conn.on(&#x22;error&#x22;, function (error) {
            if (typeof error === &#x27;string&#x27;) {
              error = (new Error(error));
            }

            that.emit(&#x22;error&#x22;, error);
          });
          callback();
        });
      },

      function (callback) {
        debug(&#x27;connected&#x27;);
        that._client_conn.createChannel(function(err, channel){
          that._channel = channel;
          that._channel.prefetch(42); // magic number?
          callback();
        });
      },

      function(callback){
        debug(&#x27;channel created&#x27;);
        that._queue = util.buildIdentifier();
        that._channel.assertQueue(that._queue, {durable: false}, wrap(callback));
      },

      function (callback){
        debug(&#x27;queue created&#x27;);
        that._channel.assertExchange(that._opts.exchange, &#x27;topic&#x27;, {}, wrap(callback));
      },

      function (callback){
        debug(&#x27;exchange existed&#x27;);
        that._channel.consume(that._queue, function(msg){
          that._channel.ack(msg);
          var topic = that._recvTopic(msg.fields.routingKey);
          debug(&#x22;new message received from queue on topic &#x22; + topic);
          that._ascoltatore.publish(topic, msg.content.toString());
        }, null, wrap(callback));
      },

      function (callback) {
        debug(&#x22;subscribed to queue&#x22;);
        that.emit(&#x22;ready&#x22;);
        callback();
      }
    ]);
  }
  return this._client_conn;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.close" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;

  if (this._closed) {
    wrap(done)();
    return;
  }

  if (this._closing) {
    this.on(&#x22;closed&#x22;, done);
    return;
  }

  this._closing = true;

  if (this._client_conn !== undefined) {
    var doClose = function () {
      if (that._closed) {
        debug(&#x22;closing twice, one was an error&#x22;);
        return;
      }

      debug(&#x22;closed&#x22;);
      defer(done);
      that.emit(&#x22;closed&#x22;);
    };

    this._client_conn.on(&#x22;close&#x22;, doClose);
    this._channel.deleteQueue(this._queue);
    this._channel.close();

    this._client_conn.close();
    this._client_conn.removeAllListeners(&#x22;error&#x22;);
    this._client_conn.on(&#x22;error&#x22;, doClose);

    delete this._client_conn;
    delete this._channel;
    delete this._queue;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug(&#x22;new message published to &#x22; + topic);

  this._channel.publish(this._opts.exchange, this._pubTopic(topic), new Buffer(String(message)));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  debug(&#x22;new message published to &#x22; + topic);

  this._channel.publish(this._opts.exchange, this._pubTopic(topic), new Buffer(String(message)));
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    debug(&#x22;binding queue to topic &#x22; + topic);

    this._channel.bindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok){
        debug(&#x22;queue bound to topic &#x22; + topic);
        defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug(&#x22;registered new subscriber for topic &#x22; + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  this._ascoltatore.subscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    debug(&#x22;binding queue to topic &#x22; + topic);

    this._channel.bindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok){
        debug(&#x22;queue bound to topic &#x22; + topic);
        defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);

  debug(&#x22;registered new subscriber for topic &#x22; + topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._channel.unbindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok) {
      debug(&#x22;queue unbound to topic &#x22; + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.AMQPLibAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AMQPLibAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  this._subs_counter.remove(topic);

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._ascoltatore.unsubscribe(topic, callback);

  if (!this._subs_counter.include(topic)) {
    this._channel.unbindQueue(this._queue, this._opts.exchange, this._subTopic(topic), {}, function(err, ok) {
      debug(&#x22;queue unbound to topic &#x22; + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AbstractAscoltatore" id="apidoc.module.ascoltatori.AbstractAscoltatore">module ascoltatori.AbstractAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.AbstractAscoltatore" id="apidoc.element.ascoltatori.AbstractAscoltatore.AbstractAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>AbstractAscoltatore
        <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbstractAscoltatore(settings, nativeSettings) {
  EventEmitter.call(this);

  settings = settings || {};
  nativeSettings = nativeSettings || {};

  this._separator = settings.separator || &#x27;/&#x27;,
  this._wildcardOne = settings.wildcardOne || &#x27;+&#x27;,
  this._wildcardSome = settings.wildcardSome || &#x27;*&#x27;;
  this._nativeSettings = nativeSettings;

  if (nativeSettings.separator &#x26;&#x26;
      (this._separator !== nativeSettings.separator)) {
    this._reInSeparator = new RegExp(&#x27;\\&#x27; + this._separator, &#x27;g&#x27;);
    this._reOutSeparator = new RegExp(&#x27;\\&#x27; + nativeSettings.separator, &#x27;g&#x27;);
  }
  if (nativeSettings.wildcardOne &#x26;&#x26;
      (this._wildcardOne !== nativeSettings.wildcardOne)) {
    this._reInWildcardOne = new RegExp(&#x27;\\&#x27; + this._wildcardOne, &#x27;g&#x27;);
  }
  if (nativeSettings.wildcardSome &#x26;&#x26;
      (this._wildcardSome !== nativeSettings.wildcardSome)) {
    this._reInWildcardSome = new RegExp(&#x27;\\&#x27; + this._wildcardSome, &#x27;g&#x27;);
  }

  this._setPublish();

  this._ready = false;
  this._closed = false;

  var that = this;

  this.on(&#x22;ready&#x22;, function() {
    that._ready = true;
  });

  this.on(&#x22;closed&#x22;, function() {
    that._closed = true;
  });

  this.on(&#x22;newListener&#x22;, function(event, listener) {
    if (event === &#x22;ready&#x22; &#x26;&#x26; that._ready) {
      listener();
    }
  });

  this.setMaxListeners(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.AbstractAscoltatore.prototype" id="apidoc.module.ascoltatori.AbstractAscoltatore.prototype">module ascoltatori.AbstractAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._pubTopic" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._pubTopic">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_pubTopic
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_pubTopic = function (topic) {
  if (this._reInSeparator) {
    topic = topic.replace(this._reInSeparator,
                          this._nativeSettings.separator);
  }
  return topic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._raiseIfClosed" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._raiseIfClosed">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_raiseIfClosed
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function raiseIfClosed() {
  if (this._closed) {
    throw new Error(&#x22;This ascoltatore is closed&#x22;);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._recvTopic" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._recvTopic">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_recvTopic
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_recvTopic = function (topic) {
  if (this._reOutSeparator) {
    topic = topic.replace(this._reOutSeparator, this._separator);
  }
  return topic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._setPublish" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._setPublish">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_setPublish
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_setPublish = function () {
  var proto = Object.getPrototypeOf(this),
      f = proto.publish,
      publish,
      newPublish;

  if (!f) { return; }

  if (f.length === 4) {
    publish = this.publish;
  } else {
    publish = function (topic, payload, options, done) {
      return f.call(this, topic, payload, done);
    };
  }

  newPublish = function (topic, payload, options, done) {
    if ((typeof options === &#x27;function&#x27;) ||
        (done &#x26;&#x26; (typeof done !== &#x27;function&#x27;))) {
      done = options;
      options = {};
    } else if ((options === undefined) || (options === null)) {
      options = {};
    }

    return publish.call(this, topic, payload, options, done);
  };

  this.publish = newPublish;

  if (proto.pub === proto.publish) {
    this.pub = newPublish;
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype._subTopic" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype._subTopic">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>_subTopic
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_subTopic = function (topic) {
  if (this._reInSeparator) {
    topic = topic.replace(this._reInSeparator,
                          this._nativeSettings.separator);
  }
  if (this._reInWildcardSome) {
    topic = topic.replace(this._reInWildcardSome,
                          this._nativeSettings.wildcardSome);
  }
  if (this._reInWildcardOne) {
    topic = topic.replace(this._reInWildcardOne,
                          this._nativeSettings.wildcardOne);
  }
  return topic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.close" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (done) {
  throw new Error(&#x22;Subclass to implement&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, payload, options, done) {
  throw new Error(&#x22;Subclass to implement&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done) {
  throw new Error(&#x22;Subclass to implement&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.AbstractAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.AbstractAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.AbstractAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function (topic, callback, done) {
  throw new Error(&#x22;Subclass to implement&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore" id="apidoc.module.ascoltatori.DecoratorAscoltatore">module ascoltatori.DecoratorAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.DecoratorAscoltatore" id="apidoc.element.ascoltatori.DecoratorAscoltatore.DecoratorAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>DecoratorAscoltatore
        <span class="apidocSignatureSpan">(decorated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DecoratorAscoltatore(decorated) {
  this._ascoltatore = decorated;
  AbstractAscoltatore.prototype._setPublish.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.DecoratorAscoltatore.prototype" id="apidoc.module.ascoltatori.DecoratorAscoltatore.prototype">module ascoltatori.DecoratorAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.close" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (done) {
  this._ascoltatore.close(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.on" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.on">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>on
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">on = function (event, callback) {
  this._ascoltatore.on(event, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    a.push(subscribe);
  }

  steed.parallel(a, instance.publish.bind(instance, &#x22;hello&#x22;, null));
});

it(&#x22;should emit the ready event&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">on</span>(&#x22;ready&#x22;, done);
});

it(&#x22;should support at least 12 listeners as an EventEmitter&#x22;, function(done) {
  var counter = 11,
    i = null,
    callback, a = [];
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.once" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.once">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>once
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">once = function (event, callback) {
  this._ascoltatore.once(event, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
Klass = (typeof opts.type === &#x27;function&#x27;) ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .<span class="apidocCodeKeywordSpan">once</span>(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once(&#x22;error&#x22;, done);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, payload, options, done) {
  this.publish(topic, payload, options, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, payload, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, payload, options, done) {
  var that = this;
  steed.waterfall([

    function(cb) {
      that.wrapTopic(topic, cb);
    },

    function(newTopic, cb) {
      that.wrapPayload(payload, function(err, newPayload) {
        cb(err, newTopic, newPayload);
      });
    },

    function(newTopic, newPayload, cb) {
      that._ascoltatore.publish(newTopic, newPayload, options, cb);
    }
  ], done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.removeListener" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.removeListener">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>removeListener
        <span class="apidocSignatureSpan">(event, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">removeListener = function (event, callback) {
  this._ascoltatore.removeListener(event, callback);
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    result = new module.exports.JSONAscoltatore(result)
      .once(&#x22;error&#x22;, done);
  }

  if (done) {
    setImmediate(function() {
      result.once(&#x22;ready&#x22;, function() {
        result.<span class="apidocCodeKeywordSpan">removeListener</span>(&#x22;error&#x22;, done);
        done(null, result);
      });
    });
  }

  return result;
};
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sub = function (topic, callback, done) {
  this.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done) {
  var that = this;
  steed.waterfall([

    function(cb) {
      that.wrapTopic(topic, cb);
    },

    function(newTopic, cb) {
      that.wrapCallback(callback, function(err, newCallback) {
        cb(err, newTopic, newCallback);
      });
    },

    function(newTopic, newCallback, cb) {
      that._ascoltatore.subscribe(newTopic, newCallback, cb);
    }
  ], done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function (topic, callback, done) {
  this.unsubscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function (topic, callback, done) {
  var that = this;
  steed.waterfall([

    function(cb) {
      that.wrapTopic(topic, cb);
    },

    function(newTopic, cb) {
      that.wrapCallback(callback, function(err, newCallback) {
        cb(err, newTopic, newCallback);
      });
    },

    function(newTopic, newCallback, cb) {
      that._ascoltatore.unsubscribe(newTopic, newCallback, cb);
    }
  ], done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapCallback" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapCallback">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapCallback
        <span class="apidocSignatureSpan">(callback, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapCallback = function (callback, next) {
  next(null, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapPayload" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapPayload">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapPayload
        <span class="apidocSignatureSpan">(payload, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapPayload = function (payload, next) {
  next(null, payload);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapTopic" id="apidoc.element.ascoltatori.DecoratorAscoltatore.prototype.wrapTopic">
        function <span class="apidocSignatureSpan">ascoltatori.DecoratorAscoltatore.prototype.</span>wrapTopic
        <span class="apidocSignatureSpan">(topic, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapTopic = function (topic, next) {
  next(null, topic);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore" id="apidoc.module.ascoltatori.EventEmitter2Ascoltatore">module ascoltatori.EventEmitter2Ascoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.EventEmitter2Ascoltatore" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.EventEmitter2Ascoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>EventEmitter2Ascoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter2Ascoltatore(settings) {
  AbstractAscoltatore.call(this, settings, {
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;**&#x27;
  });

  this._event = new EventEmitter2({
    delimiter: this._separator,
    wildcard: true
  });

  this._event.setMaxListeners(0);

  this.emit(&#x22;ready&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.EventEmitter2Ascoltatore.prototype" id="apidoc.module.ascoltatori.EventEmitter2Ascoltatore.prototype">module ascoltatori.EventEmitter2Ascoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.close" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  this._event.removeAllListeners();
  this.emit(&#x22;closed&#x22;);

  debug(&#x22;closed&#x22;);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.pub" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug(&#x22;new message published to &#x22; + topic);

  this._event.emit(this._pubTopic(topic).replace(/^\//g, &#x27;&#x27;), topic, message, options);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.publish" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug(&#x22;new message published to &#x22; + topic);

  this._event.emit(this._pubTopic(topic).replace(/^\//g, &#x27;&#x27;), topic, message, options);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.sub" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;registered new subscriber for topic &#x22; + topic);

  this._event.on(this._subTopic(topic).replace(/^\//g, &#x27;&#x27;), callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;registered new subscriber for topic &#x22; + topic);

  this._event.on(this._subTopic(topic).replace(/^\//g, &#x27;&#x27;), callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsub" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._event.off(this._subTopic(topic).replace(/^\//g, &#x27;&#x27;), callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.EventEmitter2Ascoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.EventEmitter2Ascoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._event.off(this._subTopic(topic).replace(/^\//g, &#x27;&#x27;), callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore" id="apidoc.module.ascoltatori.FileSystemAscoltatore">module ascoltatori.FileSystemAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.FileSystemAscoltatore" id="apidoc.element.ascoltatori.FileSystemAscoltatore.FileSystemAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>FileSystemAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FileSystemAscoltatore(opts)
{
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;
  });

  opts = opts || {};

  var QlobberFSQ = (opts.qlobber_fsq || require(&#x27;qlobber-fsq&#x27;)).QlobberFSQ;

  opts.separator = this._nativeSettings.separator;
  opts.wildcard_one = this._wildcardOne;
  opts.wildcard_some = this._wildcardSome;
  opts.dedup = false;

  this._dehnd = &#x27;__filesystem_ascoltatore&#x27; + crypto.randomBytes(16).toString(&#x27;base64&#x27;);
  this._fsq = new QlobberFSQ(opts);

  var ths = this;

  this._fsq.on(&#x27;start&#x27;, function () {
    ths.emit(&#x27;ready&#x27;);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.FileSystemAscoltatore.prototype" id="apidoc.module.ascoltatori.FileSystemAscoltatore.prototype">module ascoltatori.FileSystemAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.close" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">close = function (done)
{
  this._fsq.stop_watching(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done)
{
  this._fsq.publish(this._pubTopic(topic), JSON.stringify({
    message: message,
    options: options
  }), done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done)
{
  this._fsq.publish(this._pubTopic(topic), JSON.stringify({
    message: message,
    options: options
  }), done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sub = function (topic, callback, done)
{
  var ths = this;

  function cb(data, info, cb2)
  {
    data = JSON.parse(data);
    callback(ths._recvTopic(info.topic), data.message, data.options);
    cb2();
  }

  var f = cb;

  callback[this._dehnd] = callback[this._dehnd] || f;

  this._fsq.subscribe(this._subTopic(topic),
                      callback[this._dehnd],
                      done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done)
{
  var ths = this;

  function cb(data, info, cb2)
  {
    data = JSON.parse(data);
    callback(ths._recvTopic(info.topic), data.message, data.options);
    cb2();
  }

  var f = cb;

  callback[this._dehnd] = callback[this._dehnd] || f;

  this._fsq.subscribe(this._subTopic(topic),
                      callback[this._dehnd],
                      done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function (topic, callback, done)
{
  this._fsq.unsubscribe(this._subTopic(topic),
                        callback[this._dehnd] || callback,
                        done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.FileSystemAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.FileSystemAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function (topic, callback, done)
{
  this._fsq.unsubscribe(this._subTopic(topic),
                        callback[this._dehnd] || callback,
                        done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.JSONAscoltatore" id="apidoc.module.ascoltatori.JSONAscoltatore">module ascoltatori.JSONAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore.JSONAscoltatore" id="apidoc.element.ascoltatori.JSONAscoltatore.JSONAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>JSONAscoltatore
        <span class="apidocSignatureSpan">(ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JSONAscoltatore(ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .once(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">JSONAscoltatore</span>(result)
    .once(&#x22;error&#x22;, done);
}

if (done) {
  setImmediate(function() {
    result.once(&#x22;ready&#x22;, function() {
      result.removeListener(&#x22;error&#x22;, done);
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.JSONAscoltatore.prototype" id="apidoc.module.ascoltatori.JSONAscoltatore.prototype">module ascoltatori.JSONAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapCallback" id="apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapCallback">
        function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapCallback
        <span class="apidocSignatureSpan">(callback, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapCallback = function (callback, next) {
  var that = this;
  if (!callback._json_ascoltatore_wrapper) {
    callback._json_ascoltatore_wrapper = function(t, payload, options) {
      debug(&#x22;converting from JSON&#x22;);
      var errored = false;

      try {
        payload = JSON.parse(payload);
      } catch (e) {
        errored = true;
        debug(&#x22;The payload is not a valid JSON&#x22;, e);
      }

      if (!errored) {
        callback(t, payload, options);
      }
    };
  }
  next(null, callback._json_ascoltatore_wrapper);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapPayload" id="apidoc.element.ascoltatori.JSONAscoltatore.prototype.wrapPayload">
        function <span class="apidocSignatureSpan">ascoltatori.JSONAscoltatore.prototype.</span>wrapPayload
        <span class="apidocSignatureSpan">(payload, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapPayload = function (payload, next) {

  if (payload === undefined || payload === null) {
    payload = false; // so we can convert it to JSON
  }

  debug(&#x22;converting to JSON&#x22;);
  next(null, JSON.stringify(payload));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.KafkaAscoltatore" id="apidoc.module.ascoltatori.KafkaAscoltatore">module ascoltatori.KafkaAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.KafkaAscoltatore" id="apidoc.element.ascoltatori.KafkaAscoltatore.KafkaAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>KafkaAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function KafkaAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;_&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });
  this._default_opts = {connectionString: &#x22;localhost:2181/&#x22;, clientId: &#x22;kafka-node-client&#x22;, groupId: &#x22;kafka-node-group&#x22;};
  this._opts = opts || this._default_opts;
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.kafka = this._opts.kafka || require(&#x22;kafka-node&#x22;);
  this._opts.encodings = this._opts.encodings || {};
  this._opts.defaultEncoding = this._opts.defaultEncoding || &#x22;utf8&#x22;;
  this._opts.noAckBatchOptions = this._opts.noAckBatchOptions || { noAckBatchSize: null, noAckBatchAge: null };

  this._knowntopics = [];
  this._subs_counter = new SubsCounter();
  this._qlobber_opts = {separator: &#x27;_&#x27;,  wildcard_one: &#x27;*&#x27;, wildcard_some: &#x27;#&#x27;};
  this._subs_matcher = new Qlobber(this._qlobber_opts);

  this._ascoltatore = new TrieAscoltatore(opts);
  this._consumerStarting = false;
  var connectionString = this._opts.connectionString || this._default_opts.connectionString;
  var clientId = this._opts.clientId || this._default_opts.clientId;
  var zkOptions = this._opts.zkOptions || this._default_opts.zkOptions;
  var noAckBatchOptions = this._opts.noAckBatchOptions;
  var Client = this._opts.kafka.Client;
  this._producerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
  var HighLevelProducer = this._opts.kafka.HighLevelProducer;
  this._producer = new HighLevelProducer(this._producerClient);
  var that = this;
  this._producer.on(&#x27;ready&#x27;,function(){
     that.readZkTopics(function(err,topics){
        if(err){
           that.emit(&#x22;error&#x22;,err);
           return;
        }
       that._knowntopics = that._knowntopics.concat(topics);
       that.emit(&#x22;ready&#x22;);
      });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.KafkaAscoltatore.prototype" id="apidoc.module.ascoltatori.KafkaAscoltatore.prototype">module ascoltatori.KafkaAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function (cb) {
  var that = this;
  if (this._consumer !== undefined) {
      return;
  }
   this._consumerStarting = true;
   var newcb = function(){
          that._consumerStarting = false;
          util.wrap(cb)();
          that.emit(&#x22;consumer_connected&#x22;);
   };
   var connectionString = that._opts.connectionString || that._default_opts.connectionString;
   var clientId = that._opts.clientId || that._default_opts.clientId;
   var zkOptions = that._opts.zkOptions || that._default_opts.zkOptions;
   var noAckBatchOptions = that._opts.noAckBatchOptions;
   var groupId = that._opts.groupId || that._default_opts.groupId;
   var Client = this._opts.kafka.Client;
   var useHighLevelConsumer = that._opts.useHighLevelConsumer || false;
   var HighLevelConsumer = this._opts.kafka.HighLevelConsumer;
   var Consumer = this._opts.kafka.Consumer;
   var subscribedTopics = that._subs_counter.keys();
   var subscriptions = [];
   subscribedTopics.forEach(function(topic){
        subscriptions.push({topic: topic, offset: -1});
   });
   debug(&#x22;consumer connecting with connectionString=[&#x22;+connectionString+&#x22;], clientId=[&#x22;+clientId+&#x22;], groupId=[&#x22;+groupId+&#x22;] and initial
 subscriptions&#x22;,subscriptions);
   this._consumerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
   var initConsumer = function(err,subscriptions){
        if(err){
          debug(&#x22;problem with initConsumer&#x22;,err);
          that.emit(&#x22;error&#x22;, err);
          return false;
        }
        debug(&#x22;initial subscriptions expanded to &#x22;,subscriptions);
        if (useHighLevelConsumer) {
           debug(&#x22;Using high level consumer &#x22;);
           that._consumer = new HighLevelConsumer(that._consumerClient, subscriptions, {
               groupId: groupId,fromOffset: true, autoCommit: false, encoding: &#x22;buffer&#x22;
           });
        } else {
           debug(&#x22;Using simple consumer &#x22;);
           that._consumer = new Consumer(that._consumerClient, subscriptions, {
               groupId: groupId,fromOffset: true, autoCommit: false, encoding: &#x22;buffer&#x22;});
        }
        that._consumer.on(&#x22;message&#x22;, function(message) {
            debug(&#x22;received new message on topic &#x22;, message.topic);
            var value = message.value;
            var encoding = that._opts.encodings[message.topic] || that._opts.defaultEncoding;
            if(message.value &#x26;&#x26; encoding !== &#x22;buffer&#x22;){
              value = message.value.toString(encoding);
              debug(&#x22;message is&#x22;, value);
            }
            if(that._ascoltatore._closed !== true){
              debug(&#x22;publishing to _ascolatore &#x22;, message.topic);
              that._ascoltatore.publish(that._recvTopic(message.topic), value);
            }
        });
        that._consumer.on(&#x27;error&#x27;, function(e) {
          debug(&#x22;error in client&#x22;,e);
          that.emit(&#x22;error&#x22;, e);
        });
        defer(newcb);
    };
    that._consumerClient.on(&#x27;ready&#x27;,function() {
        that.withTopicOffsetsAdded(that._consumerClient,subscriptions,initConsumer);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.addKafkaSubscriptions" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.addKafkaSubscriptions">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>addKafkaSubscriptions
        <span class="apidocSignatureSpan">(subscribe_topics, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function addKafkaSubscriptions(subscribe_topics, done) {
  var that = this;
  debug(&#x22;registering new subscriber for topics &#x22;, subscribe_topics);
  this.withTopicOffsetsAdded(this._consumerClient,subscribe_topics,function(err,subscriptions){
          if(err){
            debug(&#x22;problem adding kafka subscriptions with topic offsets added&#x22;,err);
            that.emit(&#x22;error&#x22;,err);
            return;
          }
          that._consumer.addTopics(subscriptions,function(err,added) {
                if(err){
                  debug(&#x22;problem with consumer.addTopics&#x22;,err);
                  that.emit(&#x22;error&#x22;,err);
                  return;
                }
                debug(&#x22;registered new kafka subscriptions&#x22;, subscribe_topics);
                defer(done);
              },true);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.close" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;
  debug(&#x22;closing&#x22;);
  if (!this._closed) {
    this._subs_counter.clear();
    if(this._producer){
      this._producer.close(function(){
        that._producerClient.close(function() {
          debug(&#x22;closed producer&#x22;);
          delete that._producerClient;
          delete that._producer;
        });
      });
    }
    if(this._consumer){
       that._consumer.close(function(){
        debug(&#x22;closed consumer&#x22;);
        that._consumerClient.close(function() {
          debug(&#x22;closed&#x22;);
          that._ascoltatore.close();
          delete that._consumerClient;
          delete that._consumer;
          that.emit(&#x22;closed&#x22;);
          defer(done);
        });
     });
    }else{
      this.emit(&#x22;closed&#x22;);
      util.wrap(done)();
    }
  } else {
    util.wrap(done)();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.createTopics" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.createTopics">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>createTopics
        <span class="apidocSignatureSpan">(topics, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function createTopics(topics, callback){
  var that = this;
  if(typeof topics === &#x27;string&#x27;){
     topics = [topics];
  }
  debug(&#x22;creating topics &#x22;,topics);
  this._producer.createTopics(topics, false, function (err, data) {
         if(err){
            debug(&#x22;problem creating topics&#x22;,err);
            defer(function(){callback(err);});
            return;
         }
         that._knowntopics = that._knowntopics.concat(topics);
         defer(callback);
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();
  var that = this;
  // kafka cannot send a null message. Why are messages missing in the tests...
  if(message === undefined || message === null){
    message = &#x27;&#x27;;
  }
  var pubtopic = this._pubTopic(topic);
  var doPublish = function(){
    var payload = {
      messages: message,
      topic: pubtopic
    };
    debug(&#x22;about to publish new message to &#x22;,pubtopic);
    that._producer.send([payload], function(err,data) {
      if(err){
        debug(&#x22;something went wrong publishing to &#x22;+pubtopic,err);
        that.emit(&#x22;error&#x22;,err);
      }else{
        debug(&#x22;new message published to &#x22; + pubtopic);
      }
      util.wrap(done)();
    });
  };

  if(this._knowntopics.indexOf(pubtopic) &#x3e;= 0){
     //we already know about this topic, so publish to it and we&#x27;re done.
     doPublish();
     return;
  }

  // it&#x27;s a new topic for kafka
  var createTopicCallback = function(err){
         if(err){
            debug(&#x22;problem creating topic&#x22;,err);
            that.emit(&#x22;error&#x22;,err);
            return;
         }
         //do subscribers await this new topic?
         var wanted = that._subs_matcher.match(pubtopic);
         if(wanted.length === 0){
             // nobody subscribed at our end, so just publish to kafka
             doPublish();
             return;
         }
         // somebody wants messages published to the new topic
         for(var i=0;i&#x3c;wanted.length;i++){
            that._subs_counter.add(pubtopic);
         }
         if(that._consumer === undefined){
            // start the kafka consumer before publishing
            // starting the consumer will add the subscription
            that._startConn(doPublish);
            return;
         }
         // the kafka consumer is already running
         // just add the new subscriptions before publishing
         that.addKafkaSubscriptions([{topic: pubtopic}], function(){
             debug(&#x22;publish route 4&#x22;);
             doPublish();
         });
     };
  this.createTopics(pubtopic, createTopicCallback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();
  var that = this;
  // kafka cannot send a null message. Why are messages missing in the tests...
  if(message === undefined || message === null){
    message = &#x27;&#x27;;
  }
  var pubtopic = this._pubTopic(topic);
  var doPublish = function(){
    var payload = {
      messages: message,
      topic: pubtopic
    };
    debug(&#x22;about to publish new message to &#x22;,pubtopic);
    that._producer.send([payload], function(err,data) {
      if(err){
        debug(&#x22;something went wrong publishing to &#x22;+pubtopic,err);
        that.emit(&#x22;error&#x22;,err);
      }else{
        debug(&#x22;new message published to &#x22; + pubtopic);
      }
      util.wrap(done)();
    });
  };

  if(this._knowntopics.indexOf(pubtopic) &#x3e;= 0){
     //we already know about this topic, so publish to it and we&#x27;re done.
     doPublish();
     return;
  }

  // it&#x27;s a new topic for kafka
  var createTopicCallback = function(err){
         if(err){
            debug(&#x22;problem creating topic&#x22;,err);
            that.emit(&#x22;error&#x22;,err);
            return;
         }
         //do subscribers await this new topic?
         var wanted = that._subs_matcher.match(pubtopic);
         if(wanted.length === 0){
             // nobody subscribed at our end, so just publish to kafka
             doPublish();
             return;
         }
         // somebody wants messages published to the new topic
         for(var i=0;i&#x3c;wanted.length;i++){
            that._subs_counter.add(pubtopic);
         }
         if(that._consumer === undefined){
            // start the kafka consumer before publishing
            // starting the consumer will add the subscription
            that._startConn(doPublish);
            return;
         }
         // the kafka consumer is already running
         // just add the new subscriptions before publishing
         that.addKafkaSubscriptions([{topic: pubtopic}], function(){
             debug(&#x22;publish route 4&#x22;);
             doPublish();
         });
     };
  this.createTopics(pubtopic, createTopicCallback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.readZkTopics" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.readZkTopics">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>readZkTopics
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function readZkTopics(callback){
  var that = this;
  this._raiseIfClosed();
   this._producerClient.zk.client.getChildren(&#x22;/config/topics&#x22;, function (error, children, stats) {
     if (error) {
         callback(error,null);
         return;
     }
     callback(null,children);
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, onMessageReceived, done) {
  this._raiseIfClosed();
  var that = this;
  if(this._consumerStarting){
     debug(&#x22;waiting for consumer_connected before subscribing&#x22;);
     this.on(&#x22;consumer_connected&#x22;,function(){ that.subscribe(topic,onMessageReceived,done); });
     return;
  }

  debug(&#x22;subscribe called for &#x22;,topic);
  var subtopic = this._subTopic(topic);
  this._subs_matcher.add(subtopic,&#x27;x&#x27;);
  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,&#x27;wanted&#x27;);
  var subscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&#x3c;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &#x3e; 0){
      if(!(that._subs_counter.include(top))){
        subscribe_topics.push({topic: top});
      }
      that._subs_counter.add(top);
    }
  }

  this._ascoltatore.subscribe(topic, onMessageReceived);
  if(subscribe_topics.length === 0){
     defer(done);
     return;
  }

  if(this._consumer === undefined){
    this._startConn(done);
    return;
  }

  this.addKafkaSubscriptions(subscribe_topics, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, onMessageReceived, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, onMessageReceived, done) {
  this._raiseIfClosed();
  var that = this;
  if(this._consumerStarting){
     debug(&#x22;waiting for consumer_connected before subscribing&#x22;);
     this.on(&#x22;consumer_connected&#x22;,function(){ that.subscribe(topic,onMessageReceived,done); });
     return;
  }

  debug(&#x22;subscribe called for &#x22;,topic);
  var subtopic = this._subTopic(topic);
  this._subs_matcher.add(subtopic,&#x27;x&#x27;);
  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,&#x27;wanted&#x27;);
  var subscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&#x3c;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &#x3e; 0){
      if(!(that._subs_counter.include(top))){
        subscribe_topics.push({topic: top});
      }
      that._subs_counter.add(top);
    }
  }

  this._ascoltatore.subscribe(topic, onMessageReceived);
  if(subscribe_topics.length === 0){
     defer(done);
     return;
  }

  if(this._consumer === undefined){
    this._startConn(done);
    return;
  }

  this.addKafkaSubscriptions(subscribe_topics, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  var that = this;

  var subtopic = this._subTopic(topic);

  var newDone = function() {
    debug(&#x22;deregistered subscriber for topic &#x22; + subtopic);
    defer(done);
  };

  this._subs_matcher.remove(subtopic);
  this._ascoltatore.unsubscribe(topic, callback);
  if(this._consumerClient === undefined){
    newDone();
    return;
  }

  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,&#x27;unwanted&#x27;);
  var unsubscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&#x3c;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &#x3e; 0){
      that._subs_counter.remove(top);
      if(!(that._subs_counter.include(top))){
        unsubscribe_topics.push({topic: top});
      }
    }
  }

  if(unsubscribe_topics.length === 0 ) {
    newDone();
    return;
  }

  debug(&#x22;deregistering subscriber for topic &#x22; + unsubscribe_topics);
  this.withTopicPartitionsExpanded(this._consumerClient,unsubscribe_topics,function(err,partitions){
      if(err){
        debug(&#x22;problem expanding topics before unsubscribe&#x22;,err);
        that.emit(&#x22;error&#x22;,err);
        return;
      }
      that._consumer.removeTopics(partitions,function(err,removed){
          if(err){
            debug(&#x22;problem removing topics&#x22;,err);
            that.emit(&#x22;error&#x22;,err);
            return;
          }
          newDone();
       });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  var that = this;

  var subtopic = this._subTopic(topic);

  var newDone = function() {
    debug(&#x22;deregistered subscriber for topic &#x22; + subtopic);
    defer(done);
  };

  this._subs_matcher.remove(subtopic);
  this._ascoltatore.unsubscribe(topic, callback);
  if(this._consumerClient === undefined){
    newDone();
    return;
  }

  var matcher = new Qlobber(this._qlobber_opts);
  matcher.add(subtopic,&#x27;unwanted&#x27;);
  var unsubscribe_topics = [];
  for (var i=0, l=this._knowntopics.length; i&#x3c;l; i++){
    var top = this._knowntopics[i];
    if(matcher.match(top).length &#x3e; 0){
      that._subs_counter.remove(top);
      if(!(that._subs_counter.include(top))){
        unsubscribe_topics.push({topic: top});
      }
    }
  }

  if(unsubscribe_topics.length === 0 ) {
    newDone();
    return;
  }

  debug(&#x22;deregistering subscriber for topic &#x22; + unsubscribe_topics);
  this.withTopicPartitionsExpanded(this._consumerClient,unsubscribe_topics,function(err,partitions){
      if(err){
        debug(&#x22;problem expanding topics before unsubscribe&#x22;,err);
        that.emit(&#x22;error&#x22;,err);
        return;
      }
      that._consumer.removeTopics(partitions,function(err,removed){
          if(err){
            debug(&#x22;problem removing topics&#x22;,err);
            that.emit(&#x22;error&#x22;,err);
            return;
          }
          newDone();
       });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicOffsetsAdded" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicOffsetsAdded">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicOffsetsAdded
        <span class="apidocSignatureSpan">(client, topics, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function withTopicOffsetsAdded(client, topics, callback){
     var that = this;
     this.withTopicPartitionsExpanded(client, topics, function(err, partitions){
       if(err){
           callback(err,null);
           return;
       }
       for(var i=0;i&#x3c;partitions.length;i++){
          partitions[i].time = -1;
          partitions[i].maxNum = 1;
       }
       var kafka = that._opts.kafka;
       var offset = new kafka.Offset(client);
       offset.fetch(partitions, function (err, data) {
           if(err){
             callback(err,null);
             return;
           }
           var offsets = [];
           for (var topic in data) {
             if (data.hasOwnProperty(topic)) {
                for(var partition in data[topic]){
                   if(data[topic].hasOwnProperty(partition)){
                      offsets.push({topic: topic, partition: parseInt(partition), offset: data[topic][partition][0]});
                   }
                }
             }
           }
           callback(null,offsets);
       });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicPartitionsExpanded" id="apidoc.element.ascoltatori.KafkaAscoltatore.prototype.withTopicPartitionsExpanded">
        function <span class="apidocSignatureSpan">ascoltatori.KafkaAscoltatore.prototype.</span>withTopicPartitionsExpanded
        <span class="apidocSignatureSpan">(client, topics, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function withTopicPartitionsExpanded(client, topics, callback){
  var that = this;
  var wanted = [];
  topics.forEach(function(t){
     wanted.push(t.topic);
  });
  client.loadMetadataForTopics(wanted, function(err, results) {
       if(err){
          callback(err,null);
          return;
       }
       var metadata = results[1].metadata;
       var partitions = [];
       for(var i=0;i&#x3c;topics.length;i++){
           var topic = topics[i].topic;
           if (topic in metadata){
             var dictionary = metadata[topic];
             for (var key in dictionary) {
               if (dictionary.hasOwnProperty(key)) {
                  partitions.push({topic: topic, partition: dictionary[key].partition, time: -1, maxNum: 1});
               }
             }
           }
       }
       callback(null,partitions);
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MQTTAscoltatore" id="apidoc.module.ascoltatori.MQTTAscoltatore">module ascoltatori.MQTTAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.MQTTAscoltatore" id="apidoc.element.ascoltatori.MQTTAscoltatore.MQTTAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MQTTAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MQTTAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;/&#x27;,
    wildcardOne: &#x27;+&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.mqtt = this._opts.mqtt || require(&#x22;mqtt&#x22;);

  this._subs_counter = new SubsCounter();

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MQTTAscoltatore.prototype" id="apidoc.module.ascoltatori.MQTTAscoltatore.prototype">module ascoltatori.MQTTAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype._startConn" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype._startConn">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>_startConn
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startConn = function () {
  var that = this;
  var url = that._opts.url;
  var settings = null;

  if (this._client === undefined) {
    debug(&#x22;connecting..&#x22;);
    if (url) {
      this._client = this._opts.mqtt.connect(url, that._opts);
    } else {
      this._client = this._opts.mqtt.connect(that._opts);
    }

    this._client.setMaxListeners(0);
    this._client.on(&#x22;connect&#x22;, function() {
      debug(&#x22;connected&#x22;);
      that.reconnectTopics(function(){
        that.emit(&#x22;ready&#x22;);
      });
    });
    this._client.on(&#x22;message&#x22;, function(topic, payload, packet) {
      debug(&#x22;received new packet on topic &#x22; + topic);
      // we need to skip out this callback, so we do not
      // break the client when an exception occurs
      defer(function() {
        that._ascoltatore.publish(that._recvTopic(topic), payload, packet);
      });
    });
    this._client.on(&#x27;error&#x27;, function(e) {
      debug(&#x22;error in the client&#x22;);

      delete that._client;
      that.emit(&#x22;error&#x22;, e);
    });
  }
  return this._client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.close" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;
  debug(&#x22;closing&#x22;);
  if (!this._closed) {
    this._subs_counter.clear();
    this._client.once(&#x22;close&#x22;, function() {
      debug(&#x22;closed&#x22;);
      that._ascoltatore.close();
      delete that._client;
      that.emit(&#x22;closed&#x22;);
      defer(done);
    });
    this._client.end();
  } else {
    wrap(done)();
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  this._client.publish(this._pubTopic(topic), message, {
    qos: (options &#x26;&#x26; (options.qos !== undefined)) ? options.qos : 1,
    retain: (options &#x26;&#x26; (options.retain !== undefined)) ? options.retain : false
  }, function() {
    debug(&#x22;new message published to &#x22; + topic);
    wrap(done)();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  this._client.publish(this._pubTopic(topic), message, {
    qos: (options &#x26;&#x26; (options.qos !== undefined)) ? options.qos : 1,
    retain: (options &#x26;&#x26; (options.retain !== undefined)) ? options.retain : false
  }, function() {
    debug(&#x22;new message published to &#x22; + topic);
    wrap(done)();
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.reconnectTopics" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.reconnectTopics">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>reconnectTopics
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function reconnectTopics(cb) {
  var that = this;

  var subscribedTopics = that._subs_counter.keys();

  var opts = {
    qos: 1
  };

  steed.each(subscribedTopics, function(topic, callback) {
    that._client.subscribe(that._subTopic(topic), opts, function() {
      debug(&#x22;re-registered subscriber for topic &#x22; + topic);
      callback();
    });
  }, function(){
    cb();
  });

}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  if (!this._subs_counter.include(topic)) {
    debug(&#x22;registering new subscriber for topic &#x22; + topic);

    var opts = {
      qos: 1
    };
    this._client.subscribe(this._subTopic(topic), opts, function() {
      debug(&#x22;registered new subscriber for topic &#x22; + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);
  this._ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  if (!this._subs_counter.include(topic)) {
    debug(&#x22;registering new subscriber for topic &#x22; + topic);

    var opts = {
      qos: 1
    };
    this._client.subscribe(this._subTopic(topic), opts, function() {
      debug(&#x22;registered new subscriber for topic &#x22; + topic);
      defer(done);
    });
  } else {
    defer(done);
  }

  this._subs_counter.add(topic);
  this._ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = null;

  newDone = function() {
    debug(&#x22;deregistered subscriber for topic &#x22; + topic);
    defer(done);
  };

  this._ascoltatore.unsubscribe(topic, callback);
  this._subs_counter.remove(topic);

  if (this._subs_counter.include(topic)) {
    newDone();
    return;
  }

  debug(&#x22;deregistering subscriber for topic &#x22; + topic);
  this._client.unsubscribe(this._subTopic(topic), newDone);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.MQTTAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MQTTAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = null;

  newDone = function() {
    debug(&#x22;deregistered subscriber for topic &#x22; + topic);
    defer(done);
  };

  this._ascoltatore.unsubscribe(topic, callback);
  this._subs_counter.remove(topic);

  if (this._subs_counter.include(topic)) {
    newDone();
    return;
  }

  debug(&#x22;deregistering subscriber for topic &#x22; + topic);
  this._client.unsubscribe(this._subTopic(topic), newDone);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MongoAscoltatore" id="apidoc.module.ascoltatori.MongoAscoltatore">module ascoltatori.MongoAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.MongoAscoltatore" id="apidoc.element.ascoltatori.MongoAscoltatore.MongoAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>MongoAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MongoAscoltatore = function (opts) {
  AbstractAscoltatore.call(this);

  if (typeof opts.db === &#x27;string&#x27; || opts.uri) {
    // old options
    opts.uri = opts.uri || &#x27;mongodb://127.0.0.1/&#x27;;
    opts.db = opts.db || &#x27;ascoltatori&#x27;;
    opts.url = opts.uri + opts.db + &#x27;?auto_reconnect=true&#x27;;
    delete opts.db;
  }

  this._opts = opts || {};
  this.url = this._opts.url || &#x27;mongodb://127.0.0.1/ascoltatori?auto_reconnect=true&#x27;;
  this._pubsubCollection = opts.pubsubCollection || &#x27;pubsub&#x27;;
  this._maxRetry = opts.maxRetry || 5;
  this.mongoOpts = this._opts.mongo || {};

  this._ascoltatore = new TrieAscoltatore(opts);

  this.channels = {};
  this._closed = false;

  this._handlingCursorFailure = false;
  this._lastSuccessfulHandling = new ObjectID();

  this.wait = this._opts.wait || 100;

  this.connectionParams = {
    capped: true,
    size: this._opts.size || 10 * 1024 * 1024, // 10 MB
    max: this._opts.max || 10000 // documents
  };

  var that = this;

  var setupDB = function(err, db) {
    if (err) {
      that.emit(&#x27;error&#x27;, err);
      return;
    }

    that.db = db;

    // creating the capped collection where we can exchange messages
    that.db.createCollection(that._pubsubCollection, that.connectionParams, function(err, collection) {
      if (err) {
        that.emit(&#x27;error&#x27;, err);
      } else {
        that.collection = collection;

        debug(&#x27;ready&#x27;);

        // create a new object id. We will get all the events from now on
        that._poll(new ObjectID());

        that.emit(&#x27;ready&#x27;);
      }
    });
  };

  if (opts.db) {
    setupDB(null, opts.db);
  } else {
    MongoClient.connect(this.url, this.mongoOpts, setupDB);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.MongoAscoltatore.prototype" id="apidoc.module.ascoltatori.MongoAscoltatore.prototype">module ascoltatori.MongoAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._checkCappedAndPoll" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._checkCappedAndPoll">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_checkCappedAndPoll
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_checkCappedAndPoll = function (latest) {
  debug(&#x27;checkCappedAndPoll&#x27;);
  var that = this;
  this.collection.isCapped(function(err, isCapped) {
    if (err) {
      debug(&#x27;checkCappedAndPoll -&#x3e; Cannot stat isCapped. Give up&#x27;);
      that.emit(&#x27;error&#x27;, new Error(&#x27;Cannot stat if collection is capped or not&#x27;));
      that._handlingCursorFailure = false;
      return;
    }
    if (!isCapped) {
      debug(&#x27;checkCappedAndPoll -&#x3e; Collection is not capped. Give up&#x27;);
      that.emit(&#x27;error&#x27;, new Error(&#x27;Cannot recover. Collection is not capped.&#x27;));
      that._handlingCursorFailure = false;
    } else {
      debug(&#x27;checkCappedAndPoll -&#x3e; Capped Ok. Poll.&#x27;);
      that._poll(latest);
      that._handlingCursorFailure = false;
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._disconnected" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._disconnected">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_disconnected
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_disconnected = function () {
  return this.db.db.state === &#x27;disconnected&#x27;;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handle" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._handle">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handle
        <span class="apidocSignatureSpan">(die, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_handle = function (die, callback) {

  debug(&#x27;handle&#x27;);

  var that = this;

  return function() {
    if (that._disconnected()) {
      debug(&#x27;disconnected&#x27;);
      return;
    }

    var args = [].slice.call(arguments),
      err = args.shift();

    if (err &#x26;&#x26; !that._closed) {
      that._handleCursorClosed(that._lastSuccessfulHandling);
      return;
    }

    if (err &#x26;&#x26; die) {
      debug(&#x27;ERROR: &#x27; + err);
      return;
    }

    debug(&#x27;handle -&#x3e; calling the callback&#x27;);
    callback.apply(that, args);
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._handleCursorClosed" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._handleCursorClosed">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_handleCursorClosed
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_handleCursorClosed = function (latest) {
  debug(&#x27;handleCursorClosed&#x27;);
  if (this._closed !== false) {
    // Handle cursor closed. But we&#x27;re closed actually. Do nothing
    return;
  }
  if (this._handlingCursorFailure !== false) {
    // Already handling this failure
    return;
  }
  var that = this;

  this._handlingCursorFailure = true;

  // Kind of hacky solution, I would prefer catch some mongo events
  // but unfortunately...
  var retry = 0;
  var reconnect = function () {
    debug(&#x27;handleCursorClosed -&#x3e; Wait for the database to be connected...&#x27;);
    that.db.db(that.db.databaseName).stats({}, function (err, stats) {
      var success = true;
      if (err) {
        debug(&#x27;handleCursorClosed -&#x3e; Stats failed: &#x27; + err);
        success = false;
      } else if (!stats.ok) {
        debug(&#x27;handleCursorClosed -&#x3e; Stats says that DB is not ok : &#x27; + stats);
        success = false;
      }
      if (success === false) {
        retry++;
        debug(&#x27;handleCursorClosed -&#x3e; Handle cursor failed: retry #&#x27; + retry);
        if (retry &#x3c; that._maxRetry) {
          setTimeout(reconnect, 5000);
        } else {
          that.emit(&#x27;error&#x27;, new Error(&#x27;Mongo is out of order&#x27;));
          that._handlingCursorFailure = false;
        }
      } else {
        debug(&#x22;handleCursorClosed -&#x3e;  We&#x27;re now ready. Poll.&#x22;);
        that._checkCappedAndPoll(latest);
      }
    });
  };

  reconnect();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._more" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._more">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_more
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_more = function (latest) {
  var that = this;

  debug(&#x27;more&#x27;);

  that._cursor.each(that._handle(true, function(doc) {

    var value;

    if (!doc) {
      debug(&#x27;setting the subscriber polling&#x27;);
      that._pollTimeout = setTimeout(function() {
        that._poll(latest);
      }, that.wait);
      return;
    }

    debug(&#x27;calling the subscriber callback&#x27;);

    latest = latest &#x3e; doc._id ? latest: doc._id;
    that._lastSuccessfulHandling = latest;

    if (!that._closed) {
      if (doc.value &#x26;&#x26; doc.value.buffer) {
        value = doc.value.buffer;
      } else {
        value = doc.value;
      }

      that._ascoltatore.publish(doc.topic, value, doc.options);
    }
  }));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype._poll" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype._poll">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>_poll
        <span class="apidocSignatureSpan">(latest)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_poll = function (latest) {
  debug(&#x27;poll&#x27;);

  var options = {
    tailable: true,
    awaitdata: true,
    numberOfRetries: -1
  };

  this._cursor = this.collection.find({ _id: { $gt: latest } }, options);

  // we have created only the cursor, now take a look at the messages arrived until now
  this._more(latest);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.close" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;
  var closeEmbedded = function() {
    that._ascoltatore.close(function() {
      that.emit(&#x22;closed&#x22;);
      if (done) {
        done();
      }
    });
  };

  if (this._pollTimeout) {
    clearTimeout(this._pollTimeout);
  }

  that._closed = true;

  steed.series([
    function(cb) {
      if (that._cursor) {
        that._cursor.close(cb);
        delete that._cursor;
      } else {
        cb();
      }
    },
    function(cb) {
      that.db.close(cb);
    }
  ], closeEmbedded);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done) {
  this._raiseIfClosed();
  message = message || &#x22;&#x22;;
  done = done || function() {};

  var messageObj = {
    value: message,
    topic: topic,
    options: options
  };

  debug(&#x27;publishing message&#x27;, messageObj);

  this.collection.insert(messageObj, { w: 1 }, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done) {
  this._raiseIfClosed();
  message = message || &#x22;&#x22;;
  done = done || function() {};

  var messageObj = {
    value: message,
    topic: topic,
    options: options
  };

  debug(&#x27;publishing message&#x27;, messageObj);

  this.collection.insert(messageObj, { w: 1 }, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">sub = function (topic, callback, done) {
  this._raiseIfClosed();

  debug(&#x27;subscribe&#x27;);
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">subscribe = function (topic, callback, done) {
  this._raiseIfClosed();

  debug(&#x27;subscribe&#x27;);
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsub = function () {
  this._raiseIfClosed();
  this._ascoltatore.unsubscribe.apply(this._ascoltatore, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.MongoAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.MongoAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">unsubscribe = function () {
  this._raiseIfClosed();
  this._ascoltatore.unsubscribe.apply(this._ascoltatore, arguments);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.PrefixAscoltatore" id="apidoc.module.ascoltatori.PrefixAscoltatore">module ascoltatori.PrefixAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.PrefixAscoltatore" id="apidoc.element.ascoltatori.PrefixAscoltatore.PrefixAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>PrefixAscoltatore
        <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrefixAscoltatore(prefix, ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore || new TrieAscoltatore());

  this._prefix = prefix;
  this._separator = this._ascoltatore._separator;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Klass = (typeof opts.type === &#x27;function&#x27;) ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">PrefixAscoltatore</span>(opts.prefix, result)
    .once(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once(&#x22;error&#x22;, done);
}
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.PrefixAscoltatore.prototype" id="apidoc.module.ascoltatori.PrefixAscoltatore.prototype">module ascoltatori.PrefixAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._localToParent" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype._localToParent">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_localToParent
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_localToParent = function (topic) {
  var newTopic = this._prefix;
  newTopic += (topic.indexOf(this._separator) !== 0) ? this._separator : &#x27;&#x27;;
  newTopic += topic;
  debug(&#x22;rewriting local topic &#x22; + topic + &#x22; into &#x22; + newTopic);
  return newTopic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype._parentToLocal" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype._parentToLocal">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>_parentToLocal
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_parentToLocal = function (topic) {
  var newTopic;
  if (topic.lastIndexOf(this._prefix + this._separator, 0) === 0) {
    newTopic = topic.substr(this._prefix.length + 1);
  } else {
    newTopic = topic;
  }
  debug(&#x22;rewriting remote topic &#x22; + topic + &#x22; into &#x22; + newTopic);
  return newTopic;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapCallback" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapCallback">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapCallback
        <span class="apidocSignatureSpan">(callback, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapCallback = function (callback, next) {
  var that = this;
  if (!callback._prefix_ascoltatore_wrapper) {
    callback._prefix_ascoltatore_wrapper = function(t, payload, options) {
      callback(that._parentToLocal(t), payload, options);
    };
  }
  next(null, callback._prefix_ascoltatore_wrapper);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapTopic" id="apidoc.element.ascoltatori.PrefixAscoltatore.prototype.wrapTopic">
        function <span class="apidocSignatureSpan">ascoltatori.PrefixAscoltatore.prototype.</span>wrapTopic
        <span class="apidocSignatureSpan">(topic, next)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">wrapTopic = function (topic, next) {
  next(null, this._localToParent(topic));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.RedisAscoltatore" id="apidoc.module.ascoltatori.RedisAscoltatore">module ascoltatori.RedisAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.RedisAscoltatore" id="apidoc.element.ascoltatori.RedisAscoltatore.RedisAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>RedisAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;/&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;*&#x27;
  });

  this._ready_sub = false;
  this._ready_pub = false;
  this._opts = opts || {};

  this._ascoltatores = {};

  this._startSub();
  this._startPub();

  this._subs_counter = new SubsCounter();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.RedisAscoltatore.prototype" id="apidoc.module.ascoltatori.RedisAscoltatore.prototype">module ascoltatori.RedisAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._containsWildcard" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._containsWildcard">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_containsWildcard
        <span class="apidocSignatureSpan">(topic)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_containsWildcard = function (topic) {
  return (topic.indexOf(this._wildcardOne) &#x3e;= 0) ||
         (topic.indexOf(this._wildcardSome) &#x3e;= 0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startPub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._startPub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startPub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startPub = function () {
  var that = this;
  if (this._client === undefined) {
    this._client = createConn(this._opts, &#x27;client_conn&#x27;);
    this._client.on(&#x22;ready&#x22;, function() {
      debug(&#x22;created pub connection&#x22;);
      that._updateReady(&#x22;_ready_pub&#x22;);
    });
  }
  return this._client;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._startSub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._startSub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_startSub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startSub = function () {
  var that = this,
    handler = null;

  if (this._sub === undefined) {
    this._sub = createConn(this._opts, &#x27;sub_conn&#x27;);
    this._sub.on(&#x22;ready&#x22;, function() {
      debug(&#x22;created sub connection&#x22;);
      that._updateReady(&#x22;_ready_sub&#x22;);
    });

    handler = function(sub, topic, payload) {
      topic = topic.toString(); // cast to string in case of Buffer instance (nodejs-redis &#x3e;=2.0)
      debug(&#x22;new message received for topic &#x22; + topic);
      defer(function() {
        // we need to skip out this callback, so we do not
        // break the client when an exception occurs
        var ascoltatore = that._ascoltatores[sub];
        topic = topic.replace(new RegExp(&#x27;/$&#x27;), &#x27;&#x27;);
        topic = that._recvTopic(topic);

        payload = msgpack.decode(payload);

        if (ascoltatore) {
          ascoltatore.publish(topic, payload.message, payload.options);
        } else {
          debug(&#x22;no ascoltatore for subscription: &#x22; + sub);
        }
      });
    };

    this._sub.on(&#x22;messageBuffer&#x22;, function (topic, message) {
      handler(topic, topic, message);
    });
    this._sub.on(&#x22;pmessageBuffer&#x22;, function(sub, topic, message) {
      handler(sub, topic, message);
    });
  }

  return this._sub;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype._updateReady" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype._updateReady">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>_updateReady
        <span class="apidocSignatureSpan">(key)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function updateReady(key) {
  this[key] = true;
  if (this._ready_pub &#x26;&#x26; this._ready_sub) {
    this.emit(&#x22;ready&#x22;);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.close" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this,
    newDone = null,
    closes = 2;

  newDone = function() {
    debug(&#x22;closed&#x22;);
    defer(done);
  };

  if (this._closed) {
    newDone();
    return;
  }

  this._subs_counter.clear();
  [&#x22;_sub&#x22;, &#x22;_client&#x22;].forEach(function(c) {
    if (that[c] !== undefined) {
      that[c].on(&#x22;end&#x22;, function() {
        closes = closes - 1;
        if (closes === 0) {
          newDone();
        }
      });
      that[c].quit();
      delete that[c];
    } else {
      closes = closes - 1;
    }
  });

  for (var subTopic in this._ascoltatores) {
    this._ascoltatores[subTopic].close();
  }
  this._ascoltatores = {};

  this.emit(&#x22;closed&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  if (message === undefined || message === null) {
    message = false; // so we can convert it to JSON
  }

  var payload = {
    message: message,
    options: options
  };

  topic = this._pubTopic(topic);

  if (!topic.match(new RegExp(&#x27;/$&#x27;))) {
    topic += &#x27;/&#x27;;
  }

  this._client.publish(topic, msgpack.encode(payload), function() {
    debug(&#x22;new message published to &#x22; + topic);
    defer(done);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, options, done) {
  this._raiseIfClosed();

  if (message === undefined || message === null) {
    message = false; // so we can convert it to JSON
  }

  var payload = {
    message: message,
    options: options
  };

  topic = this._pubTopic(topic);

  if (!topic.match(new RegExp(&#x27;/$&#x27;))) {
    topic += &#x27;/&#x27;;
  }

  this._client.publish(topic, msgpack.encode(payload), function() {
    debug(&#x22;new message published to &#x22; + topic);
    defer(done);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = function() {
    debug(&#x22;registered new subscriber for topic &#x22; + topic);
    defer(done);
  };

  var subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp(&#x27;[/*]$&#x27;))) {
    subTopic += &#x27;/&#x27;;
  }

  if (this._containsWildcard(topic)) {
    this._sub.psubscribe(subTopic, newDone);
  } else {
    this._sub.subscribe(subTopic, newDone);
  }

  debug(&#x22;redis subscription topic is &#x22; + subTopic);
  this._subs_counter.add(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (!ascoltatore) {
    ascoltatore = this._ascoltatores[subTopic] = new TrieAscoltatore(this._opts);
  }

  ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();

  var newDone = function() {
    debug(&#x22;registered new subscriber for topic &#x22; + topic);
    defer(done);
  };

  var subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp(&#x27;[/*]$&#x27;))) {
    subTopic += &#x27;/&#x27;;
  }

  if (this._containsWildcard(topic)) {
    this._sub.psubscribe(subTopic, newDone);
  } else {
    this._sub.subscribe(subTopic, newDone);
  }

  debug(&#x22;redis subscription topic is &#x22; + subTopic);
  this._subs_counter.add(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (!ascoltatore) {
    ascoltatore = this._ascoltatores[subTopic] = new TrieAscoltatore(this._opts);
  }

  ascoltatore.subscribe(topic, callback);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var isWildcard = this._containsWildcard(topic),
      subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp(&#x27;[/*]$&#x27;))) {
    subTopic += &#x27;/&#x27;;
  }

  this._subs_counter.remove(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (ascoltatore) {
    ascoltatore.unsubscribe(topic, callback);
  }

  var newDone = function() {
    debug(&#x22;deregistered subscriber for topic &#x22; + topic);
    defer(done);
  };

  if (this._subs_counter.include(subTopic)) {
    newDone();
    return this;
  }

  if (ascoltatore) {
    ascoltatore.close();
    delete this._ascoltatores[subTopic];
  }

  if (isWildcard) {
    this._sub.punsubscribe(subTopic, newDone);
  } else {
    this._sub.unsubscribe(subTopic, newDone);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.RedisAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.RedisAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  var isWildcard = this._containsWildcard(topic),
      subTopic = this._subTopic(topic);

  if (!subTopic.match(new RegExp(&#x27;[/*]$&#x27;))) {
    subTopic += &#x27;/&#x27;;
  }

  this._subs_counter.remove(subTopic);

  var ascoltatore = this._ascoltatores[subTopic];

  if (ascoltatore) {
    ascoltatore.unsubscribe(topic, callback);
  }

  var newDone = function() {
    debug(&#x22;deregistered subscriber for topic &#x22; + topic);
    defer(done);
  };

  if (this._subs_counter.include(subTopic)) {
    newDone();
    return this;
  }

  if (ascoltatore) {
    ascoltatore.close();
    delete this._ascoltatores[subTopic];
  }

  if (isWildcard) {
    this._sub.punsubscribe(subTopic, newDone);
  } else {
    this._sub.unsubscribe(subTopic, newDone);
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.SubsCounter" id="apidoc.module.ascoltatori.SubsCounter">module ascoltatori.SubsCounter</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.SubsCounter" id="apidoc.element.ascoltatori.SubsCounter.SubsCounter">
        function <span class="apidocSignatureSpan">ascoltatori.</span>SubsCounter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SubsCounter() {
  this.clear();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.SubsCounter.prototype" id="apidoc.module.ascoltatori.SubsCounter.prototype">module ascoltatori.SubsCounter.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.add" id="apidoc.element.ascoltatori.SubsCounter.prototype.add">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>add
        <span class="apidocSignatureSpan">(elem)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">add = function (elem) {
  if (!this.include(elem)) {
    this._length += 1;
    this._obj[elem] = 1;
  } else {
    this._obj[elem] = this._obj[elem] + 1;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.clear" id="apidoc.element.ascoltatori.SubsCounter.prototype.clear">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>clear
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">clear = function () {
  this._length = 0;
  this._obj = {};
  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.forEach" id="apidoc.element.ascoltatori.SubsCounter.prototype.forEach">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>forEach
        <span class="apidocSignatureSpan">(callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forEach = function (callback) {
  var key = null;
  for (key in this._obj) {
    if (this._obj.hasOwnProperty(key)) {
      callback(key);
    }
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.include" id="apidoc.element.ascoltatori.SubsCounter.prototype.include">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>include
        <span class="apidocSignatureSpan">(elem)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">include = function (elem) {
  return this._obj[elem] !== undefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.keys" id="apidoc.element.ascoltatori.SubsCounter.prototype.keys">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>keys
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">keys = function () {
  var array = [];
  this.forEach(function(e) {
    array.push(e);
  });
  return array;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.SubsCounter.prototype.remove" id="apidoc.element.ascoltatori.SubsCounter.prototype.remove">
        function <span class="apidocSignatureSpan">ascoltatori.SubsCounter.prototype.</span>remove
        <span class="apidocSignatureSpan">(elem)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">remove = function (elem) {
  if (!this.include(elem)) {
    return this;
  }

  if (this._obj[elem] === 1) {
    this._length -= 1;
    delete this._obj[elem];
  } else {
    this._obj[elem] = this._obj[elem] - 1;
  }

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.TrieAscoltatore" id="apidoc.module.ascoltatori.TrieAscoltatore">module ascoltatori.TrieAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.TrieAscoltatore" id="apidoc.element.ascoltatori.TrieAscoltatore.TrieAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>TrieAscoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TrieAscoltatore(settings) {
  AbstractAscoltatore.call(this, settings);

  settings = settings || {};

  this._matcher = new Qlobber({
    separator: settings.separator || &#x27;/&#x27;,
    wildcard_one: settings.wildcardOne || &#x27;+&#x27;,
    wildcard_some: settings.wildcardSome || &#x27;*&#x27;
  });

  this.emit(&#x22;ready&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.TrieAscoltatore.prototype" id="apidoc.module.ascoltatori.TrieAscoltatore.prototype">module ascoltatori.TrieAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.close" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  this._matcher.clear();
  this.emit(&#x22;closed&#x22;);

  debug(&#x22;closed&#x22;);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">pub = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug(&#x22;new message published to &#x22; + topic);

  var cbs = this._matcher.match(topic);

  for (var i = 0; i &#x3c; cbs.length; i++) {
    cbs[i](topic, message, options);
  }

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, options, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">publish = function (topic, message, options, done) {
  this._raiseIfClosed();
  debug(&#x22;new message published to &#x22; + topic);

  var cbs = this._matcher.match(topic);

  for (var i = 0; i &#x3c; cbs.length; i++) {
    cbs[i](topic, message, options);
  }

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;registered new subscriber for topic &#x22; + topic);

  this._matcher.add(topic, callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;registered new subscriber for topic &#x22; + topic);

  this._matcher.add(topic, callback);
  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._matcher.remove(topic, callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.TrieAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.TrieAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();

  debug(&#x22;deregistered subscriber for topic &#x22; + topic);

  this._matcher.remove(topic, callback);

  defer(done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore" id="apidoc.module.ascoltatori.ZeromqAscoltatore">module ascoltatori.ZeromqAscoltatore</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.ZeromqAscoltatore" id="apidoc.element.ascoltatori.ZeromqAscoltatore.ZeromqAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.</span>ZeromqAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ZeromqAscoltatore(opts) {
  AbstractAscoltatore.call(this);

  this._opts = opts || {};
  this._opts.delay = this._opts.delay || 5;
  this._opts.zmq = this._opts.zmq || require(&#x22;zmq&#x22;);

  this._connectedControls = [];

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startSubs();
  this._startPub();
  this._startControl();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.ZeromqAscoltatore.prototype" id="apidoc.module.ascoltatori.ZeromqAscoltatore.prototype">module ascoltatori.ZeromqAscoltatore.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._connectSub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._connectSub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_connectSub
        <span class="apidocSignatureSpan">(port, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_connectSub = function (port, callback) {
  var that = this,
    conn = createConn(that._opts, &#x22;sub&#x22;);

  port = String(port);

  debug(&#x22;connecting to port &#x22; + port);
  conn.port = port;
  conn.connect(port);
  conn.subscribe(&#x22;&#x22;);
  that._sub_conns.push(conn);

  conn.on(&#x22;message&#x22;, function(data) {
    data = data.toString();
    var topic = null,
      message = null;

    topic = data.substr(0, data.indexOf(&#x22; &#x22;));
    message = data.substr(data.indexOf(&#x22; &#x22;) + 1);

    that._ascoltatore.publish(topic, message);

    debug(&#x22;new message received for topic &#x22; + topic);
  });

  setTimeout(function() {
    debug(&#x22;connected and subscribed to &#x22; + port);
    defer(callback);
  }, this._opts.delay);

  return this;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startControl" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startControl">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startControl
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startControl = function () {
  var that = this;
  if (that._control_conn === undefined) {
    that._control_conn = createConn(that._opts, &#x22;req&#x22;);
    debug(&#x22;opening control port &#x22; + that._opts.controlPort);
    that._control_conn.bind(that._opts.controlPort, function(err) {
      if (err) {
        throw err;
      }

      debug(&#x22;bound the control connection to port &#x22; + that._opts.controlPort);

      that._control_conn_interval = setInterval(function() {
        var packet = that._sub_conns.map(function(c) {
          return c.port;
        }).join(&#x22;,&#x22;);
        debug(&#x22;sending control packet &#x22; + packet);
        that._control_conn.send(packet);
      }, 250);

      that._control_conn.on(&#x22;message&#x22;, function(data) {
        var dest = String(data);
        debug(&#x22;received connect response from &#x22; + dest);
        if (that._sub_conns.findIndex(function (conn) {
          return conn.port === dest;
        }) === -1) {
          that._connectSub(dest);
        }
      });
    });
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startPub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startPub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startPub
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startPub = function () {
  var that = this;
  if (that._pub_conn === undefined) {
    that._pub_conn = createConn(that._opts, &#x22;pub&#x22;);
    debug(&#x22;opening pub port &#x22; + that._opts.port);
    that._pub_conn.bind(that._opts.port, function(err) {
      if (err) {
        throw err;
      }

      debug(&#x22;bound the publish connection to port &#x22; + that._opts.port);

      setTimeout(function() {
        that._connectSub(that._opts.port, function() {
          that.emit(&#x22;ready&#x22;);
        });
      }, that._opts.delay);
    });
  }
  return that._pub_conn;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startSubs" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype._startSubs">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>_startSubs
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_startSubs = function () {
  var that = this;
  if (this._sub_conns === undefined) {
    that._sub_conns = [];
    that._opts.remotePorts = that._opts.remotePorts || [];
    that._opts.remotePorts.forEach(function(port) {
      that.connect(port);
    });
  }
  return this._sub_conns;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.close" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.close">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>close
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function close(done) {
  var that = this;

  if (this._closed) {
    defer(done);
    return;
  }

  if (that._sub_conns !== undefined) {
    that._sub_conns.forEach(function(s) {
      s.close();
    });
    delete that._sub_conns;
  }

  that._connectedControls.forEach(function(s) {
    s.close();
  });

  if (that._pub_conn !== undefined) {
    that._pub_conn.close();
    delete that._pub_conn;
  }

  if (that._control_conn !== undefined &#x26;&#x26; that._control_conn._zmq.state === 0) {
    that._control_conn.close();
    clearInterval(that._control_conn_interval);
    delete that._control_conn_interval;
  }

  setTimeout(function() {
    debug(&#x22;closed&#x22;);
    that._ascoltatore.close();
    that.emit(&#x22;closed&#x22;);
    defer(done);
  }, this._opts.delay);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

it(&#x22;should have a close function&#x22;, function() {
  var that = this;
  expect(that.instance).to.respondTo(&#x22;close&#x22;);
});

it(&#x22;should throw an error if publishing when the ascoltatore has been closed&#x22;, function(done) {
  this.instance.<span class="apidocCodeKeywordSpan">close</span>(function() {
    expect(function() {
      this.instance.publish(&#x22;hello&#x22;, &#x22;world&#x22;);
    }).to.throw;
    done();
  });
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.connect" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.connect">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>connect
        <span class="apidocSignatureSpan">(port, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function connect(port, callback) {
  var that = this,
    conn = null;

  conn = createConn(that._opts, &#x22;rep&#x22;);

  conn.connect(port);

  that._connectedControls.push(conn);

  conn.on(&#x22;message&#x22;, function(data) {
    debug(&#x22;received connect request from &#x22; + data);
    conn.send(that._opts.port);

    var dests = String(data).split(&#x22;,&#x22;).filter(function(dest) {
      var found = true;
      that._sub_conns.forEach(function(conn) {
        if (conn.port === dest) {
          found = false;
        }
      });
      return found;
    }).map(function(dest) {
      return function(cb) {
        that._connectSub(dest, cb);
      };
    });

    steed.parallel(dests, function() {
      setTimeout(function() {
        wrap(callback)();
      }, that._opts.delay);
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

It is also possible to reuse an existing mongodb connection:

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);
var MongoClient = require(&#x27;mongodb&#x27;).MongoClient;

MongoClient.<span class="apidocCodeKeywordSpan">connect</span>(&#x27;mongodb://127.0.0.1/ascoltatori&#x27;, {}, function (err, db
) {
var settings = {
  type: &#x27;mongo&#x27;,
  db: db,
  pubsubCollection: &#x27;ascoltatori&#x27;
};
ascoltatori.build(settings, function (err, ascoltatore) {
  // ...
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.pub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.pub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>pub
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  var toSend = topic + &#x22; &#x22; + message;

  this._pub_conn.send(toSend);
  debug(&#x22;new message published to &#x22; + topic);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.<span class="apidocCodeKeywordSpan">pub</span>(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.publish" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.publish">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>publish
        <span class="apidocSignatureSpan">(topic, message, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function publish(topic, message, done) {
  this._raiseIfClosed();

  var toSend = topic + &#x22; &#x22; + message;

  this._pub_conn.send(toSend);
  debug(&#x22;new message published to &#x22; + topic);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  // subscribes to a topic
  ascoltatore.subscribe(&#x27;hello&#x27;, function() {
    console.log(arguments);
    // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
  });

  // publishes a message to the topic &#x27;hello&#x27;
  ascoltatore.<span class="apidocCodeKeywordSpan">publish</span>(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
    console.log(&#x27;message published&#x27;);
  });
});
```


## Wildcards
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.sub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.sub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>sub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;registered new subscriber for topic &#x22; + topic);
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.publish(&#x22;hello&#x22;);
  });
});

it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
  var that = this;
  that.instance.<span class="apidocCodeKeywordSpan">sub</span>(&#x22;hello&#x22;, wrap(done), function() {
    that.instance.pub(&#x22;hello&#x22;);
  });
});

it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
  this.instance.pub(&#x22;hello&#x22;);
  setTimeout(done, 50);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.subscribe" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.subscribe">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>subscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function subscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;registered new subscriber for topic &#x22; + topic);
  this._ascoltatore.subscribe(topic, callback, done);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.build(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.<span class="apidocCodeKeywordSpan">subscribe</span>(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});

// publishes a message to the topic &#x27;hello&#x27;
ascoltatore.publish(&#x27;hello&#x27;, &#x27;a message&#x27;, function() {
  console.log(&#x27;message published&#x27;);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsub" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsub">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsub
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;deregistered subscriber for topic &#x22; + topic);
  this._ascoltatore.unsubscribe(topic, callback);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    done();
  };

  callback2 = function () { };

  that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
    that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
      that.instance.<span class="apidocCodeKeywordSpan">unsub</span>(&#x22;hello/*/there&#x22;, callback2, function () {
        that.instance.pub(&#x22;hello/42/there&#x22;);
      });
    });
  });
});

it(&#x22;should call each matching callback&#x22;, function(done) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsubscribe" id="apidoc.element.ascoltatori.ZeromqAscoltatore.prototype.unsubscribe">
        function <span class="apidocSignatureSpan">ascoltatori.ZeromqAscoltatore.prototype.</span>unsubscribe
        <span class="apidocSignatureSpan">(topic, callback, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function unsubscribe(topic, callback, done) {
  this._raiseIfClosed();
  debug(&#x22;deregistered subscriber for topic &#x22; + topic);
  this._ascoltatore.unsubscribe(topic, callback);
  defer(done); // simulate some steedhronicity
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.ascoltatori" id="apidoc.module.ascoltatori.ascoltatori">module ascoltatori.ascoltatori</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.AMQPAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.AMQPAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require(&#x22;amqp&#x22;);
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.AMQPLibAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.AMQPLibAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AMQPLibAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AMQPLibAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.amqp = this._opts.amqp || require(&#x22;amqplib/callback_api&#x22;);
  this._ascoltatore = new TrieAscoltatore(opts);

  this._subs_counter = new SubsCounter();
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.AbstractAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.AbstractAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>AbstractAscoltatore
        <span class="apidocSignatureSpan">(settings, nativeSettings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function AbstractAscoltatore(settings, nativeSettings) {
  EventEmitter.call(this);

  settings = settings || {};
  nativeSettings = nativeSettings || {};

  this._separator = settings.separator || &#x27;/&#x27;,
  this._wildcardOne = settings.wildcardOne || &#x27;+&#x27;,
  this._wildcardSome = settings.wildcardSome || &#x27;*&#x27;;
  this._nativeSettings = nativeSettings;

  if (nativeSettings.separator &#x26;&#x26;
      (this._separator !== nativeSettings.separator)) {
    this._reInSeparator = new RegExp(&#x27;\\&#x27; + this._separator, &#x27;g&#x27;);
    this._reOutSeparator = new RegExp(&#x27;\\&#x27; + nativeSettings.separator, &#x27;g&#x27;);
  }
  if (nativeSettings.wildcardOne &#x26;&#x26;
      (this._wildcardOne !== nativeSettings.wildcardOne)) {
    this._reInWildcardOne = new RegExp(&#x27;\\&#x27; + this._wildcardOne, &#x27;g&#x27;);
  }
  if (nativeSettings.wildcardSome &#x26;&#x26;
      (this._wildcardSome !== nativeSettings.wildcardSome)) {
    this._reInWildcardSome = new RegExp(&#x27;\\&#x27; + this._wildcardSome, &#x27;g&#x27;);
  }

  this._setPublish();

  this._ready = false;
  this._closed = false;

  var that = this;

  this.on(&#x22;ready&#x22;, function() {
    that._ready = true;
  });

  this.on(&#x22;closed&#x22;, function() {
    that._closed = true;
  });

  this.on(&#x22;newListener&#x22;, function(event, listener) {
    if (event === &#x22;ready&#x22; &#x26;&#x26; that._ready) {
      listener();
    }
  });

  this.setMaxListeners(0);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.DecoratorAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.DecoratorAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>DecoratorAscoltatore
        <span class="apidocSignatureSpan">(decorated)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function DecoratorAscoltatore(decorated) {
  this._ascoltatore = decorated;
  AbstractAscoltatore.prototype._setPublish.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.EventEmitter2Ascoltatore" id="apidoc.element.ascoltatori.ascoltatori.EventEmitter2Ascoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>EventEmitter2Ascoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter2Ascoltatore(settings) {
  AbstractAscoltatore.call(this, settings, {
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;**&#x27;
  });

  this._event = new EventEmitter2({
    delimiter: this._separator,
    wildcard: true
  });

  this._event.setMaxListeners(0);

  this.emit(&#x22;ready&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.FileSystemAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.FileSystemAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>FileSystemAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function FileSystemAscoltatore(opts)
{
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;.&#x27;
  });

  opts = opts || {};

  var QlobberFSQ = (opts.qlobber_fsq || require(&#x27;qlobber-fsq&#x27;)).QlobberFSQ;

  opts.separator = this._nativeSettings.separator;
  opts.wildcard_one = this._wildcardOne;
  opts.wildcard_some = this._wildcardSome;
  opts.dedup = false;

  this._dehnd = &#x27;__filesystem_ascoltatore&#x27; + crypto.randomBytes(16).toString(&#x27;base64&#x27;);
  this._fsq = new QlobberFSQ(opts);

  var ths = this;

  this._fsq.on(&#x27;start&#x27;, function () {
    ths.emit(&#x27;ready&#x27;);
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.JSONAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.JSONAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>JSONAscoltatore
        <span class="apidocSignatureSpan">(ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function JSONAscoltatore(ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

if (opts.prefix) {
  result = new module.exports.PrefixAscoltatore(opts.prefix, result)
    .once(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">JSONAscoltatore</span>(result)
    .once(&#x22;error&#x22;, done);
}

if (done) {
  setImmediate(function() {
    result.once(&#x22;ready&#x22;, function() {
      result.removeListener(&#x22;error&#x22;, done);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.KafkaAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.KafkaAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>KafkaAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function KafkaAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;_&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;#&#x27;
  });
  this._default_opts = {connectionString: &#x22;localhost:2181/&#x22;, clientId: &#x22;kafka-node-client&#x22;, groupId: &#x22;kafka-node-group&#x22;};
  this._opts = opts || this._default_opts;
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.kafka = this._opts.kafka || require(&#x22;kafka-node&#x22;);
  this._opts.encodings = this._opts.encodings || {};
  this._opts.defaultEncoding = this._opts.defaultEncoding || &#x22;utf8&#x22;;
  this._opts.noAckBatchOptions = this._opts.noAckBatchOptions || { noAckBatchSize: null, noAckBatchAge: null };

  this._knowntopics = [];
  this._subs_counter = new SubsCounter();
  this._qlobber_opts = {separator: &#x27;_&#x27;,  wildcard_one: &#x27;*&#x27;, wildcard_some: &#x27;#&#x27;};
  this._subs_matcher = new Qlobber(this._qlobber_opts);

  this._ascoltatore = new TrieAscoltatore(opts);
  this._consumerStarting = false;
  var connectionString = this._opts.connectionString || this._default_opts.connectionString;
  var clientId = this._opts.clientId || this._default_opts.clientId;
  var zkOptions = this._opts.zkOptions || this._default_opts.zkOptions;
  var noAckBatchOptions = this._opts.noAckBatchOptions;
  var Client = this._opts.kafka.Client;
  this._producerClient = new Client(connectionString,clientId,zkOptions,noAckBatchOptions);
  var HighLevelProducer = this._opts.kafka.HighLevelProducer;
  this._producer = new HighLevelProducer(this._producerClient);
  var that = this;
  this._producer.on(&#x27;ready&#x27;,function(){
     that.readZkTopics(function(err,topics){
        if(err){
           that.emit(&#x22;error&#x22;,err);
           return;
        }
       that._knowntopics = that._knowntopics.concat(topics);
       that.emit(&#x22;ready&#x22;);
      });
   });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.MQTTAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.MQTTAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MQTTAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function MQTTAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;/&#x27;,
    wildcardOne: &#x27;+&#x27;,
    wildcardSome: &#x27;#&#x27;
  });

  this._opts = opts || {};
  this._opts.keepalive = this._opts.keepalive || 3000;
  this._opts.mqtt = this._opts.mqtt || require(&#x22;mqtt&#x22;);

  this._subs_counter = new SubsCounter();

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startConn();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.MongoAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.MongoAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>MongoAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">MongoAscoltatore = function (opts) {
  AbstractAscoltatore.call(this);

  if (typeof opts.db === &#x27;string&#x27; || opts.uri) {
    // old options
    opts.uri = opts.uri || &#x27;mongodb://127.0.0.1/&#x27;;
    opts.db = opts.db || &#x27;ascoltatori&#x27;;
    opts.url = opts.uri + opts.db + &#x27;?auto_reconnect=true&#x27;;
    delete opts.db;
  }

  this._opts = opts || {};
  this.url = this._opts.url || &#x27;mongodb://127.0.0.1/ascoltatori?auto_reconnect=true&#x27;;
  this._pubsubCollection = opts.pubsubCollection || &#x27;pubsub&#x27;;
  this._maxRetry = opts.maxRetry || 5;
  this.mongoOpts = this._opts.mongo || {};

  this._ascoltatore = new TrieAscoltatore(opts);

  this.channels = {};
  this._closed = false;

  this._handlingCursorFailure = false;
  this._lastSuccessfulHandling = new ObjectID();

  this.wait = this._opts.wait || 100;

  this.connectionParams = {
    capped: true,
    size: this._opts.size || 10 * 1024 * 1024, // 10 MB
    max: this._opts.max || 10000 // documents
  };

  var that = this;

  var setupDB = function(err, db) {
    if (err) {
      that.emit(&#x27;error&#x27;, err);
      return;
    }

    that.db = db;

    // creating the capped collection where we can exchange messages
    that.db.createCollection(that._pubsubCollection, that.connectionParams, function(err, collection) {
      if (err) {
        that.emit(&#x27;error&#x27;, err);
      } else {
        that.collection = collection;

        debug(&#x27;ready&#x27;);

        // create a new object id. We will get all the events from now on
        that._poll(new ObjectID());

        that.emit(&#x27;ready&#x27;);
      }
    });
  };

  if (opts.db) {
    setupDB(null, opts.db);
  } else {
    MongoClient.connect(this.url, this.mongoOpts, setupDB);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.PrefixAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.PrefixAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>PrefixAscoltatore
        <span class="apidocSignatureSpan">(prefix, ascoltatore)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function PrefixAscoltatore(prefix, ascoltatore) {
  DecoratorAscoltatore.call(this, ascoltatore || new TrieAscoltatore());

  this._prefix = prefix;
  this._separator = this._ascoltatore._separator;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Klass = (typeof opts.type === &#x27;function&#x27;) ? opts.type :
          (classes[opts.type] || module.exports.TrieAscoltatore);

result = new Klass(opts, module.exports);

if (opts.prefix) {
  result = new module.exports.<span class="apidocCodeKeywordSpan">PrefixAscoltatore</span>(opts.prefix, result)
    .once(&#x22;error&#x22;, done);
}

if (opts.json !== false) {
  result = new module.exports.JSONAscoltatore(result)
    .once(&#x22;error&#x22;, done);
}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.RedisAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.RedisAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>RedisAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisAscoltatore(opts) {
  AbstractAscoltatore.call(this, opts, {
    separator: &#x27;/&#x27;,
    wildcardOne: &#x27;*&#x27;,
    wildcardSome: &#x27;*&#x27;
  });

  this._ready_sub = false;
  this._ready_pub = false;
  this._opts = opts || {};

  this._ascoltatores = {};

  this._startSub();
  this._startPub();

  this._subs_counter = new SubsCounter();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.SubsCounter" id="apidoc.element.ascoltatori.ascoltatori.SubsCounter">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>SubsCounter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function SubsCounter() {
  this.clear();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.TrieAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.TrieAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>TrieAscoltatore
        <span class="apidocSignatureSpan">(settings)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function TrieAscoltatore(settings) {
  AbstractAscoltatore.call(this, settings);

  settings = settings || {};

  this._matcher = new Qlobber({
    separator: settings.separator || &#x27;/&#x27;,
    wildcard_one: settings.wildcardOne || &#x27;+&#x27;,
    wildcard_some: settings.wildcardSome || &#x27;*&#x27;
  });

  this.emit(&#x22;ready&#x22;);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.ZeromqAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.ZeromqAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>ZeromqAscoltatore
        <span class="apidocSignatureSpan">(opts)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function ZeromqAscoltatore(opts) {
  AbstractAscoltatore.call(this);

  this._opts = opts || {};
  this._opts.delay = this._opts.delay || 5;
  this._opts.zmq = this._opts.zmq || require(&#x22;zmq&#x22;);

  this._connectedControls = [];

  this._ascoltatore = new TrieAscoltatore(opts);
  this._startSubs();
  this._startPub();
  this._startControl();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.behaveLikeAnAscoltatore" id="apidoc.element.ascoltatori.ascoltatori.behaveLikeAnAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>behaveLikeAnAscoltatore
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">behaveLikeAnAscoltatore = function () {

  var expect;

  // you MUST depend on chai only if you plan to run
  // this test
  expect = require(&#x22;chai&#x22;).expect;

  it(&#x22;should have a subscribe function&#x22;, function() {
    var that = this;
    expect(that.instance).to.respondTo(&#x22;subscribe&#x22;);
  });

  it(&#x22;should have an publish function&#x22;, function() {
    var that = this;
    expect(that.instance).to.respondTo(&#x22;publish&#x22;);
  });

  it(&#x22;should support a publish/subscribe pattern&#x22;, function(done) {
    var that = this;
    that.instance.subscribe(&#x22;hello&#x22;, wrap(done), function() {
      that.instance.publish(&#x22;hello&#x22;);
    });
  });

  it(&#x22;should support &#x27;pub/sub&#x27; combination for pub/sub&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello&#x22;);
    });
  });

  it(&#x22;should not raise an exception if pub is called without a done callback&#x22;, function(done) {
    this.instance.pub(&#x22;hello&#x22;);
    setTimeout(done, 50);
  });

  it(&#x22;should not raise an exception if sub is called without a done callback&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello&#x22;, function() {});
    setTimeout(function() {
      // still, some Ascoltatore are async
      // and we must give them some time
      done();
    }, 10);
  });

  it(&#x22;should accept a done callback in pub&#x22;, function(done) {
    this.instance.pub(&#x22;hello&#x22;, &#x22;world&#x22;, done);
  });

  it(&#x22;should support multi-level wildcard at end of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/*&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/there/42&#x22;);
    });
  });

  it(&#x22;should support multi-level wildcard at the end of a topic with no separator&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/*&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello&#x22;);
    });
  });

  it(&#x22;should support single-level wildcard at start of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;+/hello&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;42/hello&#x22;);
    });
  });

  it(&#x22;should support single-level wildcard in middle of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/+/end&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/42/end&#x22;);
    });
  });

  it(&#x22;should support single-level wildcard at end of topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/+&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/42&#x22;);
    });
  });

  it(&#x22;should support both wildcards in topic&#x22;, function(done) {
    var that = this;
    that.instance.sub(&#x22;hello/+/there/*&#x22;, wrap(done), function() {
      that.instance.pub(&#x22;hello/foo/there/bar/42/end&#x22;);
    });
  });

  it(&#x22;should not match multiple levels with single wildcard&#x22;, function(done) {
    var that = this,
        callback = null;

    callback = function(topic) {
      expect(topic).to.equal([&#x22;hello&#x22;, &#x22;42&#x22;, &#x22;there&#x22;].join(that.separator));
      done();
    };

    that.instance.sub(&#x22;hello/+/there&#x22;, callback, function () {
      that.instance.pub(&#x22;hello/42/43/there&#x22;);
      that.instance.pub(&#x22;hello/42/there&#x22;);
    });
  });

  it(&#x22;should unsubscribe from wildcard topics independently&#x22;, function(done) {
    var that = this,
        callback1 = null,
        callback2 = null;

    callback1 = function(topic) {
      expect(topic).to.equal([&#x22;hello&#x22;, &#x22;42&#x22;, &#x22;there&#x22;].join(that.separator));
      done();
    };

    callback2 = function () { };

    that.instance.sub(&#x22;hello/*/there&#x22;, callback2, function () {
      that.instance.sub(&#x22;hello/+/there&#x22;, callback1, function () {
        that.instance.unsub(&#x22;hello/*/there&#x22;, callback2, function () {
          that.instance.pub(&#x22;hello/42/there&#x22;);
        });
      });
    });
  });

  it(&#x22;should call each matching callback&#x22;, function(done) {
    var that = this,
        callback = null,
        count = 0;

    callback = function(topic) {
      expect(topic).to.equal([&#x22;hello&#x22;, &#x22;42&#x22;].join(that.separator));
      count += 1;
      if (count === 2) {
        done();
      }
    };

    that.instance.sub(&#x22;hello/42&#x22;, callback, function () {
      that.i ...</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.ascoltatori.build" id="apidoc.element.ascoltatori.ascoltatori.build">
        function <span class="apidocSignatureSpan">ascoltatori.ascoltatori.</span>build
        <span class="apidocSignatureSpan">(opts, done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function build(opts, done) {
  opts = opts || {};

  if (typeof opts === &#x22;function&#x22;) {
    done = opts;
    opts = {};
  }

  var Klass = null,
    result = null;

  Klass = (typeof opts.type === &#x27;function&#x27;) ? opts.type :
            (classes[opts.type] || module.exports.TrieAscoltatore);

  result = new Klass(opts, module.exports);

  if (opts.prefix) {
    result = new module.exports.PrefixAscoltatore(opts.prefix, result)
      .once(&#x22;error&#x22;, done);
  }

  if (opts.json !== false) {
    result = new module.exports.JSONAscoltatore(result)
      .once(&#x22;error&#x22;, done);
  }

  if (done) {
    setImmediate(function() {
      result.once(&#x22;ready&#x22;, function() {
        result.removeListener(&#x22;error&#x22;, done);
        done(null, result);
      });
    });
  }

  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

Ascoltatori focuses on providing a simple and unique abstraction for all
supported brokers. Here is a simple example using Redis:

```javascript
var ascoltatori = require(&#x27;ascoltatori&#x27;);

ascoltatori.<span class="apidocCodeKeywordSpan">build</span>(function (err, ascoltatore) {

// subscribes to a topic
ascoltatore.subscribe(&#x27;hello&#x27;, function() {
  console.log(arguments);
  // { &#x27;0&#x27;: &#x27;hello&#x27;, &#x27;1&#x27;: &#x27;a message&#x27; }
});
...</pre></li>
    </ul>




</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.ascoltatori.util" id="apidoc.module.ascoltatori.util">module ascoltatori.util</a></h1>


    <h2>
        <a href="#apidoc.element.ascoltatori.util.alias" id="apidoc.element.ascoltatori.util.alias">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>alias
        <span class="apidocSignatureSpan">(obj, from, to)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function alias(obj, from, to) {
  if (typeof obj[from] !== &#x27;function&#x27;) {
    throw util.format(&#x22;&#x27;%s&#x27; is not a function&#x22;, from);
  }
  obj[to] = obj[from];
  return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.aliasAscoltatore" id="apidoc.element.ascoltatori.util.aliasAscoltatore">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>aliasAscoltatore
        <span class="apidocSignatureSpan">(obj)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function aliasAscoltatore(obj) {
  var key = null;
  Object.keys(aliases).forEach(function(key) {
    if (aliases.hasOwnProperty(key)) {
      aliases[key].forEach(function(a) {
        module.exports.alias(obj, key, a);
      });
    }
  });
  return obj;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.buildIdentifier" id="apidoc.element.ascoltatori.util.buildIdentifier">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>buildIdentifier
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function buildIdentifier() {
  var result = util.format(&#x27;asc_%s&#x27;, uuid.v1());
  return result;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.defer" id="apidoc.element.ascoltatori.util.defer">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>defer
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function defer(done) {
  if (typeof done === &#x22;function&#x22;) {
    setImmediate(done);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.ascoltatori.util.wrap" id="apidoc.element.ascoltatori.util.wrap">
        function <span class="apidocSignatureSpan">ascoltatori.util.</span>wrap
        <span class="apidocSignatureSpan">(done)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function wrap(done) {
  return function() {
    if (typeof done === &#x27;function&#x27;) {
      done();
    }
  };
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
